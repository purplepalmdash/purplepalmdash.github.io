<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta name=generator content="Hugo 0.64.0"><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Dash &#183; Dash</title><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-a.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/custom-additions.css?ref=abc124"><link rel=stylesheet href=https://purplepalmdash.github.io/css/highlight/googlecode.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script type=text/javascript src=/js/html2canvas.js></script><script type=text/javascript>function genPostShot(){var rightNow=new Date();var imageName=rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");imageName+='.jpg'
html2canvas(document.getElementsByClassName('post'),{background:'#FFFFFF',onrendered:function(canvas){$('#test').attr('href',canvas.toDataURL("image/jpeg"));$('#test').attr('download',imageName);$('#test')[0].click();}});};</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=apple-touch-icon-precomposed sizes=144x144 href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124"><link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel=icon><link href=%7balternate%20%7bRSS%20application/rss+xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/index.xml%20http://purplepalmdash.github.io/index.xml%7d rel=alternate type=application/rss+xml title="Dash &#183; Dash"><meta name=description content><meta name=keywords content="unix,virtualization,embedded,linux"></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><img src=http://purplepalmdash.github.io/images/mylogo.jpeg alt=gravatar><h1><a href=http://purplepalmdash.github.io/>很惭愧，就做了一点微小的工作</a></h1><a href=http://purplepalmdash.github.io/><p>Dash</p></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/post/>All Posts</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/technology/>Technology</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/life/>Life</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/linuxtips/>LinuxTips</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/purplepalmdash><i class="fa fa-github-square fa-3x"></i></a><a href=https://cn.linkedin.com/in/yang-feipeng-1b909319><i class="fa fa-linkedin-square fa-3x"></i></a><a href=https://plus.google.com/u/0/106572959364703833986><i class="fa fa-google-plus-square fa-3x"></i></a><a href=https://www.facebook.com/yang.feipeng><i class="fa fa-facebook-square fa-3x"></i></a><a href=https://twitter.com/dashwillfly><i class="fa fa-twitter-square fa-3x"></i></a></li></ul></div></div><div class="content container"><div class=posts><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2017/08/22/onairdetection/>OnAirDetection</a></h1><span class=post-date>Aug 22, 2017<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=direct-read-from-serial-port>Direct Read From Serial Port</h3><p>Arduino mega2560 Code:</p><pre><code>void setup() {
  pinMode(0,INPUT_PULLUP); 
  pinMode(1,INPUT_PULLUP); 
}

void loop() {
}
</code></pre><p>This code will turn mega2560 into a USB-TTL transmitter, thus you could
directly read from the serial port and display them in hex mode:</p><pre><code># cat /dev/ttyACM0 | xxd -p -c 9
ffff01270005020534
ffff01270005020534
ffff01270005020534
ffff01270005020534
....
</code></pre><p>According to the reference manual,</p><p><img src=/images/2017_08_22_14_36_13_1174x364.jpg alt=/images/2017_08_22_14_36_13_1174x364.jpg></p><p>we know the air is 0.05 mg/m3.</p><h3 id=read-from-arduino-mega2560>Read From Arduino Mega2560</h3><p>Code:</p><pre><code>void setup() {
  // initialize both serial ports:
  Serial.begin(9600);
  Serial2.begin(9600,SERIAL_8N1);

    while (!Serial) {
    ; // wait for serial port to connect. Needed for native USB port only
  }


    while (!Serial2) {
    ; // wait for serial port to connect. Needed for native USB port only
  }

  // prints title with ending line break
  Serial.println(&quot;ASCII Table ~ Character Map&quot;);
}

void loop() {


   for (int i=0; i&lt;9; i++) {

    while(!Serial2.available()); // wait for a character
    int incomingByte = Serial2.read();
    Serial.print(incomingByte,HEX);
    Serial.print(' ');

   }
   Serial.println();
}
</code></pre><p>Result:</p><p><img src=/images/2017_08_22_15_11_30_368x349.jpg alt=/images/2017_08_22_15_11_30_368x349.jpg></p><h3 id=problem>Problem</h3><p>How to detect the result? Start from FF FF?</p><p>Should be</p><p><img src=/images/2017_08_22_15_24_13_265x289.jpg alt=/images/2017_08_22_15_24_13_265x289.jpg></p><h3 id=fixed-bug>Fixed-Bug</h3><p>Every time it will print starting with <code>FF FF</code>:</p><pre><code>int incomingByte=0;
int vanishByte=0;

void setup() {
  // initialize both serial ports:
  Serial.begin(9600);
  Serial2.begin(9600,SERIAL_8N1);

    while (!Serial) {
    ; // wait for serial port to connect. Needed for native USB port only
  }


    while (!Serial2) {
    ; // wait for serial port to connect. Needed for native USB port only
  }

  // prints title with ending line break
  Serial.println(&quot;ASCII Table ~ Character Map&quot;);
}

void loop() {

    //Serial.println();
   //for (int i=0; i&lt;9; i++) {
    while(!Serial2.available()); // wait for a character
    vanishByte = incomingByte;
    incomingByte = Serial2.read();
    if((incomingByte == 0xFF) &amp;&amp; (vanishByte != 0xFF))
    {
      Serial.println();
    }
    Serial.print(incomingByte,HEX);
    Serial.print(' ');
   //}
   //Serial.println();
}
</code></pre><p><img src=/images/2017_08_22_15_24_13_265x289.jpg alt=/images/2017_08_22_15_24_13_265x289.jpg></p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2017/08/21/onfiotesting/>OnFIOTesting</a></h1><span class=post-date>Aug 21, 2017<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=environment>Environment</h3><p>bare metal vs kvm vs docker
Testing script:</p><pre><code>#!/bin/bash
function tgt_r {
fio -filename=/root/ioscript/ccc -direct=1 -iodepth 4 -thread -rw=read -ioengine=libaio -bs=$1 -size=120G  -runtime=200 -group_reporting -name=mytest &amp;&gt;&gt; s_r_test
}

function tgt_w {
fio -filename=/root/ioscript/ccc -direct=1 -iodepth 4 -thread -rw=write -ioengine=libaio -bs=$1 -size=120G  -runtime=200 -group_reporting -name=mytest &amp;&gt;&gt; s_w_test
}


function tgt_rr {
fio -filename=/root/ioscript/ccc -direct=1 -iodepth 4 -thread -rw=randread -ioengine=libaio -bs=$1 -size=120G  -runtime=200 -group_reporting -name=mytest &amp;&gt;&gt; r_r_test
}

function tgt_rw {
fio -filename=/root/ioscript/ccc -direct=1 -iodepth 4 -thread -rw=randwrite -ioengine=libaio -bs=$1 -size=120G  -runtime=200 -group_reporting -name=mytest &amp;&gt;&gt; r_w_test
}

mkdir -p /root/ioscript
rm -f /root/ioscript/ccc; touch /root/ioscript/ccc
tgt_r 128K
rm -f /root/ioscript/ccc; touch /root/ioscript/ccc
tgt_w 128K
rm -f /root/ioscript/ccc; touch /root/ioscript/ccc
tgt_rr 4K
rm -f /root/ioscript/ccc; touch /root/ioscript/ccc
tgt_rw 4K
</code></pre><p>Sequence read/write, 128K. Random read/write: 4K.</p><p>KVM using block device:</p><p><img src=/images/2017_08_21_09_24_41_484x416.jpg alt=/images/2017_08_21_09_24_41_484x416.jpg></p><h3 id=result>Result:</h3><p>Bare Metal:</p><pre><code>Sequence Read: 1000
Sequence Write: 893
Random Read: 1000
Random Write: 131 
</code></pre><p>KVM:</p><pre><code>Sequence Read: 800
Sequence Write: 795
Random Read: 84
Random Write: 107
</code></pre><p>Docker:</p><pre><code>Sequence Read: 975
Sequence Write: 909
Random Read: 114
Random Write: 81
</code></pre><p>Seems Not OK&mldr;&mldr;.</p><p>Will use another disk for testing.</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2017/08/11/tipsontesingframeworkforpython/>TipsOnTesingFrameWorkForPython</a></h1><span class=post-date>Aug 11, 2017<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=code>Code</h3><p>Before you run:</p><pre><code># apt-get install python-pip
# pip install nose
# pip install python-memcached
</code></pre><p>Directory Structure:</p><pre><code>test@local:~$ tree /tmp/foomodule/
/tmp/foomodule/
|-- foo
|   |-- a.py
|   |-- b.py
|   `-- __init__.py
`-- tests
    |-- test_a.py
    `-- test_b.py
</code></pre><p>Module Source Code:</p><pre><code># /tmp/foomodule/foo/a.py 

def add(a, b):
    return a + b
def double(a):
    return a * 2

# /tmp/foomodule/foo/b.py 

import memcache
class Cache:
    def __init__(self, server):
        self.cache = memcache.Client([server])
    def get(self, name):
        return self.cache.get(name)
    def set(self, name, value):
        return self.cache.set(name, value)
    def delete(self, name):
        return self.cache.delete(name)
    def close(self):
        self.cache.disconnect_all()

# /tmp/foomodule/foo/__init__.py

from a import *
from b import *
</code></pre><p>Testing Code:</p><pre><code># /tmp/foomodule/tests/test_a.py 
from foo.a import add, double
def test_add():
    v = add(10, 20)
    assert v == 30
def test_double():
    v = double(10)
    assert v == 20

# /tmp/foomodule/tests/test_b.py 
from foo.b import Cache
class TestCache:

    def setUp(self):
        self.cache = Cache(&quot;172.17.0.1:11211&quot;)
        self.key   = &quot;name&quot;
        self.value = &quot;smallfish&quot;

    def tearDown(self):
        self.cache.close()

    def test_00_get(self):
        v = self.cache.get(self.key)
        assert v == None

    def test_01_set(self):
        v = self.cache.set(self.key, self.value)
        assert v == True
        v = self.cache.get(self.key)
        assert v == self.value

    def test_02_delete(self):
        v = self.cache.delete(self.key)
        assert v == True
</code></pre><p>memcached running in docker:</p><pre><code># docker pull memcached
# docker run -d -p 11211:11211 memcached
</code></pre><p>Run testing via:</p><pre><code># nosetests -s -v
test_a.test_add ... ok
test_a.test_double ... ok
test_b.TestCache.test_00_get ... ok
test_b.TestCache.test_01_set ... ok
test_b.TestCache.test_02_delete ... ok

----------------------------------------------------------------------
Ran 5 tests in 0.012s

OK
</code></pre><p>By default, nose will run test to <code>test</code> directory, file(contains test),
functions(started with test_), class(started with Test), assert will run
assertion.</p><h3 id=coverage>coverage</h3><p>Install coverage via:</p><pre><code># pip install coverage
</code></pre><p>Run with coverage:</p><pre><code># coverage html
# ls
foo  htmlcov  tests
# nosetests -s -v --with-coverage
# coverage report -m
</code></pre><p>nosetests could be run with coverage items.</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2017/08/10/thinkingoncloud/>ThinkingOnCloud</a></h1><span class=post-date>Aug 10, 2017<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>Comparison On Chinese cloud vs Citrix cloud</p><p><img src=/images/2017_08_10_16_31_34_1192x457.jpg alt=/images/2017_08_10_16_31_34_1192x457.jpg></p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2017/08/02/makeciin3rdparty/>MakeCIIn3rdParty</a></h1><span class=post-date>Aug 2, 2017<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=docker-images>Docker Images</h3><p>需要用到的Docker Image: <code>wgetbuildcs6</code>, 构建的Dockerfile:</p><pre><code>FROM centos:centos6

MAINTAINER dash xxx &lt;xxxx@gmail.com&gt;

RUN yum -y install curl git gcc make rpm-build python-devel which lrzsz tar gnutls gnutls-devel
</code></pre><p>将创建好的镜像上传到私有仓库(某台内网主机):</p><pre><code>$ sudo docker load&lt;wgetbuildcs6.tar
$ sudo docker images | grep wgetbuildcs6
$ sudo docker tag 1020xxxxx 192.168.124.102:5000/xxxxx/wgetbuildcs6:latest
$ sudo docker push  192.168.124.102:5000/xxxxx/wgetbuildcs6:latest
</code></pre><p><img src=/images/2017_08_02_15_12_12_484x294.jpg alt=/images/2017_08_02_15_12_12_484x294.jpg></p><h3 id=git-repository>Git Repository</h3><p>在CentOS7.3系统上，安装git daemon:</p><pre><code># yum install -y git-daemon
</code></pre><p>在源码目录下, 执行以下命令:</p><pre><code># git init
# git add .
# git commit -m &quot;initial commit&quot;
# cd ..
# git clone --bare wgetbuild wgetbuild.git
</code></pre><p><img src=/images/2017_08_02_15_43_19_426x427.jpg alt=/images/2017_08_02_15_43_19_426x427.jpg></p><p>现在运行:</p><pre><code># git daemon --verbose --export-all --base-path=.
</code></pre><p>即可激活git server.<br>测试:</p><pre><code># git clone git://192.192.192.91/wgetbuild.git mybuild
</code></pre><p>证明友商方案对git协议支持不佳，切换回gitlab，用http继续测试。</p><h3 id=enable-push-in-git>Enable push in git</h3><p>Enable push to git server in git daemon:</p><pre><code># git daemon --enable=receive-pack --verbose --export-all --base-path=.
</code></pre></div><ul class=pagination><li class=page-item><a href=/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/page/88/ class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=/>1</a></li><li class=page-item><a class=page-link href=/page/2/>2</a></li><li class=page-item><a class=page-link href=/page/3/>3</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/88/>88</a></li><li class="page-item active"><a class=page-link href=/page/89/>89</a></li><li class=page-item><a class=page-link href=/page/90/>90</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/238/>238</a></li><li class=page-item><a href=/page/90/ class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/238/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div><script src=http://purplepalmdash.github.io/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>