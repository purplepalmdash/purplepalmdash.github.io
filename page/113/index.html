<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta name=generator content="Hugo 0.64.0"><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Dash &#183; Dash</title><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-a.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/custom-additions.css?ref=abc124"><link rel=stylesheet href=https://purplepalmdash.github.io/css/highlight/googlecode.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script type=text/javascript src=/js/html2canvas.js></script><script type=text/javascript>function genPostShot(){var rightNow=new Date();var imageName=rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");imageName+='.jpg'
html2canvas(document.getElementsByClassName('post'),{background:'#FFFFFF',onrendered:function(canvas){$('#test').attr('href',canvas.toDataURL("image/jpeg"));$('#test').attr('download',imageName);$('#test')[0].click();}});};</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=apple-touch-icon-precomposed sizes=144x144 href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124"><link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel=icon><link href=%7balternate%20%7bRSS%20application/rss+xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/index.xml%20http://purplepalmdash.github.io/index.xml%7d rel=alternate type=application/rss+xml title="Dash &#183; Dash"><meta name=description content><meta name=keywords content="unix,virtualization,embedded,linux"></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><img src=http://purplepalmdash.github.io/images/mylogo.jpeg alt=gravatar><h1><a href=http://purplepalmdash.github.io/>很惭愧，就做了一点微小的工作</a></h1><a href=http://purplepalmdash.github.io/><p>Dash</p></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/post/>All Posts</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/technology/>Technology</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/life/>Life</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/linuxtips/>LinuxTips</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/purplepalmdash><i class="fa fa-github-square fa-3x"></i></a><a href=https://cn.linkedin.com/in/yang-feipeng-1b909319><i class="fa fa-linkedin-square fa-3x"></i></a><a href=https://plus.google.com/u/0/106572959364703833986><i class="fa fa-google-plus-square fa-3x"></i></a><a href=https://www.facebook.com/yang.feipeng><i class="fa fa-facebook-square fa-3x"></i></a><a href=https://twitter.com/dashwillfly><i class="fa fa-twitter-square fa-3x"></i></a></li></ul></div></div><div class="content container"><div class=posts><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2016/11/07/runwithmusic/>RunWithMusic</a></h1><span class=post-date>Nov 7, 2016<br><a class=a_cat href=http://purplepalmdash.github.io/categories/life>Life</a></span><p>晚上败了个索尼大法，回想起来跑步这么些年，听坏的播放装备简直是……提起来就让人"心痛到无法呼吸&rdquo;。好了，下面
来盘点一下被我玩坏过的装备。</p><p>跑步中会大量出汗，因而选择运动装备，无论是耳机还是播放设备，第一是防水、第二还是防水、第三还是防水&mdash;-重要的事情说
三遍！ 如果你还没悟到防水的重要，那可能是因为：<br>1、 你处于高纬度地带，跑步压根不出汗；<br>2、 你跑步的速度可能有点。。。。。。慢;<br>3、 你没有汗腺，可以像狗狗一样伸个舌头就散热。。。(开个玩笑)</p><p>意外的是，在诸多运动耳机中，我第一时间想到的是Philips的耳机. 便宜、耐操,
防水性超好：</p><p>Philips 灵活挂钩式耳机 SHS3200BK/37 ：</p><p><img src=/images/2016_11_07_21_24_56_540x479.jpg alt=/images/2016_11_07_21_24_56_540x479.jpg></p><p>特点：
非入耳式，跑步时很安全(可以听到汽笛声铃铛声等)。这个耳机是我用过的最耐操的，先后买过两个，
白色和黑色。这个耳机的脆弱点在于，它的与耳朵接触的部位含有少量金属，因而会慢慢被腐蚀，最后
导致声音越来越少。本人右耳出汗稍微多点，每次都是坏右耳。</p><p>重音很好。</p><p>价格：入手时50左右，现在可能涨了点。</p><p>使用寿命：一年+。</p><p>飞利浦（PHILIPS） SHQ3200/98 ActionFit：</p><p><img src=/images/2016_11_07_21_34_59_697x705.jpg alt=/images/2016_11_07_21_34_59_697x705.jpg></p><p>特点：<br>入耳式，听各种协奏曲会很爽。耐操程度不如上一个。这个耳机我也买过两个。脆弱点在于：发音部分
含有金属，所以，会被汗液慢慢腐蚀。</p><p>缺点： 带上以后，跑公路很危险，因为是入耳式。</p><p>使用寿命：9个月左右。</p><p>DECATHLON</p><p><img src=/images/2016_11_07_21_40_15_257x377.jpg alt=/images/2016_11_07_21_40_15_257x377.jpg></p><p>么有评价，只是告诉你们不要买就是了。买来听两个月就挂的货，毕竟是找到国内企业低成本代工。。。。</p><p>Moto SF200</p><p><img src=/images/2016_11_07_21_46_44_259x265.jpg alt=/images/2016_11_07_21_46_44_259x265.jpg><br>在200左右的价位入手，结果大失所望，听了5个月就坏掉了，一个耳朵没声音。</p><p>蓝牙耳机不评论。盖因本人一直用有线听音乐。当然蓝牙适配器也是有的，因为汗水的缘故，已经挂掉了
N个。。。。</p><p>跑步时候的播放设备，曾经用过PHILIPS、SANDISK、爱国者的MP3，还有几台NOKIA手机。然而我可以很负责任
的告诉各位&mdash;-这些设备现在通通不能用了，因为被汗水诟坏了。</p><p>所以，到最后我只能剁手这个：</p><p><img src=/images/2016_11_07_21_55_10_770x607.jpg alt=/images/2016_11_07_21_55_10_770x607.jpg></p><p>索尼大法好，希望索尼大法能被我操两年+。</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2016/11/07/turnqcow2intovagrantbox/>TurnQcow2IntoVagrantBox</a></h1><span class=post-date>Nov 7, 2016<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=img-preparation>img preparation</h3><p>First you got a qcow2 file, which could let you startup a virtualmachine, so you
startup a machine like following:</p><pre><code># cp YourQcowFile.qcow2 ./box.img
# qemu-system-x86_64 -net nic -net user,hostfwd=tcp::2222-:22 -hda ./box.img -m 512
--enable-kvm
</code></pre><p>Login to the machine and run following scripts:</p><pre><code>useradd -m vagrant
mkdir /home/vagrant/.ssh
chmod 700 /home/vagrant/.ssh
echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key&quot; &gt; /home/vagrant/.ssh/authorized_keys
chmod 600 /home/vagrant/.ssh/authorized_keys
chown -R vagrant.vagrant /home/vagrant/.ssh

# Sudoers
sed -i -r 's/(.* requiretty)/#\1/' /etc/sudoers

cat &gt; /etc/sudoers.d/90-vagrant-users &lt;&lt;EOF
# User rules for vagrant
vagrant ALL=(ALL) NOPASSWD:ALL
EOF
</code></pre><p>Now close the machine.</p><h3 id=metadata-file>Metadata file</h3><p>Create a new metadata file like following:</p><pre><code># vim metadata.json
{
  &quot;provider&quot;     : &quot;libvirt&quot;,
  &quot;format&quot;       : &quot;qcow2&quot;,
  &quot;virtual_size&quot; : 4
}
</code></pre><p>Create a Vagrantfile like following:</p><pre><code>$ vim Vagrantfile
# The contents below were provided by the Packer Vagrant post-processor

Vagrant.configure(&quot;2&quot;) do |config|
  config.vm.provider :libvirt do |libvirt|
    libvirt.driver = &quot;kvm&quot;
  end
end


# The contents below (if any) are custom contents provided by the
# Packer template during image build.
</code></pre><p>Now tar the box file via following:</p><pre><code># tar czvf Trusty.box ./metadata.json ./Vagrantfile ./box.img 
</code></pre><h3 id=using-box>Using box</h3><p>Add box file via:</p><pre><code># vagrant box add Trusty.box --name &quot;trusty64&quot;
</code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2016/11/06/climbingmaofengmountain/>ClimbingMaoFengMountain</a></h1><span class=post-date>Nov 6, 2016<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>近期广州雾霾实在是有点醇厚，所以周末的第一选择当然是进山避霾啦！</p><p>今天定它个小目标，快速穿越帽峰山脉。</p><p>帽峰山是广州周边我非常喜欢的一座山，距市区有点距离(40公里？)，配套设施好、
人流量适中、植被茂密、空气清新。这一年多来去了好几次，每次都有新发现。今天
走的是一条穿越的线路，20公里，白山村->山顶->古庙出口。</p><p>早上游泳的缘故，出发得晚，11点多才开始走白山村道，果然没有雾霾，蓝天白云：</p><p><img src=/images/2016_11_06_20_39_56_1122x837.jpg alt=/images/2016_11_06_20_39_56_1122x837.jpg></p><p>水厂后面的山峰郁郁葱葱，深山有好水:</p><p><img src=/images/2016_11_06_20_42_05_1124x841.jpg alt=/images/2016_11_06_20_42_05_1124x841.jpg></p><p>沿途有村民营业的大量取水点，自备矿泉水桶过来装，2元/桶。拉回城应该随便就能卖到20
块一桶吧? 发家致富的路子，窝也只能指点到这了:</p><p><img src=/images/2016_11_06_20_43_50_801x596.jpg alt=/images/2016_11_06_20_43_50_801x596.jpg></p><p>锄禾日当午, 要珍惜盘中餐啊，看下图，向我学习:</p><p><img src=/images/2016_11_06_20_46_38_1122x837.jpg alt=/images/2016_11_06_20_46_38_1122x837.jpg></p><p>惭愧，走了一个小时就饿了，果断吃饭，考虑一会要在山里跑，吃素淡点就不点鱼了。喜欢
吃鱼的朋友到了帽峰山可以点鱼吃，铜锣湾水库水质不错，出品的鱼很美味:</p><p><img src=/images/2016_11_06_20_57_40_660x355.jpg alt=/images/2016_11_06_20_57_40_660x355.jpg></p><p>这位一直围着桌子喵喵叫的小兄弟, 窝那么富有爱心当然不会忘了你:</p><p><img src=/images/2016_11_06_21_20_34_434x659.jpg alt=/images/2016_11_06_21_20_34_434x659.jpg></p><p>山间风景:</p><p><img src=/images/2016_11_06_21_23_48_427x408.jpg alt=/images/2016_11_06_21_23_48_427x408.jpg></p><p>15分钟到顶，开始沿着山脊往帽峰山顶广场穿行:</p><p><img src=/images/2016_11_06_21_26_07_973x721.jpg alt=/images/2016_11_06_21_26_07_973x721.jpg></p><p>速度有点快，1小时不到抵达帽峰山顶广场:</p><p><img src=/images/2016_11_06_21_27_16_974x716.jpg alt=/images/2016_11_06_21_27_16_974x716.jpg></p><p>山顶俯瞰林海, 空气没得说，怎样都是负氧离子饱和:</p><p><img src=/images/2016_11_06_21_27_57_975x726.jpg alt=/images/2016_11_06_21_27_57_975x726.jpg></p><p>北国早已寒冷如咧，可这帽峰山里风景, 依然青翠如夏:</p><p><img src=/images/2016_11_06_21_31_29_522x516.jpg alt=/images/2016_11_06_21_31_29_522x516.jpg></p><p>下午3点40,自古庙出口下到山底，结束愉快的帽峰山一日之旅。<br>如此算来，从白山村到杨伙寮，经箫神顶到帽峰山顶景区后经古庙下山,可以在三个小时内完成。</p><p>压轴奉上帽峰山脉一景. Life is short, play more.</p><p><img src=/images/2016_11_06_21_35_42_1125x836.jpg alt=/images/2016_11_06_21_35_42_1125x836.jpg></p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2016/11/05/%E4%B8%BAblog%E6%B7%BB%E5%8A%A0%E4%BF%9D%E5%AD%98%E4%B8%BA%E5%9B%BE%E7%89%87%E5%8A%9F%E8%83%BD/>为Blog添加保存为图片功能</a></h1><span class=post-date>Nov 5, 2016<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=背景>背景</h3><p>众所周知疼讯其实一直是一个很封闭傻逼的企业，早年QZONE的代码就层层加密，
惟恐互联网爬虫爬到它上面取内容。进入到移动互联网时代，就更加变本加厉，盆友
圈里的诸多内容，恐怕诸位都是没办法弄出来的。</p><p>早年曾在Blog上添加过<code>分享到朋友圈</code>或<code>分享到微信好友</code>按钮，由于<code>github.io</code>未
被疼讯认可，共享出来的链接通常只有自己能看到，这又是一个拿用户当SB的典型
案例。</p><p>还好，对于用户上传图片，疼讯是没法限制的。所以有了以下的开发。</p><h3 id=功能参考>功能参考</h3><p>在博文里添加按钮<code>一键保存为图片</code>,即可将该篇文章生成为长图片。</p><p><img src=/images/2016_11_05_18_38_31_637x390.jpg alt=/images/2016_11_05_18_38_31_637x390.jpg></p><p>参考设计： 锤子便签。顺便吐槽一下锤子便签，添加了关键词过滤，关键词嘛，这也是
党国拿来折腾屁民的一个傻逼玩意，例如有一首歌是这么唱的:</p><pre><code>我爱北京关键词，
关键词上太阳升。。
伟大得领袖关键词，
带领我们向前进…
</code></pre><p>╮〔╯ε╰〕╭ &mdash;太多的关键词，容易让写博文的人心情不好。</p><h3 id=可选方案>可选方案</h3><p>A. wkhtmltoimage.<br>这个转换起来是全屏转换，所以最初想到的是对网页做再加工，抠取出其中含有内容的一部分。
好处是，真的是所见即所得。</p><pre><code>$ wkhtmltoimage http://www.google.com google.jpg
</code></pre><p>B. html2canvas.<br>这种方案直接在html页面上做文章，添加按钮后直接用画布来生成对象。缺点是有些格式显示出来
有少量阴影。</p><p>暂时基于方案B实现。</p><h3 id=code>Code</h3><p>参考资料:<br><a href="https://www.youtube.com/watch?v=-d2FeFiBvEo">https://www.youtube.com/watch?v=-d2FeFiBvEo</a><br><a href=https://html2canvas.hertzen.com/>https://html2canvas.hertzen.com/</a></p><p>因为本博客基于hugo构建，直接修改hugo使用的主题即可添加html2canvas。</p><p>目录结构:</p><pre><code>$ ls  
config.toml  content  id_rsa.enc  scripts  static  themes
$ themes/hyde-a
$ ls
archetypes  images  layouts  LICENSE  README.md  static  theme.toml
</code></pre><p>下载<code>html2canvas.js</code>到主题的<code>static/js</code>目录:</p><pre><code>$ cd static/js
$ wget
https://github.com/niklasvh/html2canvas/releases/download/0.4.1/html2canvas.js
</code></pre><p>在主题的<code>./layouts/partials/head.html</code>文件中添加所需要的js文件及javascript代码
, (+代表新添加代码):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript>  <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css&#34;</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>+</span>  <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/javascript&#34;</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js&#34;</span><span style=color:#f92672>&gt;</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#960050;background-color:#1e0010>s</span><span style=color:#960050;background-color:#1e0010>c</span><span style=color:#960050;background-color:#1e0010>r</span><span style=color:#960050;background-color:#1e0010>i</span><span style=color:#960050;background-color:#1e0010>p</span><span style=color:#960050;background-color:#1e0010>t</span><span style=color:#960050;background-color:#1e0010>&gt;</span>
<span style=color:#f92672>+</span>  <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/javascript&#34;</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/js/html2canvas.js&#34;</span><span style=color:#f92672>&gt;</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#960050;background-color:#1e0010>s</span><span style=color:#960050;background-color:#1e0010>c</span><span style=color:#960050;background-color:#1e0010>r</span><span style=color:#960050;background-color:#1e0010>i</span><span style=color:#960050;background-color:#1e0010>p</span><span style=color:#960050;background-color:#1e0010>t</span><span style=color:#960050;background-color:#1e0010>&gt;</span>
<span style=color:#f92672>+</span>  <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;text/javascript&#39;</span><span style=color:#f92672>&gt;</span><span style=color:#75715e>//&lt;![CDATA[
</span><span style=color:#75715e></span><span style=color:#f92672>+</span>  <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>genPostShot</span>() { 
<span style=color:#f92672>+</span>          <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>rightNow</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date();
<span style=color:#f92672>+</span>          <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>imageName</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>rightNow</span>.<span style=color:#a6e22e>toISOString</span>().<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>16</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/(-)|(:)|(T)/g</span>,<span style=color:#e6db74>&#34;&#34;</span>);
<span style=color:#f92672>+</span>          <span style=color:#a6e22e>imageName</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39;.jpg&#39;</span>
<span style=color:#f92672>+</span>          <span style=color:#a6e22e>html2canvas</span>(document.<span style=color:#a6e22e>getElementsByClassName</span>(<span style=color:#e6db74>&#39;post&#39;</span>), {
<span style=color:#f92672>+</span>              <span style=color:#a6e22e>onrendered</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>canvas</span>) {
<span style=color:#f92672>+</span>  		<span style=color:#75715e>// Click them for download
</span><span style=color:#75715e></span><span style=color:#f92672>+</span>          	<span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#39;#test&#39;</span>).<span style=color:#a6e22e>attr</span>(<span style=color:#e6db74>&#39;href&#39;</span>, <span style=color:#a6e22e>canvas</span>.<span style=color:#a6e22e>toDataURL</span>(<span style=color:#e6db74>&#34;image/jpeg&#34;</span>));
<span style=color:#f92672>+</span>          	<span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#39;#test&#39;</span>).<span style=color:#a6e22e>attr</span>(<span style=color:#e6db74>&#39;download&#39;</span>,<span style=color:#a6e22e>imageName</span>);
<span style=color:#f92672>+</span>          	<span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#39;#test&#39;</span>)[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>click</span>();
<span style=color:#f92672>+</span>              }
<span style=color:#f92672>+</span>          });
<span style=color:#f92672>+</span>  }; 
<span style=color:#f92672>+</span>  <span style=color:#75715e>//]]&gt;
</span><span style=color:#75715e></span><span style=color:#f92672>+</span>  <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#960050;background-color:#1e0010>s</span><span style=color:#960050;background-color:#1e0010>c</span><span style=color:#960050;background-color:#1e0010>r</span><span style=color:#960050;background-color:#1e0010>i</span><span style=color:#960050;background-color:#1e0010>p</span><span style=color:#960050;background-color:#1e0010>t</span><span style=color:#960050;background-color:#1e0010>&gt;</span>
  <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js&#34;</span><span style=color:#f92672>&gt;</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#960050;background-color:#1e0010>s</span><span style=color:#960050;background-color:#1e0010>c</span><span style=color:#960050;background-color:#1e0010>r</span><span style=color:#960050;background-color:#1e0010>i</span><span style=color:#960050;background-color:#1e0010>p</span><span style=color:#960050;background-color:#1e0010>t</span><span style=color:#960050;background-color:#1e0010>&gt;</span>
</code></pre></div><p>简单解释一下这几行代码：</p><ol><li>取当时UTC时间作为下载jpg文件名。</li><li>在当前页面中根据div的class名称找到<code>post</code>字段，构建一个画布。</li><li>将画布内容输出为jpeg文件，触发浏览器的一个下载动作。</li></ol><p><strong>注意</strong>: <code>#test</code>为在html文件中添加的一个不可见链接.</p><p>接下来修改每个博文用到的模板文件(layourts/post/single.html):</p><pre><code>{{ partial &quot;head.html&quot; . }}
&lt;div class=&quot;content container&quot;&gt;
  &lt;div class=&quot;post&quot;&gt;
    &lt;h1&gt;{{ .Title }}&lt;/h1&gt;
+    &lt;p align=&quot;right&quot;&gt;
+    &lt;a href=&quot;javascript:genPostShot()&quot;&gt;
+	    TurnToJPG --&gt; &lt;i class=&quot;fa fa-camera-retro fa-2x&quot;&gt;&lt;/i&gt;
+    &lt;/a&gt;
+    &lt;a id=&quot;test&quot;&gt;&lt;/a&gt;
+    &lt;/p&gt;
+    &lt;hr&gt;
    &lt;span class=&quot;post-date&quot;&gt;{{ .Date.Format &quot;Jan 2, 2006&quot; }} {{ if .Site.DisqusShortname }} &amp;middot; &lt;a href=&quot;{{ .Permalink }}#disqus_thread&quot;&gt;Comments&lt;/a&gt;{{ end }}
</code></pre><p>简单解释一下上述添加的代码:</p><p>添加一个超链接，指向上文定义的javascript函数<code>genPostShot()</code>.</p><p>保存修改，提交到上游仓库，重新生成整个静态网站，现在每个博文里都含有保存图片按钮。</p><h3 id=效果>效果</h3><p>譬如，点击<a href=http://purplepalmdash.github.io/2013/11/17/run-in-winter/>http://purplepalmdash.github.io/2013/11/17/run-in-winter/</a></p><p>效果如下:</p><p><img src=/images/2016_11_05_18_56_04_638x402.jpg alt=/images/2016_11_05_18_56_04_638x402.jpg></p><p>点击按钮，下载为文件201611051057.jpg(当前UTC时间戳），效果如下:</p><p><img src=/images/2016_11_05_18_58_11_250x375.jpg alt=/images/2016_11_05_18_58_11_250x375.jpg></p><p>打完，收工，以后在盆友圈想怎么咆哮就可以怎么咆哮了。</p><h3 id=trouble-shooting>Trouble-Shooting</h3><p>之所以加这么个条目是因为，在未定义背景的网页里，有时候截出来的图是黑色背景的，修正：</p><p>修改<code>./static/js/html2canvas.js</code>文件:</p><pre><code>sTransparent = function(backgroundColor) {
  return (backgroundColor === &quot;transparent&quot; || backgroundColor === &quot;rgba(0, 0,
0, 0)&quot;);
};
</code></pre><p>改为:</p><pre><code>_html2canvas.Util.isTransparent = function(backgroundColor) {
  return (backgroundColor === &quot;transparent&quot; || backgroundColor === &quot;rgba(0, 0,
0, 0)&quot; || backgroundColor === undefined);
};
</code></pre><p>之后我们在<code>./layouts/partials/head.html</code>中，添加这一行:</p><pre><code>          html2canvas(document.getElementsByClassName('post'), {
+              background :'#FFFFFF',
              onrendered: function(canvas) {
</code></pre><p>现在生成的图片背景就是白色的了。</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2016/11/04/setuparegistryproxycachefordocker/>SetupARegistryProxyCacheForDocker</a></h1><span class=post-date>Nov 4, 2016<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=准备>准备</h3><p>首先需要准备以下Docker image:</p><pre><code>$ sudo docker pull registry:latest
$ sudo docker pull registry:2
</code></pre><p>在<code>/etc/hosts</code>里加一条记录，接下来我们将用这条记录生成签名(注意修改IP地址和域名）:</p><pre><code># echo '192.168.0.121    xxx.xxx.xxx.com'&gt;&gt;/etc/hosts
</code></pre><p>准备所需要的自签名文件(用于tls连接)</p><pre><code>mkdir -p certs &amp;&amp; openssl req   -newkey rsa:4096 -nodes -sha256 -keyout
certs/domain.key   -x509 -days 365 -out certs/domain.crt
Generating a 4096 bit RSA private key
....................................................................................................++
......++
writing new private key to 'certs/domain.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:CN
State or Province Name (full name) [Some-State]:Guangdong
Locality Name (eg, city) []:Guangzhou
Organization Name (eg, company) [Internet Widgits Pty Ltd]:DashCom
Organizational Unit Name (eg, section) []:IT
Common Name (e.g. server FQDN or YOUR name) []:xxx.xxx.xxx.com
Email Address []:xxxxxx@gmail.com
</code></pre><h3 id=启动容器>启动容器</h3><p>首先拷贝出默认的registry容器的配置文件:</p><pre><code>$ sudo mkdir -p /data
$ sudo chmod 777 -R /data
$ sudo docker run -it --rm --entrypoint cat registry:2 \
/etc/docker/registry/config.yml &gt; /data/config.yml
</code></pre><p>修改默认文件，添加<code>proxy</code>字段等，我的配置如下:</p><pre><code>version: 0.1
log:
  fields:
    service: registry
storage:
  cache:
    blobdescriptor: inmemory
  filesystem:
    rootdirectory: /var/lib/registry
http:
  addr: :5000
  tls:
    certificate: /var/lib/registry/domain.crt
    key: /var/lib/registry/domain.key
  headers:
    X-Content-Type-Options: [nosniff]
proxy:
  remoteurl: https://registry-1.docker.io
health:
  storagedriver:
    enabled: true
    interval: 10s
    threshold: 3
</code></pre><p>将上一步生成的<code>domain.crt</code>和<code>domain.key</code>文件也拷贝到/data文件夹下.</p><p>现在运行容器:</p><pre><code>$ sudo docker run -d --restart=always -p 5000:5000 --name v2-mirror  -v
/data:/var/lib/registry registry:2 /var/lib/registry/config.yml
</code></pre><p>运行完这条命令后，可以用<code>sudo netstat -anp| grep 5000</code>来检查registry服务是否被启动。</p><h3 id=使用registry服务>使用Registry服务</h3><p>在客户机上，需要做以下设置, 这里我写成脚本的方式，具体的调整需要根据实际情况:</p><pre><code>echo '192.168.0.121    xxx.xxx.xxx.com'&gt;&gt;/etc/hosts
apt-get install -y wget
mkdir -p /etc/docker/certs.d/xxx.xxx.xx.com:5000/
wget -O /etc/docker/certs.d/xxx.xxx.xxx.com:5000/ca.crt http://192.168.0.121/domain.crt
sed -i 's#fd://#fd:// --registry-mirror https://xxx.xxx.xxx.com:5000#' /lib/systemd/system/docker.service
systemctl daemon-reload
systemctl restart docker
</code></pre><p>这里的<code>http://192.168.0.121/domain.crt</code>是我把domain.crt文件放在一个web服务器上了，可以
直接拷贝现成的，改名即可。</p><p>现在测试：</p><pre><code># curl -I https://xxx.xxx.xxx.com:5000/v2 --cacert \ 
/etc/docker/certs.d/xxx.xxx.xxx.com\:5000/ca.crt 

HTTP/1.1 301 Moved Permanently
Docker-Distribution-Api-Version: registry/2.0
Location: /v2/
Date: Fri, 04 Nov 2016 09:42:41 GMT
Content-Type: text/plain; charset=utf-8
</code></pre><p>检查镜像:</p><pre><code># curl  https://xxx.xxx.xxx.com:5000/v2/_catalog --cacert \
/etc/docker/certs.d/xxx.xxx.xxx.com\:5000/ca.crt 
{&quot;&quot;:[&quot;&quot;]}
</code></pre><p>docker pull一个镜像:</p><pre><code># docker pull busybox:latest
</code></pre><p>现在检查:</p><pre><code># curl  https://xxx.xxx.xxx.com:5000/v2/_catalog --cacert \
/etc/docker/certs.d/xxx.xxx.xxx.com\:5000/ca.crt 
{&quot;repositories&quot;:[&quot;library/busybox&quot;,&quot;library/ubuntu&quot;]}
</code></pre><p>可以看到，library/busybox这个镜像已经被缓存在了本地registry仓库中。</p></div><ul class=pagination><li class=page-item><a href=/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/page/112/ class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=/>1</a></li><li class=page-item><a class=page-link href=/page/2/>2</a></li><li class=page-item><a class=page-link href=/page/3/>3</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/112/>112</a></li><li class="page-item active"><a class=page-link href=/page/113/>113</a></li><li class=page-item><a class=page-link href=/page/114/>114</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/245/>245</a></li><li class=page-item><a href=/page/114/ class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/245/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div><script src=http://purplepalmdash.github.io/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>