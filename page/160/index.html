<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta name=generator content="Hugo 0.64.0"><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Dash &#183; Dash</title><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-a.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/custom-additions.css?ref=abc124"><link rel=stylesheet href=https://purplepalmdash.github.io/css/highlight/googlecode.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script type=text/javascript src=/js/html2canvas.js></script><script type=text/javascript>function genPostShot(){var rightNow=new Date();var imageName=rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");imageName+='.jpg'
html2canvas(document.getElementsByClassName('post'),{background:'#FFFFFF',onrendered:function(canvas){$('#test').attr('href',canvas.toDataURL("image/jpeg"));$('#test').attr('download',imageName);$('#test')[0].click();}});};</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=apple-touch-icon-precomposed sizes=144x144 href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124"><link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel=icon><link href=%7balternate%20%7bRSS%20application/rss+xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/index.xml%20http://purplepalmdash.github.io/index.xml%7d rel=alternate type=application/rss+xml title="Dash &#183; Dash"><meta name=description content><meta name=keywords content="unix,virtualization,embedded,linux"></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><img src=http://purplepalmdash.github.io/images/mylogo.jpeg alt=gravatar><h1><a href=http://purplepalmdash.github.io/>很惭愧，就做了一点微小的工作</a></h1><a href=http://purplepalmdash.github.io/><p>Dash</p></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/post/>All Posts</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/technology/>Technology</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/life/>Life</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/linuxtips/>LinuxTips</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/purplepalmdash><i class="fa fa-github-square fa-3x"></i></a><a href=https://cn.linkedin.com/in/yang-feipeng-1b909319><i class="fa fa-linkedin-square fa-3x"></i></a><a href=https://plus.google.com/u/0/106572959364703833986><i class="fa fa-google-plus-square fa-3x"></i></a><a href=https://www.facebook.com/yang.feipeng><i class="fa fa-facebook-square fa-3x"></i></a><a href=https://twitter.com/dashwillfly><i class="fa fa-twitter-square fa-3x"></i></a></li></ul></div></div><div class="content container"><div class=posts><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2014/12/04/flask-and-angularjs-blog-tips/>Flask&amp;amp;AngularJS Blog Tips</a></h1><span class=post-date>Dec 4, 2014<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=background>Background</h3><p>For setup the local blog which used for recording some articles, and provide the RESTful APIs for remote usage.<br>The tutorial is located at:<br><a href=http://blog.john.mayonvolcanosoftware.com/building-a-blog-using-flask-and-angularjs-part-1/>http://blog.john.mayonvolcanosoftware.com/building-a-blog-using-flask-and-angularjs-part-1/</a></p><h3 id=installation-of-packages>Installation of Packages</h3><p>First preapare the environment using virtualenv2:</p><pre><code>$ virtualenv2 flask_blog
$ source flask_blog/bin/activate

</code></pre><p>Now write a requirements.txt file, under the current folder, the content is:</p><pre><code>Flask==0.10.1
Flask-Bcrypt==0.6.0
Flask-HTTPAuth==2.2.1
Flask-RESTful==0.2.12
Flask-SQLAlchemy==1.0
Flask-WTF==0.10.0
Jinja2==2.7.3
MarkupSafe==0.23
SQLAlchemy==0.9.7
SQLAlchemy-Utils==0.26.9
WTForms==2.0.1
WTForms-Alchemy==0.12.8
WTForms-Components==0.9.5
Werkzeug==0.9.6
aniso8601==0.83
decorator==3.4.0
infinity==1.3
intervals==0.3.1
itsdangerous==0.24
marshmallow==0.7.0
py-bcrypt==0.4
pytz==2014.4
six==1.7.3
validators==0.6.0
wsgiref==0.1.2

</code></pre><p>Use <code>pip install -r requirements.txt</code> for installing all of the packages.</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2014/12/04/trouble-shooting-on-wicd-wireless-connection/>Trouble Shooting On Wicd Wireless Connection</a></h1><span class=post-date>Dec 4, 2014<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=problem>Problem</h3><p>Could see the SSID, but could not connect to it.</p><h3 id=trouble-shooting>Trouble Shooting</h3><p>First check the log in <code>/var/log/wicd</code>:</p><pre><code>[root@TrustyArch wicd]# cat wicd.log
2014/12/04 20:32:02 :: DHCP connection successful
2014/12/04 20:32:02 :: not verifying
2014/12/04 20:32:02 :: Connecting thread exiting.
2014/12/04 20:32:03 :: Sending connection attempt result success
2014/12/04 20:34:20 :: trying to load backend external
2014/12/04 20:34:20 :: trying to load backend ioctl
2014/12/04 20:34:20 :: WARNING: python-iwscan not found, falling back to using iwlist scan.
2014/12/04 20:34:20 :: WARNING: python-wpactrl not found, falling back to using wpa_cli.

</code></pre><p>I think it&rsquo;s because the dhcpcd still alive, so manually kill this process via <code>pkill dhcpcd</code>, then re-connect again.<br>Trouble Solved.</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2014/12/03/enable-timestamp-in-new-octopress-theme/>Enable Timestamp In New Octopress Theme</a></h1><span class=post-date>Dec 3, 2014<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>After installing the flattern theme of octopress, I found the post date missed. Following is the steps for catching it back.</p><pre><code>rake install['flatten']

</code></pre><p>Modify the following file:</p><pre><code>$ cat .themes/flatten/source/_includes/post/date.html

</code></pre><p>Then in <code>.themes/flatten/source/_layouts/post.html</code>, modify the following lines:</p><pre><code>    &lt;p class=&quot;meta&quot;&gt;
    //.....//
    &lt;/p&gt;

</code></pre><p>After modification, you would see the time is displayed before the comment numbers.<br>Notice, the modification is not visible in codeblocks because the embedded symbol could not be resolved thus will cause build error, so the detailed code would be only fetched from my github repository but remains blank codeblocks here in this article.</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2014/12/03/use-docker-for-deploying-wp/>Use Docker for deploying WP</a></h1><span class=post-date>Dec 3, 2014<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>Just for swiftly deploy WP and test the RESTful API, I did following operations and runs a WP temporately.</p><h3 id=pull>PULL</h3><p>Pull following containers:</p><pre><code>$ docker pull mysql
$ docker pull wordpress
$ sudo docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
&lt;none&gt;              &lt;none&gt;              480ac552cd39        About an hour ago   192.8 MB
mysql               latest              98840bbb442c        39 hours ago        235.5 MB
wordpress           latest              9f51af77fd96        8 days ago          470.5 MB

</code></pre><h3 id=configuration>Configuration</h3><p>Explanation for following commands, <code>--name</code> is the name for our container, <code>-p 8038:80</code> is mapping the host machine&rsquo;s 8038 port to container <code>wordpress_1</code>:</p><pre><code>$ docker run --name mysql_1 -e MYSQL_ROOT_PASSWORD=xxxx -d mysql
$ docker run --name wordpress_1 --link mysql_1:mysql -p 8038:80 -d wordpress

</code></pre><p>Now open your browser to <code>http://localhost:8038</code> and you got the wordpress installation window.</p><h3 id=wp>WP</h3><p>After we installed WP, we could install JSON REST API from:<br><a href=https://wordpress.org/plugins/json-rest-api/>https://wordpress.org/plugins/json-rest-api/</a><br>After installation, we could test the REST API via curl:</p><pre><code>TBD

</code></pre><h3 id=view-docker-status>View Docker status</h3><p>First we should grab the docker&rsquo;s PID via following command:</p><pre><code>$ docker  inspect  --format &quot;{{ .State.Pid }}&quot;  mysql_1 
28254
$ docker  inspect  --format &quot;{{ .State.Pid }}&quot;  wordpress_1
28754

</code></pre><p>Then we could nsenter the docker container and view its status:</p><pre><code>$ sudo nsenter --target 28254 --mount --uts --ipc --net --pid -- /bin/bash
$ sudo nsenter --target 28754 --mount --uts --ipc --net --pid -- /bin/bash

</code></pre><p>In the &lsquo;attached&rsquo; environment we could inspect the status for corresponding services.</p><h3 id=stop-docker-contains>Stop docker contains</h3><p>via <code>docker stop</code> we could simply stop the docker container:</p><pre><code>[Trusty@~/code/30days/Docker]$ sudo docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                  NAMES
0995854e2144        wordpress:latest    &quot;/entrypoint.sh apac   About an hour ago   Up About an hour    0.0.0.0:8038-&gt;80/tcp   wordpress_1         
99d257ad6e24        mysql:latest        &quot;/entrypoint.sh mysq   About an hour ago   Up About an hour    3306/tcp               mysql_1             
[Trusty@~/code/30days/Docker]$ docker stop 0995854e2144
0995854e2144
[Trusty@~/code/30days/Docker]$ docker stop 99d257ad6e24
99d257ad6e24
[Trusty@~/code/30days/Docker]$ sudo docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES

</code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2014/12/03/yong-flaskda-jian-ni-zi-ji-de-restful-api/>用Flask搭建你自己的Restful API</a></h1><span class=post-date>Dec 3, 2014<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=背景>背景</h3><p>最近在过一个《30天学习30种新技术》，过到第10天用Phonegap开发APP的时候，发现作者提供的API不可用，所以费心研究了一下Restful API, 顺利构建出了环境写完了那个APP，下面是一些摘要。<br>我用的Tutorial来自这里：<br><a href=http://blog.miguelgrinberg.com/post/designing-a-restful-api-with-python-and-flask>http://blog.miguelgrinberg.com/post/designing-a-restful-api-with-python-and-flask</a><br>开发环境是ArchLinux.</p><h3 id=hello-flask>Hello Flask</h3><p>原Tutorial中给出的是一个关于todo-list的实现，我们从最简单的"Hello Flask"开始：<br>首先安装python虚拟环境和flask，注意因为Arch默认的python版本是3，所以这里我们使用了virtualenv2来创建python虚拟运行环境。</p><pre><code>$ mkdir todo-api
$ cd todo-api
$ virtualenv2 flask
$ source flask/bin/activate
(flask) $ pip install flask

</code></pre><p>在当前目录下建立<code>app.py</code>文件， 输入以下内容：</p><pre><code>#!flask/bin/python
from flask import Flask

app = Flask(__name__)

@app.route('/')
def index():
    return &quot;Hello, Flask!&quot;

if __name__ == '__main__':
    app.run(debug=True)

</code></pre><p>现在改变文件属性，运行之:</p><pre><code>$ chmod a+x app.py
$ ./app.py

</code></pre><p>打开浏览器访问<code>http://127.0.0.1:5000</code>,，我们可以看到Hello Flask已经出现在浏览器里了。</p><h3 id=实现最简单的restful-api>实现最简单的Restful API</h3><p>Flask本身支持很多插件，可以用于实现Restful API，由于我们这里只是做DEMO使用，需求比较简单，我们抛弃那些繁琐的插件，手动来写。<br>这里我们也不会引入数据库等内容，我们将task任务列表直接保存在内存中，所以一旦断电这些数据就将消失。在实际的生产环境中，我们是需要引入不同的数据库来存储这些数据的。<br>在上面生成的<code>app.py</code>中添加以下内容:</p><pre><code>#!flask/bin/python
from flask import Flask, jsonify

app = Flask(__name__)

tasks = [
    {
        'id': 1,
        'title': u'Buy groceries',
        'description': u'Milk, Cheese, Pizza, Fruit, Tylenol', 
        'done': False
    },
    {
        'id': 2,
        'title': u'Learn Python',
        'description': u'Need to find a good Python tutorial on the web', 
        'done': False
    }
]

@app.route('/todo/api/v1.0/tasks', methods=['GET'])

def get_tasks():
    return jsonify({'tasks': tasks})

if __name__ == '__main__':
    app.run(debug=True)

</code></pre><p>现在打开终端，用curl就可以访问到我们新添加的API了:</p><pre><code>$ curl -i http://127.0.0.1:5000/todo/api/v1.0/tasks
HTTP/1.0 200 OK
Content-Type: application/json
Content-Length: 316
Server: Werkzeug/0.9.6 Python/2.7.8
Date: Wed, 03 Dec 2014 08:59:55 GMT

{
  &quot;tasks&quot;: [
    {
      &quot;description&quot;: &quot;Milk, Cheese, Pizza, Fruit, Tylenol&quot;, 
      &quot;done&quot;: false, 
      &quot;id&quot;: 1, 
      &quot;title&quot;: &quot;Buy groceries&quot;
    }, 
    {
      &quot;description&quot;: &quot;Need to find a good Python tutorial on the web&quot;, 
      &quot;done&quot;: false, 
      &quot;id&quot;: 2, 
      &quot;title&quot;: &quot;Learn Python&quot;
    }
  ]
}% 

</code></pre><p>第一个Restful的API就这样创建成功了。</p><h3 id=添加第二个restful-api>添加第二个RESTful API</h3><p>我们接着来添加第二个RESTful API, 加入下列代码到已有的<code>app.py</code>中:</p><pre><code>from flask import abort

@app.route('/todo/api/v1.0/tasks/&lt;int:task_id&gt;', methods=['GET'])
def get_task(task_id):
    task = filter(lambda t: t['id'] == task_id, tasks)
    if len(task) == 0:
        abort(404)
    return jsonify({'task': task[0]})

</code></pre><p>现在用curl来测试，结果应该是这样的:</p><pre><code>(flask)[Trusty@~/code/30days/todo-api]$ curl -i http://127.0.0.1:5000/todo/api/v1.0/tasks/2
HTTP/1.0 200 OK
Content-Type: application/json
Content-Length: 151
Server: Werkzeug/0.9.6 Python/2.7.8
Date: Wed, 03 Dec 2014 09:10:25 GMT

{
  &quot;task&quot;: {
    &quot;description&quot;: &quot;Need to find a good Python tutorial on the web&quot;, 
    &quot;done&quot;: false, 
    &quot;id&quot;: 2, 
    &quot;title&quot;: &quot;Learn Python&quot;
  }
}%                                                                                                                                                   (flask)[Trusty@~/code/30days/todo-api]$ curl -i http://127.0.0.1:5000/todo/api/v1.0/tasks/3
HTTP/1.0 404 NOT FOUND
Content-Type: text/html
Content-Length: 233
Server: Werkzeug/0.9.6 Python/2.7.8
Date: Wed, 03 Dec 2014 09:10:27 GMT

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 3.2 Final//EN&quot;&gt;
&lt;title&gt;404 Not Found&lt;/title&gt;
&lt;h1&gt;Not Found&lt;/h1&gt;
&lt;p&gt;The requested URL was not found on the server.  If you entered the URL manually please check your spelling and try again.&lt;/p&gt;

</code></pre><p>由于我们引用了abort方法，所以当我们给出的task id错误时，将弹出404错误。</p><h3 id=错误提示json化>错误提示JSON化</h3><p>通过引入<code>make_response</code>模块我们可以把404返回错误JSON化，添加以下代码到app.py中：</p><pre><code>from flask import make_response

@app.errorhandler(404)
def not_found(error):
    return make_response(jsonify({'error': 'Not found'}), 404)

</code></pre><p>现在访问一个不存在的task id将返回如下结果：</p><pre><code>(flask)[Trusty@~/code/30days/todo-api]$ curl -i http://127.0.0.1:5000/todo/api/v1.0/tasks/3
HTTP/1.0 404 NOT FOUND
Content-Type: application/json
Content-Length: 26
Server: Werkzeug/0.9.6 Python/2.7.8
Date: Wed, 03 Dec 2014 09:16:50 GMT

{
  &quot;error&quot;: &quot;Not found&quot;
}%             

</code></pre><h3 id=实现post方法>实现POST方法</h3><p>添加以下代码以实现POST方法:</p><pre><code>from flask import request

@app.route('/todo/api/v1.0/tasks', methods=['POST'])
def create_task():
    if not request.json or not 'title' in request.json:
        abort(400)
    task = {
        'id': tasks[-1]['id'] + 1,
        'title': request.json['title'],
        'description': request.json.get('description', &quot;&quot;),
        'done': False
    }
    tasks.append(task)
    return jsonify({'task': task}), 201

</code></pre><p>用curl测试的结果如下：</p><pre><code>(flask)[Trusty@~/code/30days/todo-api]$ curl -i -H &quot;Content-Type: application/json&quot; -X POST -d '{&quot;title&quot;:&quot;Read a book&quot;}' http://127.0.0.1:5000/todo/api/v1.0/tasks
HTTP/1.0 201 CREATED
Content-Type: application/json
Content-Length: 104
Server: Werkzeug/0.9.6 Python/2.7.8
Date: Wed, 03 Dec 2014 09:18:55 GMT

{
  &quot;task&quot;: {
    &quot;description&quot;: &quot;&quot;, 
    &quot;done&quot;: false, 
    &quot;id&quot;: 3, 
    &quot;title&quot;: &quot;Read a book&quot;
  }
}% 
 (flask)[Trusty@~/code/30days/todo-api]$ curl -i http://127.0.0.1:5000/todo/api/v1.0/tasks 
HTTP/1.0 200 OK
Content-Type: application/json
Content-Length: 423
Server: Werkzeug/0.9.6 Python/2.7.8
Date: Wed, 03 Dec 2014 09:19:24 GMT

{
  &quot;tasks&quot;: [
    {
      &quot;description&quot;: &quot;Milk, Cheese, Pizza, Fruit, Tylenol&quot;, 
      &quot;done&quot;: false, 
      &quot;id&quot;: 1, 
      &quot;title&quot;: &quot;Buy groceries&quot;
    }, 
    {
      &quot;description&quot;: &quot;Need to find a good Python tutorial on the web&quot;, 
      &quot;done&quot;: false, 
      &quot;id&quot;: 2, 
      &quot;title&quot;: &quot;Learn Python&quot;
    }, 
    {
      &quot;description&quot;: &quot;&quot;, 
      &quot;done&quot;: false, 
      &quot;id&quot;: 3, 
      &quot;title&quot;: &quot;Read a book&quot;
    }
  ]
}%           

</code></pre><p>从上面的测试中我们可以看到一个新的任务被添加到了task列表中。</p><h3 id=最后两个restful-api>最后两个RESTful API</h3><p>最后的两个RESTful API代码如下:</p><pre><code>@app.route('/todo/api/v1.0/tasks/&lt;int:task_id&gt;', methods=['PUT'])
def update_task(task_id):
    task = filter(lambda t: t['id'] == task_id, tasks)
    if len(task) == 0:
        abort(404)
    if not request.json:
        abort(400)
    if 'title' in request.json and type(request.json['title']) != unicode:
        abort(400)
    if 'description' in request.json and type(request.json['description']) is not unicode:
        abort(400)
    if 'done' in request.json and type(request.json['done']) is not bool:
        abort(400)
    task[0]['title'] = request.json.get('title', task[0]['title'])
    task[0]['description'] = request.json.get('description', task[0]['description'])
    task[0]['done'] = request.json.get('done', task[0]['done'])
    return jsonify({'task': task[0]})

@app.route('/todo/api/v1.0/tasks/&lt;int:task_id&gt;', methods=['DELETE'])
def delete_task(task_id):
    task = filter(lambda t: t['id'] == task_id, tasks)
    if len(task) == 0:
        abort(404)
    tasks.remove(task[0])
    return jsonify({'result': True})

</code></pre><p>测试代码如下：</p><pre><code>$ curl -i -H &quot;Content-Type: application/json&quot; -X PUT -d '{&quot;done&quot;:true}' http://127.0.0.1:5000/todo/api/v1.0/tasks/2

</code></pre><p>运行上面的命令可以将第2条记录里的done字段由false改成true.</p><h3 id=改进接口>改进接口</h3><p>加入以下代码后，我们调用tasks方法将不再返回id,而是返回URIs，这样取回来就能用了。</p><pre><code>from flask import url_for

def make_public_task(task):
    new_task = {}
    for field in task:
        if field == 'id':
            new_task['uri'] = url_for('get_task', task_id=task['id'], _external=True)
        else:
            new_task[field] = task[field]
    return new_task

</code></pre><p>同时我们重写以下方法:</p><pre><code>@app.route('/todo/api/v1.0/tasks', methods=['GET'])
def get_tasks():
    return jsonify({'tasks': map(make_public_task, tasks)})

</code></pre><p>测试结果如下：</p><pre><code>$ curl -i http://127.0.0.1:5000/todo/api/v1.0/tasks
HTTP/1.0 200 OK
Content-Type: application/json
Content-Length: 406
Server: Werkzeug/0.9.6 Python/2.7.8
Date: Wed, 03 Dec 2014 09:32:12 GMT

{
  &quot;tasks&quot;: [
    {
      &quot;description&quot;: &quot;Milk, Cheese, Pizza, Fruit, Tylenol&quot;, 
      &quot;done&quot;: false, 
      &quot;title&quot;: &quot;Buy groceries&quot;, 
      &quot;uri&quot;: &quot;http://127.0.0.1:5000/todo/api/v1.0/tasks/1&quot;
    }, 
    {
      &quot;description&quot;: &quot;Need to find a good Python tutorial on the web&quot;, 
      &quot;done&quot;: false, 
      &quot;title&quot;: &quot;Learn Python&quot;, 
      &quot;uri&quot;: &quot;http://127.0.0.1:5000/todo/api/v1.0/tasks/2&quot;
    }
  ]
}% 

</code></pre><h3 id=加密restful网络接口>加密RESTful网络接口</h3><p>好了，我们的RESTful接口搭建完毕了，但是由于接口对所有人都是开放的，为了考虑安全因素，我们会采用简单加密。<br>首先安装flask-httpauth模块:</p><pre><code>$ pip install flask-httpauth

</code></pre><p>而后添加以下代码：</p><pre><code>from flask.ext.httpauth import HTTPBasicAuth
auth = HTTPBasicAuth()

@auth.get_password
def get_password(username):
    if username == 'miguel':
        return 'python'
    return None

@auth.error_handler
def unauthorized():
    return make_response(jsonify({'error': 'Unauthorized access'}), 401)

</code></pre><p>加密路由实现如下：</p><pre><code>@app.route('/todo/api/v1.0/tasks', methods=['GET'])
@auth.login_required
def get_tasks():
    return jsonify({'tasks': tasks})

</code></pre><p>测试结果如下, 未通过授权时:</p><pre><code>$ curl -i http://localhost:5000/todo/api/v1.0/tasks                 
HTTP/1.0 401 UNAUTHORIZED
Content-Type: application/json
Content-Length: 36
WWW-Authenticate: Basic realm=&quot;Authentication Required&quot;
Server: Werkzeug/0.9.6 Python/2.7.8
Date: Wed, 03 Dec 2014 09:40:02 GMT

{
  &quot;error&quot;: &quot;Unauthorized access&quot;
}%   

</code></pre><p>通过授权时:</p><pre><code>$ curl -u miguel:python -i http://localhost:5000/todo/api/v1.0/tasks
HTTP/1.0 200 OK
Content-Type: application/json
Content-Length: 406
Server: Werkzeug/0.9.6 Python/2.7.8
Date: Wed, 03 Dec 2014 09:40:24 GMT

{
  &quot;tasks&quot;: [
    {
      &quot;description&quot;: &quot;Milk, Cheese, Pizza, Fruit, Tylenol&quot;, 
      &quot;done&quot;: false, 
      &quot;title&quot;: &quot;Buy groceries&quot;, 
      &quot;uri&quot;: &quot;http://localhost:5000/todo/api/v1.0/tasks/1&quot;
    }, 
.....

</code></pre><p>我们可以把出错时返回的错误号从401改变为403,这样返回的就是forbidden错误。</p></div><ul class=pagination><li class=page-item><a href=/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/page/159/ class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=/>1</a></li><li class=page-item><a class=page-link href=/page/2/>2</a></li><li class=page-item><a class=page-link href=/page/3/>3</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/159/>159</a></li><li class="page-item active"><a class=page-link href=/page/160/>160</a></li><li class=page-item><a class=page-link href=/page/161/>161</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/232/>232</a></li><li class=page-item><a href=/page/161/ class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/232/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div><script src=http://purplepalmdash.github.io/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>