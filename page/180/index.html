<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
	<meta name="generator" content="Hugo 0.65.1" />
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Dash &middot; Dash</title>

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="https://purplepalmdash.github.io/css/poole.css?ref=abc124">
  <link rel="stylesheet" href="https://purplepalmdash.github.io/css/hyde.css?ref=abc124">
  <link rel="stylesheet" href="https://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124">
  <link rel="stylesheet" href="https://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124">
  <link rel="stylesheet" href="https://purplepalmdash.github.io/css/hyde-a.css?ref=abc124">
  <link rel="stylesheet" href="https://purplepalmdash.github.io/css/custom-additions.css?ref=abc124">
  <link rel="stylesheet" href="https://purplepalmdash.github.io/css/highlight/googlecode.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script type="text/javascript" src="/js/html2canvas.js"></script>
  <script type='text/javascript'>
  function genPostShot() { 
          var rightNow = new Date();
          var imageName = rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");
          imageName += '.jpg'
          html2canvas(document.getElementsByClassName('post'), {
              background :'#FFFFFF',
              onrendered: function(canvas) {
  		
          	$('#test').attr('href', canvas.toDataURL("image/jpeg"));
          	$('#test').attr('download',imageName);
          	$('#test')[0].click();
              }
          });
  }; 
  
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124">
  <link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel="icon">

  
  
  
  <link href="%7balternate%20%7bRSS%20application/rss&#43;xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/index.xml%20http://purplepalmdash.github.io/index.xml%7d" rel="alternate" type="application/rss+xml" title="Dash &middot; Dash" />
  <meta name="description" content="">
  <meta name="keywords" content="unix,virtualization,embedded,linux">
  
  
</head>
<body class="theme-base-0c">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <img src="http://purplepalmdash.github.io/images/mylogo.jpeg" alt="gravatar">
      <h1><a href="http://purplepalmdash.github.io/">Get busy living, or get busy dying.</a></h1>
      <a href="http://purplepalmdash.github.io/"><p>Dash</p></a>
    </div>

    <ul class="sidebar-nav">
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/post/">All Posts</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/technology/">Technology</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/life/">Life</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/linuxtips/">LinuxTips</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/purplepalmdash"><i class="fa fa-github-square fa-3x"></i></a>
      
      <a href="https://cn.linkedin.com/in/yang-feipeng-1b909319"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="https://plus.google.com/u/0/106572959364703833986"><i class="fa fa-google-plus-square fa-3x"></i></a>
      <a href="https://www.facebook.com/yang.feipeng"><i class="fa fa-facebook-square fa-3x"></i></a>
      <a href="https://twitter.com/dashwillfly"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      </li>
    </ul>

    

  </div>
</div>


<div class="content container">
  <div class="posts">
    
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2014/04/09/command-and-conquer-2/">Command and Conquer 2</a>
      </h1>
      <span class="post-date">Apr 9, 2014 
      
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/technology">Technology</a>
        
      </span>
      
      <h3 id="position">Position</h3>
<p>From FullCircle issue 24, to issue 55</p>
<h3 id="cc-11">C&amp;C 11</h3>
<p>This chapter tells you how to automatical your tasks using crontab. <br>
Useful commands</p>
<pre><code>	find /var/logs/ -name &quot;*.log&quot; | while read line; do cat &quot;${line}&quot;; done
	sudo crontab -e root

</code></pre><p>crontab format:  <br>
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <br>
Example:  <br>
*/5 * * * * command     Every 5 minutes <br>
00 18 * * sun command   Every Sunday at 6</p>
<ul>
<li>*/2 * * * command     Every 2 hours <br>
Further reading: <br>
Python version of script for those interested:  <br>
<a href="http://lswest.pastebin.com/m5b536464">http://lswest.pastebin.com/m5b536464</a> <br>
Bash script tutorial: <br>
<a href="http://www.linux.org/docs/ldp/howto/Bash-Prog-Intro-HOWTO.html">http://www.linux.org/docs/ldp/howto/Bash-Prog-Intro-HOWTO.html</a> <br>
Cron tutorial:  <br>
<a href="http://www.clickmojo.com/code/cron-tutorial.html">http://www.clickmojo.com/code/cron-tutorial.html</a></li>
</ul>
<h3 id="cc-12">C&amp;C 12</h3>
<p>This Chapter tells you how to use different shell, and its history, functions.</p>
<h3 id="cc-13">C&amp;C 13</h3>
<p>This chapter tell you how to listen music using MOC(Music On Console), and use IRC under terminal(irssi), later I will install them and try.</p>
<h3 id="cc-14">C&amp;C 14</h3>
<p>This chapter introduce how to change you prompt,(export PS1), some useful tools, for example: <br>
&ldquo;watch vmstat&rdquo; will display the vmstat every 2 seconds.  <br>
Tiling window manager, awesome, DWM, Xmodnad, ratpoison, ion, etc.  <br>
Live-Office?</p>
<h3 id="cc-15">C&amp;C 15</h3>
<p>This chapter take ping for example and show you how to use man and help.</p>
<h3 id="cc-16">C&amp;C 16</h3>
<p>This chapter shows how to detect and bind keys. <br>
xev for X, showkey for terminal, for detecting keys. <br>
.Xmodmap for key definition,    keycode 153 = XF86MonBrightnessDown <br>
/usr/include/X11/keysymdef.h contains all of the list of the symbols, extra function keys in /usr/include/X11/XKeySymDB <br>
Further Reading: <a href="http://people.freedesktop.org/~hughsient/quirk/quirk-keymap-index.html">http://people.freedesktop.org/~hughsient/quirk/quirk-keymap-index.html</a></p>
<h3 id="cc-17">C&amp;C 17</h3>
<p>This chapter shows disk usage skills.</p>
<h3 id="cc-18">C&amp;C 18</h3>
<p>This chapter introduce harddisk and S.M.A.R.T</p>
<h3 id="cc-19">C&amp;C 19</h3>
<p>This chapter introduct screen, remember use ctlr+a /d for detaching the session.</p>
<h3 id="cc-20">C&amp;C 20</h3>
<p>This chapter continue introducing screen, for sharing session: <br>
ctrl + a :multiuser on ctrl+a :acladd <!-- raw HTML omitted --> <br>
Other user connect via screen -x $USER/&lt;screenID/name&gt; <br>
Other different commands.</p>
<h3 id="cc-21">C&amp;C 21</h3>
<p>Introducing Tmux for remote usage.Also byobu is introduced.</p>
<h3 id="cc-22">C&amp;C 22</h3>
<p>Switch to ZSH, need to re-read after back.</p>
<h3 id="cc-23">C&amp;C 23</h3>
<p>Colorscheme, need to re-read after back.</p>
<h3 id="cc-24">C&amp;C 24</h3>
<p>Talks on how to set ssh proxy.</p>
<h3 id="cc-25">C&amp;C 25</h3>
<p>gstm of GUI program which did ssh port forwarding.  <br>
diff usage</p>
<h3 id="cc-26">C&amp;C 26</h3>
<p>wget and curl, use it according to your own habit.</p>
<h3 id="cc-27">C&amp;C 27</h3>
<p>Network Configuration.</p>
<h3 id="cc-28">C&amp;C 28</h3>
<p>fdisk, find, etc.</p>
<h3 id="cc-29">C&amp;C 29</h3>
<p>Classic Command List.</p>
<h3 id="cc-30">C&amp;C 30</h3>
<p>Language for System.</p>
<h3 id="cc-31">C&amp;C 31</h3>
<p>conky skills, let conky display how many updates available.</p>
<h3 id="cc-32">C&amp;C 32</h3>
<p>Conky skills, his conky could display the listening music and album picture.But how about the pandora?</p>
<h3 id="cc-33">C&amp;C 33</h3>
<p>Conky skills, to-do and the zenity for creating the diaglog.</p>
<h3 id="cc-34">C&amp;C 34</h3>
<p>zenity configuration, MPD daemon.</p>
<h3 id="cc-35">C&amp;C 35</h3>
<p>Asia Language support, in fact we are much more professionaler than the author :)</p>
<h3 id="cc-36">C&amp;C 36</h3>
<p>Use of graphicmagic, which derived from imagik from 2002, try it later.</p>
<h3 id="cc-37">C&amp;C 37</h3>
<p>Latex Introduction.</p>
<h3 id="cc-38">C&amp;C 38</h3>
<p>Issue 51, damaged.</p>
<h3 id="cc-40">C&amp;C 40</h3>
<p>Latex continued.</p>
<h3 id="cc-41">C&amp;C 41</h3>
<p>/etc/motd(Message Of The Day)</p>
<h3 id="cc-42">C&amp;C 42</h3>
<p>vim/gvim, notice some command, and author&rsquo;s vimrc file.</p>
<h3 id="cc-43">C&amp;C 43</h3>
<p>Advance usage of vi/vim , TBD</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2014/04/08/command-and-conquer-1/">Command and Conquer 1</a>
      </h1>
      <span class="post-date">Apr 8, 2014 
      
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/technology">Technology</a>
        
      </span>
      
      <p>###Position:
From FullCircle 13, Ended at FullCircle 23.  <br>
###C&amp;C 1
Try to run following command:</p>
<pre><code>man man
man -k PDF
man apropos
apropos PDF
man --help

</code></pre><p>Fastly get help from manual, for example, following command will let you dive into regex:</p>
<pre><code>man -k regex
re_comp (3)          - BSD regex functions
re_exec (3)          - BSD regex functions
regcomp (3)          - POSIX regex functions
regerror (3)         - POSIX regex functions
regex (3)            - POSIX regex functions
regex (7)            - POSIX.2 regular expressions
regexec (3)          - POSIX regex functions
regfree (3)          - POSIX regex functions

</code></pre><p>###C&amp;C 2
This part describe how to come and go into the directory.
###C&amp;C 3
This part describe how to copy and move the file.  <br>
###C&amp;C 4
This part introduce the nano and vim. Remember one: :e in vim means edit another file.  <br>
###C&amp;C 5
This part introduce aptitude, Notice the comment of the aptitude search result:</p>
<ol>
<li>p, No trace of the package exists on the system.</li>
<li>c, The package is deleted, but its configuration file is still on the system.</li>
<li>i, The package is installed.</li>
<li>v, The package is virtual. <br>
And one command: sudo aptitude safe-upgrade.  <br>
###C&amp;C 6
This part shows how to find something in your system.</li>
<li>grep, &ldquo;grep -n&rdquo;(print line number),  &ldquo;grep -ir&rdquo;(recursively and ignore case).</li>
<li>*, difference of &ldquo;echo <em>&rdquo; and &ldquo;echo &lsquo;</em>'&quot;.</li>
<li>xargs,</li>
</ol>
<pre><code>find recipes -type f -name '*-cake.txt' | xargs -I % cp % old-recipes/
find recipes -type f -name '*-cake.txt'
recipes/a-cake.txt
recipes/b-cake.txt
recipes/c-cake.txt
cp recipes/a-cake.txt old-recipes/
cp recipes/b-cake.txt old-recipes/
cp recipes/c-cake.txt old-recipes/

</code></pre><ol start="4">
<li>updatedb and locate.  <br>
###C&amp;C 7
The author talks lots on why you should not fear terminal. <br>
###C&amp;C 8</li>
<li>cut way:</li>
</ol>
<pre><code>Trusty@HN:~/code/purec/FC/C8$ cat /etc/issue
Ubuntu 13.04 \n \l

Trusty@HN:~/code/purec/FC/C8$ cat /etc/issue|head -n 1
Ubuntu 13.04 \n \l
Trusty@HN:~/code/purec/FC/C8$ cat /etc/issue|head -n 1|cut --delimiter=&quot; &quot; -f 1,2
Ubuntu 13.04

</code></pre><ol start="2">
<li>sed way:</li>
</ol>
<pre><code>Trusty@HN:~/code/purec/FC/C8$ cat /etc/issue | sed '{s/\\n//}'
Ubuntu 13.04  \l

Trusty@HN:~/code/purec/FC/C8$ cat /etc/issue | sed '{s/\\n//; s/\\l//;}'
Ubuntu 13.04  

Trusty@HN:~/code/purec/FC/C8$ cat /etc/issue | sed '{s/\\n//; s/\\l//;/^$/d}'
Ubuntu 13.04  

</code></pre><ol start="3">
<li>awk way:</li>
</ol>
<pre><code>Trusty@HN:~/code/purec/FC/C8$ cat /etc/issue | awk '/\\n/ {print $1,$2}'
Ubuntu 13.04

</code></pre><p>First find any line which have &lsquo;\n&rsquo; in it, then print this line&rsquo;s $1 and $2. <br>
4. Further reading <br>
<a href="http://fullcirclemagazine.org/issue-21-shell-script/">http://fullcirclemagazine.org/issue-21-shell-script/</a> <br>
Sed -http://www.grymoire.com/Unix/Sed.html <br>
awk -http://www.linuxjournal.com/article/8913 or <a href="http://www.linuxfocus.org/English/September1999/article103.html">http://www.linuxfocus.org/English/September1999/article103.html</a> <br>
cut -http://learnlinux.tsf.org.za/courses/build/shell-scripting/ch03s04.html <br>
###C&amp;C 9
This part introduced the ffmpeg and imagick.  <br>
Since the internet is not OK, I cannot install the package, try them later. <br>
###C&amp;C 10
This part is very useful, it shows some system administration tools.</p>
<ol>
<li>bootchart, install via &ldquo;sudo apt-get install bootchart&rdquo;, then in /var/log/bootchart/ you will see the correct image.</li>
<li>sudo lshw will list all of the hw info, sudo lshw -C Network will list all of the infos on networking.</li>
<li>Further reading: <a href="http://www.troubleshooters.com/tpromag/200007/200007.htm">http://www.troubleshooters.com/tpromag/200007/200007.htm</a></li>
</ol>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2014/04/08/programming-in-c-of-fc-tutorial-6/">Programming in C of FC tutorial 6</a>
      </h1>
      <span class="post-date">Apr 8, 2014 
      
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/technology">Technology</a>
        
      </span>
      
      <p>###Full Circle C 8
####Limitation
Fibonacci sequence: normally this program limited by the limitation of unsigned long long</p>
<pre><code>#include &lt;stdio.h&gt;

typedef unsigned long long fibo_type;
#define FIBO_FORMAT &quot;%10llu&quot;

void printFibo(fibo_type num)
{
        printf(FIBO_FORMAT, num);
}

int main()
{
        int num = 0;
        fibo_type a = 0, b=1, c;

        printf(&quot;%4d: &quot;, ++num);
        printFibo(a);
        printf(&quot;\n&quot;);

        printf(&quot;%4d: &quot;,++num);
        printFibo(b);
        printf(&quot;\n&quot;);

        c=a+b;
        while(c&gt;=b)
        {
                printf(&quot;%4d: &quot;,++num);
                printFibo(c);
                printf(&quot;\n&quot;);
                a=b;
                b=c;
                c=a+b;
        }

        printf(&quot;Stopped after %d digits\n&quot;, num);
        printFibo(c);
        printf(&quot;\n&quot;);
        return 0;
}

</code></pre><p>This program will exit when c reach the limitation of definition of unsigned long long
####Using GMP
Using gmp to re-write this program:</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;gmp.h&gt;

int main()
{
        int num = 0;
        mpz_t f_1;
        mpz_t f_2;

        mpz_init(f_1);
        mpz_init(f_2);
        mpz_set_ui(f_1, 0);
        mpz_set_ui(f_1, 1);
        printf(&quot;%10d: 0\n&quot;, ++num);

        while(1)
        {
                mpz_add(f_1, f_2, f_1);
                mpz_swap(f_1, f_2);
                char *res = mpz_get_str(NULL, 10, f_2);
                printf(&quot;%10d: %s\n&quot;, ++num, res);
                free(res);
                sleep(1);
        }

        mpz_clear(f_1);
        mpz_clear(f_2);
        return 0;
}

</code></pre><p>Compile it via:</p>
<pre><code>gcc -o Fibonacci2 Fibonacci2.c -lgmp

</code></pre><p>This won&rsquo;t have limitation currently, but you have to finish the execises, when you get internet connection.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2014/04/08/programming-in-c-of-fc-tutorial-5/">Programming in C of FC tutorial 5</a>
      </h1>
      <span class="post-date">Apr 8, 2014 
      
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/technology">Technology</a>
        
      </span>
      
      <p>###Full Circle C 7
####Example
Following is the origin ifstat.c, this program will list the net-interface payloads, and it will print out the net interface statistics every 2 seconds, but notice this program have several bugs:</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
typedef unsigned long long ull;
int parseDevFile(const char * iface, ull *bRx, ull *pRx, ull *bTx, ull *pTx);
void dumpInterfaceUsage(const char * iface);
int parseDevFile(const char * iface, ull *bRx, ull *pRx, ull *bTx, ull *pTx)
{
        FILE * fp = NULL;
        char * line = NULL;
        unsigned int len = 0;
        fp = fopen(&quot;/proc/net/dev&quot;, &quot;r&quot;);
        if(fp == NULL)
        {
                return -1;
        }
        while(getline(&amp;line, &amp;len, fp) != -1)
        {
                if(strstr(line, iface) != NULL)
                {
                        sscanf(strstr(line, &quot;:&quot;)+1, &quot;%llu%llu%*u%*u%*u%*u%*u%*u%llu%llu&quot;, bRx, pRx, bTx, pTx);
                }
        }
        fclose(fp);
        free(line);
        return 0;
}
void dumpInterfaceUsage(const char * iface)
{
        ull ifaceBRxOld = 0, ifaceBTxOld = 0, ifacePRxOld = 0, ifacePTxOld = 0;
        ull ifaceBRxNew = 0, ifaceBTxNew = 0, ifacePRxNew = 0, ifacePTxNew = 0;
        const int SLEEP_TIME = 2;

        if(parseDevFile(iface, &amp;ifaceBRxOld, &amp;ifacePRxOld, &amp;ifaceBTxOld, &amp;ifacePTxOld) == -1) return;
        sleep(SLEEP_TIME);
        while(1)
        {
                if(parseDevFile(iface, &amp;ifaceBRxNew, &amp;ifacePRxNew, &amp;ifaceBTxNew, &amp;ifacePTxNew) == -1) return;
                printf(&quot;%s In: %8.2f kbytes/s  %5llu P/s Out: %8.2f kbytes/s %5llu P/s\n&quot;, iface,
                                (ifaceBRxNew - ifaceBRxOld)/(SLEEP_TIME *1024.0),
                                (ifacePRxNew - ifacePRxOld)/(SLEEP_TIME),
                                (ifaceBTxNew - ifaceBTxOld)/(SLEEP_TIME *1024.0),
                                (ifacePTxNew - ifacePTxOld)/(SLEEP_TIME));
                ifaceBRxOld = ifaceBRxNew;
                ifaceBTxOld = ifaceBTxNew;
                ifacePRxOld = ifacePRxNew;
                ifacePTxOld = ifacePTxNew;
                sleep(SLEEP_TIME);
        }
}

int main(int argc, char **argv)
{
        if(argc != 2)
        {
                printf(&quot;Usage: %s interfacename\n&quot;, argv[0]);
                return 1;
        }
        dumpInterfaceUsage(argv[1]);
        return 0;
}

</code></pre><p>Running result:</p>
<pre><code>[root@localhost C7]# ./ifstat eth0
eth0 In:     0.24 kbytes/s      2 P/s Out:     0.25 kbytes/s     1 P/s
eth0 In:     0.32 kbytes/s      4 P/s Out:     0.97 kbytes/s     3 P/s
eth0 In:     1.29 kbytes/s     13 P/s Out:     5.06 kbytes/s    13 P/s
eth0 In:     0.06 kbytes/s      1 P/s Out:     0.08 kbytes/s     0 P/s

</code></pre><p>####Bugs
Ok, now let&rsquo;s see its bug:</p>
<pre><code>#enable the unlimited:
[root@localhost C7]# ulimit -c unlimited
#Get the core file: 
[root@localhost C7]# ./ifstat b
Segmentation fault (core dumped)

</code></pre><p>####Debugging</p>
<pre><code>[root@localhost C7]# ls -l -h core*
-rw------- 1 root root 272K Oct 14 06:53 core.3961
#Use gdb for anlysing the corefile:    
[root@localhost C7]# gdb ifstat core.3961
GNU gdb Fedora (6.8-27.el5)
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
and &quot;show warranty&quot; for details.
This GDB was configured as &quot;i386-redhat-linux-gnu&quot;...

warning: Can't read pathname for load map: Input/output error.
Reading symbols from /lib/libc.so.6...done.
Loaded symbols for /lib/libc.so.6
Reading symbols from /lib/ld-linux.so.2...done.
Loaded symbols for /lib/ld-linux.so.2
Core was generated by `./ifstat b'.
Program terminated with signal 11, Segmentation fault.
[New process 3961]
#0  0x00b6f957 in rawmemchr () from /lib/libc.so.6

</code></pre><p>Seems the corefile is useless, this because the error is not derived from our own code, but rather from the library. Run gdb for anlysing the ./ifstat b</p>
<pre><code>[root@localhost C7]# gdb ./ifstat
GNU gdb Fedora (6.8-27.el5)
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
and &quot;show warranty&quot; for details.
This GDB was configured as &quot;i386-redhat-linux-gnu&quot;...
(gdb) run b
Starting program: /root/code/C7/ifstat b

Program received signal SIGSEGV, Segmentation fault.
0x00b6f957 in rawmemchr () from /lib/libc.so.6
(gdb) break parseDevFile
Breakpoint 1 at 0x804854a: file ifstat.c, line 10.
(gdb) run b
The program being debugged has been started already.
Start it from the beginning? (y or n) y
Starting program: /root/code/C7/ifstat b

Breakpoint 1, parseDevFile (iface=0xbfe52b5e &quot;b&quot;, bRx=0xbfe50f80, pRx=0xbfe50f70, bTx=0xbfe50f78, pTx=0xbfe50f68) at ifstat.c:10
10              FILE * fp = NULL;
(gdb) step
11              char * line = NULL;
(gdb)
12              unsigned int len = 0;
(gdb)
13              fp = fopen(&quot;/proc/net/dev&quot;, &quot;r&quot;);
(gdb) print fp
$1 = (FILE *) 0x0
(gdb) step
14              if(fp == NULL)
(gdb) step
18              while(getline(&amp;line, &amp;len, fp) != -1)
(gdb) display line
1: line = 0x0
(gdb) step
20                      if(strstr(line, iface) != NULL)
1: line = 0x9730170 &quot;Inter-|   Receive&quot;, ' ' &lt;repeats 48 times&gt;, &quot;|  Transmit\n&quot;
(gdb) step
18              while(getline(&amp;line, &amp;len, fp) != -1)
1: line = 0x9730170 &quot;Inter-|   Receive&quot;, ' ' &lt;repeats 48 times&gt;, &quot;|  Transmit\n&quot;
(gdb)
20                      if(strstr(line, iface) != NULL)
1: line = 0x9730170 &quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;
(gdb)
22                              sscanf(strstr(line, &quot;:&quot;)+1, &quot;%llu%llu%*u%*u%*u%*u%*u%*u%llu%llu&quot;, bRx, pRx, bTx, pTx);
1: line = 0x9730170 &quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;
(gdb)

Program received signal SIGSEGV, Segmentation fault.
0x00b6f957 in rawmemchr () from /lib/libc.so.6
(gdb)

</code></pre><p>We found another bug, also we can see ./ifstat dba</p>
<pre><code>[root@localhost C7]# gdb ./ifstat
GNU gdb Fedora (6.8-27.el5)
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
and &quot;show warranty&quot; for details.
This GDB was configured as &quot;i386-redhat-linux-gnu&quot;...
(gdb) run dba
Starting program: /root/code/C7/ifstat dba
dba In:     0.00 kbytes/s      0 P/s Out:     0.00 kbytes/s     0 P/s
dba In:     0.00 kbytes/s      0 P/s Out:     0.00 kbytes/s     0 P/s

Program received signal SIGINT, Interrupt.
0x00ef3402 in __kernel_vsyscall ()
(gdb) break parseDevFile
Breakpoint 1 at 0x804854a: file ifstat.c, line 10.
(gdb) run dba
The program being debugged has been started already.
Start it from the beginning? (y or n) y
Starting program: /root/code/C7/ifstat dba

Breakpoint 1, parseDevFile (iface=0xbf81bb5c &quot;dba&quot;, bRx=0xbf81ad40, pRx=0xbf81ad30, bTx=0xbf81ad38, pTx=0xbf81ad28) at ifstat.c:10
10              FILE * fp = NULL;
(gdb) step
11              char * line = NULL;
(gdb) step
12              unsigned int len = 0;
(gdb) step
13              fp = fopen(&quot;/proc/net/dev&quot;, &quot;r&quot;);
(gdb) step
14              if(fp == NULL)
(gdb) step
18              while(getline(&amp;line, &amp;len, fp) != -1)
(gdb) display line
1: line = 0x0
(gdb) step
20                      if(strstr(line, iface) != NULL)
1: line = 0x9101170 &quot;Inter-|   Receive&quot;, ' ' &lt;repeats 48 times&gt;, &quot;|  Transmit\n&quot;
(gdb)
18              while(getline(&amp;line, &amp;len, fp) != -1)
1: line = 0x9101170 &quot;Inter-|   Receive&quot;, ' ' &lt;repeats 48 times&gt;, &quot;|  Transmit\n&quot;
(gdb)
20                      if(strstr(line, iface) != NULL)
1: line = 0x9101170 &quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;
(gdb)
18              while(getline(&amp;line, &amp;len, fp) != -1)
1: line = 0x9101170 &quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;
(gdb)
20                      if(strstr(line, iface) != NULL)
1: line = 0x9101170 &quot;    lo: 4684910    2267    0    0    0     0          0         0  4684910    2267    0    0    0     0       0          0\n&quot;
(gdb)
18              while(getline(&amp;line, &amp;len, fp) != -1)
1: line = 0x9101170 &quot;    lo: 4684910    2267    0    0    0     0          0         0  4684910    2267    0    0    0     0       0          0\n&quot;
(gdb)
20                      if(strstr(line, iface) != NULL)
1: line = 0x9101170 &quot;  eth0: 5135043   75928    0    0    0     0          0         0 15204045  129941    0    0    0     0       0          0\n&quot;
(gdb)
18              while(getline(&amp;line, &amp;len, fp) != -1)
1: line = 0x9101170 &quot;  eth0: 5135043   75928    0    0    0     0          0         0 15204045  129941    0    0    0     0       0          0\n&quot;
(gdb)
20                      if(strstr(line, iface) != NULL)
1: line = 0x9101170 &quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;
(gdb)
18              while(getline(&amp;line, &amp;len, fp) != -1)
1: line = 0x9101170 &quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;
(gdb)
25              fclose(fp);
1: line = 0x9101170 &quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;
(gdb)
26              free(line);
1: line = 0x9101170 &quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;
(gdb)
27              return 0;
1: line = 0x9101170 &quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;
(gdb)
28      }
1: line = 0x9101170 &quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;
(gdb)
dumpInterfaceUsage (iface=0xbf81bb5c &quot;dba&quot;) at ifstat.c:36
36              sleep(SLEEP_TIME);
(gdb)
39                      if(parseDevFile(iface, &amp;ifaceBRxNew, &amp;ifacePRxNew, &amp;ifaceBTxNew, &amp;ifacePTxNew) == -1) return;
(gdb)

Breakpoint 1, parseDevFile (iface=0xbf81bb5c &quot;dba&quot;, bRx=0xbf81ad20, pRx=0xbf81ad10, bTx=0xbf81ad18, pTx=0xbf81ad08) at ifstat.c:10
10              FILE * fp = NULL;
1: line = 0xaf5ca0 &quot;&quot;
(gdb)
11              char * line = NULL;
1: line = 0xaf5ca0 &quot;&quot;
(gdb)
12              unsigned int len = 0;
1: line = 0x0
(gdb)
13              fp = fopen(&quot;/proc/net/dev&quot;, &quot;r&quot;);
1: line = 0x0
(gdb)
14              if(fp == NULL)
1: line = 0x0
(gdb)
18              while(getline(&amp;line, &amp;len, fp) != -1)
1: line = 0x0
(gdb)
20                      if(strstr(line, iface) != NULL)
1: line = 0x9101170 &quot;Inter-|   Receive&quot;, ' ' &lt;repeats 48 times&gt;, &quot;|  Transmit\n&quot;
(gdb)
18              while(getline(&amp;line, &amp;len, fp) != -1)
1: line = 0x9101170 &quot;Inter-|   Receive&quot;, ' ' &lt;repeats 48 times&gt;, &quot;|  Transmit\n&quot;
(gdb)
20                      if(strstr(line, iface) != NULL)
1: line = 0x9101170 &quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;
(gdb)
18              while(getline(&amp;line, &amp;len, fp) != -1)
1: line = 0x9101170 &quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;
(gdb)
20                      if(strstr(line, iface) != NULL)
1: line = 0x9101170 &quot;    lo: 4684910    2267    0    0    0     0          0         0  4684910    2267    0    0    0     0       0          0\n&quot;
(gdb)
18              while(getline(&amp;line, &amp;len, fp) != -1)
1: line = 0x9101170 &quot;    lo: 4684910    2267    0    0    0     0          0         0  4684910    2267    0    0    0     0       0          0\n&quot;
(gdb)
20                      if(strstr(line, iface) != NULL)
1: line = 0x9101170 &quot;  eth0: 5141021   76010    0    0    0     0          0         0 15217535  130042    0    0    0     0       0          0\n&quot;
(gdb)
18              while(getline(&amp;line, &amp;len, fp) != -1)
1: line = 0x9101170 &quot;  eth0: 5141021   76010    0    0    0     0          0         0 15217535  130042    0    0    0     0       0          0\n&quot;
(gdb)
20                      if(strstr(line, iface) != NULL)
1: line = 0x9101170 &quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;
(gdb)
18              while(getline(&amp;line, &amp;len, fp) != -1)
1: line = 0x9101170 &quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;
(gdb)
25              fclose(fp);
1: line = 0x9101170 &quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;
(gdb)
26              free(line);
1: line = 0x9101170 &quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;
(gdb)
27              return 0;
1: line = 0x9101170 &quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;
(gdb)
28      }
1: line = 0x9101170 &quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;
(gdb)
dumpInterfaceUsage (iface=0xbf81bb5c &quot;dba&quot;) at ifstat.c:40
40                      printf(&quot;%s In: %8.2f kbytes/s  %5llu P/s Out: %8.2f kbytes/s %5llu P/s\n&quot;, iface,
(gdb)
dba In:     0.00 kbytes/s      0 P/s Out:     0.00 kbytes/s     0 P/s

</code></pre><p>####Conclusion:
And now we can get the reason, the ./ifstat b is because we reached the line2 of the /proc/net/dev, it has b for &ldquo;bytes&rdquo;. <br>
./ifstat dba always print 0 because we don&rsquo;t have this equipment at all ! <br>
####Correcting
So the corrected code is listed as following:</p>
<pre><code>int parseDevFile(const char * iface, ull *bRx, ull *pRx, ull *bTx, ull *pTx)
{
        FILE * fp = NULL;
        char * line = NULL;
        unsigned int len = 0;
        short int exists = 0;
        fp = fopen(&quot;/proc/net/dev&quot;, &quot;r&quot;);
        if(fp == NULL)
        {
                return -1;
        }
        while(getline(&amp;line, &amp;len, fp) != -1)
        {
                if(strstr(line, iface) != NULL)
                {
                        if(strstr(line, &quot;:&quot;) != NULL)
                        {
                                sscanf(strstr(line, &quot;:&quot;)+1, &quot;%llu%llu%*u%*u%*u%*u%*u%*u%llu%llu&quot;, bRx, pRx, bTx, pTx);
                                exists = 1;
                        }
                }
        }
        fclose(fp);
        free(line);
        if( exists != 1)
        {
                fprintf(stderr, &quot;Your device %s is not in the file /proc/net/dev!\n&quot;, iface);
                exit(2);
        }
        return 0;
}

</code></pre><p>Now run it and the result is listed as:</p>
<pre><code>[root@localhost C7]# ./ifstat_upgrade b
Your device b is not in the file /proc/net/dev!
[root@localhost C7]# ./ifstat_upgrade bba
Your device bba is not in the file /proc/net/dev!
[root@localhost C7]# ./ifstat_upgrade eth0
eth0 In:     0.03 kbytes/s      0 P/s Out:     0.00 kbytes/s     0 P/s
eth0 In:     0.03 kbytes/s      0 P/s Out:     0.08 kbytes/s     0 P/s

</code></pre>
      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2014/04/08/programming-in-c-of-fc-tutorial-4/">Programming in C of FC tutorial 4</a>
      </h1>
      <span class="post-date">Apr 8, 2014 
      
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/technology">Technology</a>
        
      </span>
      
      <p>###Full Circle C 6
####Using valgrid for memory check
See <a href="www.valgrind.org">www.valgrind.org</a> for more information for using the valgrind available tools.  <br>
memcheck is the main topic in this chapter.  <br>
this tool override libc calls that deal with handling memory. And it will do some bookkeeping. is all memory given back to the system, and is all the allocated memory still reachable?</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

void leak()
{
        char *ptr = malloc(10);
        printf(&quot;malloc(10) points to: %p\n&quot;, ptr);
}

int main()
{
        int i = 0;
        for(i = 0; i&lt;10; i++)
        {
                leak();
        }
        char *ptr = malloc(15);
        printf(&quot;malloc(15) in main: %p\n&quot;, ptr);
        while(1){}
        return 0;
}

</code></pre><p>The result shows:</p>
<pre><code>valgrind --leak-check=full --show-reachable=yes ./memleak
==2144== Memcheck, a memory error detector.
==2144== Copyright (C) 2002-2006, and GNU GPL'd, by Julian Seward et al.
==2144== Using LibVEX rev 1658, a library for dynamic binary translation.
==2144== Copyright (C) 2004-2006, and GNU GPL'd, by OpenWorks LLP.
==2144== Using valgrind-3.2.1, a dynamic binary instrumentation framework.
==2144== Copyright (C) 2000-2006, and GNU GPL'd, by Julian Seward et al.
==2144== For more details, rerun with: -v
==2144==
malloc(10) points to: 0x4022028
malloc(10) points to: 0x4022068
malloc(10) points to: 0x40220a8
malloc(10) points to: 0x40220e8
malloc(10) points to: 0x4022128
malloc(10) points to: 0x4022168
malloc(10) points to: 0x40221a8
malloc(10) points to: 0x40221e8
malloc(10) points to: 0x4022228
malloc(10) points to: 0x4022268
malloc(15) in main: 0x40222a8
==2144==
==2144== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 12 from 1)
==2144== malloc/free: in use at exit: 115 bytes in 11 blocks.
==2144== malloc/free: 11 allocs, 0 frees, 115 bytes allocated.
==2144== For counts of detected errors, rerun with: -v
==2144== searching for pointers to 11 not-freed blocks.
==2144== checked 46,792 bytes.
==2144==
==2144== 15 bytes in 1 blocks are still reachable in loss record 1 of 2
==2144==    at 0x40053C0: malloc (vg_replace_malloc.c:149)
==2144==    by 0x8048419: main (leak.c:17)
==2144==
==2144==
==2144== 100 bytes in 10 blocks are definitely lost in loss record 2 of 2
==2144==    at 0x40053C0: malloc (vg_replace_malloc.c:149)
==2144==    by 0x80483C5: leak (leak.c:6)
==2144==    by 0x8048403: main (leak.c:15)
==2144==
==2144== LEAK SUMMARY:
==2144==    definitely lost: 100 bytes in 10 blocks.
==2144==      possibly lost: 0 bytes in 0 blocks.
==2144==    still reachable: 15 bytes in 1 blocks.
==2144==         suppressed: 0 bytes in 0 blocks.

</code></pre><p>If we change the code into following, this means valgrid won&rsquo;t interpret the output, so this will let the tracked memory add 10</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

void leak()
{
        char *ptr = malloc(10);
        printf(&quot;malloc(10) points to: %p\n&quot;, ptr);
}

int main()
{
        int i = 0;
        for(i = 0; i&lt;10; i++)
        {
                leak();
        }
        char *ptr = malloc(15);
        printf(&quot;malloc(15) in main: %p\n&quot;, ptr);
        //while(1){}
        return 0;
}

</code></pre><p>Compile and verify:</p>
<pre><code>gcc -Wall -g leak1.c -o memleak1
View the valgrind result:
valgrind --leak-check=full --show-reachable=yes ./memleak1
==2190== Memcheck, a memory error detector.
==2190== Copyright (C) 2002-2006, and GNU GPL'd, by Julian Seward et al.
==2190== Using LibVEX rev 1658, a library for dynamic binary translation.
==2190== Copyright (C) 2004-2006, and GNU GPL'd, by OpenWorks LLP.
==2190== Using valgrind-3.2.1, a dynamic binary instrumentation framework.
==2190== Copyright (C) 2000-2006, and GNU GPL'd, by Julian Seward et al.
==2190== For more details, rerun with: -v
==2190==
malloc(10) points to: 0x4022028
malloc(10) points to: 0x4022068
malloc(10) points to: 0x40220a8
malloc(10) points to: 0x40220e8
malloc(10) points to: 0x4022128
malloc(10) points to: 0x4022168
malloc(10) points to: 0x40221a8
malloc(10) points to: 0x40221e8
malloc(10) points to: 0x4022228
malloc(10) points to: 0x4022268
malloc(15) in main: 0x40222a8
==2190==
==2190== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 12 from 1)
==2190== malloc/free: in use at exit: 115 bytes in 11 blocks.
==2190== malloc/free: 11 allocs, 0 frees, 115 bytes allocated.
==2190== For counts of detected errors, rerun with: -v
==2190== searching for pointers to 11 not-freed blocks.
==2190== checked 46,796 bytes.
==2190==
==2190== 15 bytes in 1 blocks are definitely lost in loss record 1 of 2
==2190==    at 0x40053C0: malloc (vg_replace_malloc.c:149)
==2190==    by 0x8048419: main (leak1.c:17)
==2190==
==2190==
==2190== 100 bytes in 10 blocks are definitely lost in loss record 2 of 2
==2190==    at 0x40053C0: malloc (vg_replace_malloc.c:149)
==2190==    by 0x80483C5: leak (leak1.c:6)
==2190==    by 0x8048403: main (leak1.c:15)
==2190==
==2190== LEAK SUMMARY:
==2190==    definitely lost: 115 bytes in 11 blocks.
==2190==      possibly lost: 0 bytes in 0 blocks.
==2190==    still reachable: 0 bytes in 0 blocks.
==2190==         suppressed: 0 bytes in 0 blocks.

</code></pre><p>####exercise 1:
vmstat is a tool which report system usage statistics, use strace to figure out which /proc/file(s) it uses to generate its output</p>
<pre><code>execve(&quot;/usr/bin/vmstat&quot;, [&quot;vmstat&quot;], [/* 29 vars */]) = 0
brk(0)                                  = 0x96b7000
access(&quot;/etc/ld.so.preload&quot;, R_OK)      = -1 ENOENT (No such file or directory)
open(&quot;/etc/ld.so.cache&quot;, O_RDONLY)      = 3
fstat64(3, {st_mode=S_IFREG|0644, st_size=95416, ...}) = 0
mmap2(NULL, 95416, PROT_READ, MAP_PRIVATE, 3, 0) = 0xb7f80000
close(3)                                = 0
open(&quot;/lib/libproc-3.2.7.so&quot;, O_RDONLY) = 3
read(3, &quot;\177ELF\1\1\1\0\0\0\0\0\0\0\0\0\3\0\3\0\1\0\0\0\320c\304\0004\0\0\0&quot;..., 512) = 512
fstat64(3, {st_mode=S_IFREG|0755, st_size=54212, ...}) = 0
mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb7f7f000
mmap2(0xc44000, 133592, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0xc44000
mmap2(0xc51000, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0xc) = 0xc51000
mmap2(0xc52000, 76248, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0xc52000
close(3)                                = 0
open(&quot;/lib/libc.so.6&quot;, O_RDONLY)        = 3
read(3, &quot;\177ELF\1\1\1\0\0\0\0\0\0\0\0\0\3\0\3\0\1\0\0\0\320?\261\0004\0\0\0&quot;..., 512) = 512
fstat64(3, {st_mode=S_IFREG|0755, st_size=1606808, ...}) = 0
mmap2(0xafe000, 1324452, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0xafe000
mmap2(0xc3c000, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x13e) = 0xc3c000
mmap2(0xc3f000, 9636, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0xc3f000
close(3)                                = 0
mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb7f7e000
set_thread_area({entry_number:-1 -&gt; 6, base_addr:0xb7f7e6c0, limit:1048575, seg_32bit:1, contents:0, read_exec_only:0, limit_in_pages:1, seg_not_present:0, useable:1}) = 0
mprotect(0xc3c000, 8192, PROT_READ)     = 0
mprotect(0xaf5000, 4096, PROT_READ)     = 0
munmap(0xb7f80000, 95416)               = 0
uname({sys=&quot;Linux&quot;, node=&quot;localhost.localdomain&quot;, ...}) = 0
brk(0)                                  = 0x96b7000
brk(0x96d8000)                          = 0x96d8000
open(&quot;/proc/stat&quot;, O_RDONLY)            = 3
fstat64(3, {st_mode=S_IFREG|0444, st_size=0, ...}) = 0
mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb7f97000
read(3, &quot;cpu  14886 15300 97152 608490 41&quot;..., 4096) = 693
read(3, &quot;&quot;, 4096)                       = 0
close(3)                                = 0
munmap(0xb7f97000, 4096)                = 0
ioctl(1, TIOCGWINSZ, {ws_row=36, ws_col=115, ws_xpixel=0, ws_ypixel=0}) = 0
fstat64(1, {st_mode=S_IFCHR|0620, st_rdev=makedev(136, 4), ...}) = 0
mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb7f97000
write(1, &quot;procs -----------memory---------&quot;..., 82procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu------
) = 82
write(1, &quot; r  b   swpd   free   buff  cach&quot;..., 81 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
) = 81
open(&quot;/proc/meminfo&quot;, O_RDONLY)         = 3
lseek(3, 0, SEEK_SET)                   = 0
read(3, &quot;MemTotal:       897068 kB\nMemFre&quot;..., 1023) = 771
open(&quot;/proc/stat&quot;, O_RDONLY)            = 4
read(4, &quot;cpu  14886 15300 97153 608490 41&quot;..., 65535) = 693
open(&quot;/proc/vmstat&quot;, O_RDONLY)          = 5
lseek(5, 0, SEEK_SET)                   = 0
read(5, &quot;nr_anon_pages 29682\nnr_mapped 13&quot;..., 1023) = 803
write(1, &quot; 0  0    120  16980  32852 67407&quot;..., 81 0  0    120  16980  32852 674076    0    0   228   223 1040  432  4 13 78  5  0
) = 81
exit_group(0)                           = ?

</code></pre><p>From the above output, we can see, it access /proc/stat and /proc/vmstat for output message. <br>
####exercise 2
Repeat the ltrace /strace example on wget with ivalid URL, TBD <br>
####exercise 3
Does valgrind automatically trace child process?</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

/* For using fork() */
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;

/* Using errono */
#include &lt;errno.h&gt;
#include &lt;string.h&gt;


void leak()
{
        char *ptr = malloc(10);
        printf(&quot;malloc(10) points to: %p\n&quot;, ptr);
}

int main(void)
{
        pid_t child;
        /* Parent do leak() */
        int i = 0;
        for(i = 0; i&lt;10; i++)
        {
                leak();
        }

        /* Now fork a child process */
        if((child = fork()) &lt; 0) {
                fprintf(stderr, &quot;fork of child failed: %s\n&quot;, strerror(errno));
                return 1;
        }
        else if(child == 0) {
                printf(&quot;Now its in child process\n&quot;);
                sleep(2);
        }
        else {
                // parent will exit immediately !
                printf(&quot;Parent will exit!\n&quot;);
                sleep(1);
                return 0;
        }

        // Only Child comes here
        printf(&quot;Only child comes here!\n&quot;);
        for(i = 0; i&lt;10; i++)
        {
                leak();
        }

        return 0;
}

</code></pre><p>We use following command for tracing the output:</p>
<pre><code>[root@localhost code]# valgrind --leak-check=full --show-reachable=yes ./memleak_fork
==2561== Memcheck, a memory error detector.
==2561== Copyright (C) 2002-2006, and GNU GPL'd, by Julian Seward et al.
==2561== Using LibVEX rev 1658, a library for dynamic binary translation.
==2561== Copyright (C) 2004-2006, and GNU GPL'd, by OpenWorks LLP.
==2561== Using valgrind-3.2.1, a dynamic binary instrumentation framework.
==2561== Copyright (C) 2000-2006, and GNU GPL'd, by Julian Seward et al.
==2561== For more details, rerun with: -v
==2561==
malloc(10) points to: 0x4022028
malloc(10) points to: 0x4022068
malloc(10) points to: 0x40220a8
malloc(10) points to: 0x40220e8
malloc(10) points to: 0x4022128
malloc(10) points to: 0x4022168
malloc(10) points to: 0x40221a8
malloc(10) points to: 0x40221e8
malloc(10) points to: 0x4022228
malloc(10) points to: 0x4022268
Now its in child process
Parent will exit!
==2561==
==2561== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 12 from 1)
==2561== malloc/free: in use at exit: 100 bytes in 10 blocks.
==2561== malloc/free: 10 allocs, 0 frees, 100 bytes allocated.
==2561== For counts of detected errors, rerun with: -v
==2561== searching for pointers to 10 not-freed blocks.
==2561== checked 46,796 bytes.
==2561==
==2561== 100 bytes in 10 blocks are definitely lost in loss record 1 of 1
==2561==    at 0x40053C0: malloc (vg_replace_malloc.c:149)
==2561==    by 0x8048515: leak (fork.c:15)
==2561==    by 0x8048553: main (fork.c:26)
==2561==
==2561== LEAK SUMMARY:
==2561==    definitely lost: 100 bytes in 10 blocks.
==2561==      possibly lost: 0 bytes in 0 blocks.
==2561==    still reachable: 0 bytes in 0 blocks.
==2561==         suppressed: 0 bytes in 0 blocks.
[root@localhost code]# Only child comes here!
malloc(10) points to: 0x40222a8
malloc(10) points to: 0x40222e8
malloc(10) points to: 0x4022328
malloc(10) points to: 0x4022368
malloc(10) points to: 0x40223a8
malloc(10) points to: 0x40223e8
malloc(10) points to: 0x4022428
malloc(10) points to: 0x4022468
malloc(10) points to: 0x40224a8
malloc(10) points to: 0x40224e8
==2562==
==2562== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 12 from 1)
==2562== malloc/free: in use at exit: 200 bytes in 20 blocks.
==2562== malloc/free: 20 allocs, 0 frees, 200 bytes allocated.
==2562== For counts of detected errors, rerun with: -v
==2562== searching for pointers to 20 not-freed blocks.
==2562== checked 46,796 bytes.
==2562==
==2562== 200 bytes in 20 blocks are definitely lost in loss record 1 of 1
==2562==    at 0x40053C0: malloc (vg_replace_malloc.c:149)
==2562==    by 0x8048515: leak (fork.c:15)
==2562==    by 0x8048553: main (fork.c:26)
==2562==
==2562== LEAK SUMMARY:
==2562==    definitely lost: 200 bytes in 20 blocks.
==2562==      possibly lost: 0 bytes in 0 blocks.
==2562==    still reachable: 0 bytes in 0 blocks.
==2562==         suppressed: 0 bytes in 0 blocks.

</code></pre><p>From the above output, we can see valgrid also tracked the child process&rsquo;s memory usage.</p>

      
    </div>
    
    

<ul class="pagination">
    
    <li class="page-item">
        <a href="/" class="page-link" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li class="page-item">
    <a href="/page/179/" class="page-link" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/2/">2</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/3/">3</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item disabled"><span aria-hidden="true">&nbsp;&hellip;&nbsp;</span></li>
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/179/">179</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item active"><a class="page-link" href="/page/180/">180</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/181/">181</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item disabled"><span aria-hidden="true">&nbsp;&hellip;&nbsp;</span></li>
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/221/">221</a></li>
    
    
    <li class="page-item">
    <a href="/page/181/" class="page-link" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li class="page-item">
        <a href="/page/221/" class="page-link" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>


  </div>
</div>


<script src="http://purplepalmdash.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

