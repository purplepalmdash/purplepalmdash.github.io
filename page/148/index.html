<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta name=generator content="Hugo 0.64.0"><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Dash &#183; Dash</title><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-a.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/custom-additions.css?ref=abc124"><link rel=stylesheet href=https://purplepalmdash.github.io/css/highlight/googlecode.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script type=text/javascript src=/js/html2canvas.js></script><script type=text/javascript>function genPostShot(){var rightNow=new Date();var imageName=rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");imageName+='.jpg'
html2canvas(document.getElementsByClassName('post'),{background:'#FFFFFF',onrendered:function(canvas){$('#test').attr('href',canvas.toDataURL("image/jpeg"));$('#test').attr('download',imageName);$('#test')[0].click();}});};</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=apple-touch-icon-precomposed sizes=144x144 href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124"><link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel=icon><link href=%7balternate%20%7bRSS%20application/rss+xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/index.xml%20http://purplepalmdash.github.io/index.xml%7d rel=alternate type=application/rss+xml title="Dash &#183; Dash"><meta name=description content><meta name=keywords content="unix,virtualization,embedded,linux"></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><img src=http://purplepalmdash.github.io/images/mylogo.jpeg alt=gravatar><h1><a href=http://purplepalmdash.github.io/>很惭愧，就做了一点微小的工作</a></h1><a href=http://purplepalmdash.github.io/><p>Dash</p></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/post/>All Posts</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/technology/>Technology</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/life/>Life</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/linuxtips/>LinuxTips</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/purplepalmdash><i class="fa fa-github-square fa-3x"></i></a><a href=https://cn.linkedin.com/in/yang-feipeng-1b909319><i class="fa fa-linkedin-square fa-3x"></i></a><a href=https://plus.google.com/u/0/106572959364703833986><i class="fa fa-google-plus-square fa-3x"></i></a><a href=https://www.facebook.com/yang.feipeng><i class="fa fa-facebook-square fa-3x"></i></a><a href=https://twitter.com/dashwillfly><i class="fa fa-twitter-square fa-3x"></i></a></li></ul></div></div><div class="content container"><div class=posts><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2015/01/30/speed-up-the-wp-website-in-tianchao/>Speed-Up the WP website in TianChao</a></h1><span class=post-date>Jan 30, 2015<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>Since our Great Fire Wall forbidden the google, thus all of the google related service becomes available in china, this leads to access to wordpress based website which uses google online fonts pretty slow. Following is how to speedup your website without too many changes:<br>First go to your website&rsquo;s folder, find the files which calls <code>fonts.googleapis.com</code>:</p><pre><code>$ grep -i &quot;fonts.googleapis.com&quot; ./ -r
./wp-content/themes/twentytwelve/functions.php:		$font_url = add_query_arg( $query_args, &quot;$protocol://fonts.googleapis.com/css&quot; );
./wp-content/themes/twentyfifteen/functions.php:		), '//fonts.googleapis.com/css' );
./wp-content/themes/twentyfourteen/functions.php:		$font_url = add_query_arg( 'family', urlencode( 'Lato:300,400,700,900,300italic,400italic,700italic' ), &quot;//fonts.googleapis.com/css&quot; );
./wp-content/themes/tdpersona/functions.php:	wp_enqueue_style( 'tdpersona-googlefonts', '//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' );
./wp-content/themes/twentythirteen/functions.php:		$fonts_url = add_query_arg( $query_args, &quot;//fonts.googleapis.com/css&quot; );
./wp-includes/script-loader.php:		$open_sans_font_url = &quot;//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,300,400,600&amp;subset=$subsets&quot;;
./wp-includes/js/tinymce/plugins/compat3x/css/dialog.css:@import url(//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,300,400,600&amp;subset=latin-ext,latin);


</code></pre><p>Replace all of the <code>fonts.googleapis.com</code> with <code>fonts.useso.com</code>, this could be done via scripts.<br>After modification, your website will be much more faster than before.</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2015/01/29/build-contrial-source-code/>Build Contrial Source Code</a></h1><span class=post-date>Jan 29, 2015<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=reference>Reference</h3><p><a href=http://juniper.github.io/contrail-vnc/README.html>http://juniper.github.io/contrail-vnc/README.html</a></p><h3 id=hardware--software>Hardware && Software</h3><p>Vitualized machine which have 1G memory and 1 core.<br>Running 12.04:</p><pre><code># cat /etc/issue
Ubuntu 12.04.3 LTS \n \l

</code></pre><h3 id=packages>Packages</h3><p>You should install following packages:</p><pre><code>$ sudo add-apt-repository ppa:opencontrail/ppa
$ sudo vim /etc/apt/source.lists
deb http://ppa.launchpad.net/opencontrail/ppa/ubuntu precise main
deb-src http://ppa.launchpad.net/opencontrail/ppa/ubuntu precise main
$ sudo apt-get install  -y scons git python-lxml wget gcc patch make unzip flex bison g++ libssl-dev autoconf automake libtool pkg-config vim python-dev python-setuptools libprotobuf-dev protobuf-compiler libsnmp-python libgettextpo0 libxml2-utils debhelper python-sphinx ruby-ronn libipfix python-all libpcap-dev module-assistant libtbb-dev libboost-dev liblog4cplus-dev libghc-curl-dev
$ sudo apt-get install python-pip
$ sudo pip install gevent bottle netaddr 

</code></pre><h3 id=getting-source-code>Getting Source Code</h3><p>Use repo for getting the source code:</p><pre><code>$ curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo
$ chmod a+x ~/bin/repo
$ echo &quot;export PATH=/usr/local/git/bin:$PATH&quot;&gt;&gt;~/.bashrc
$ source ~/.bashrc

</code></pre><p>Fetch the repository and sync it.</p><pre><code>$ mkdir ~/Code/OpenContrail
$ cd ~/Code/OpenContrail
$ repo init -u git@github.com:Juniper/contrail-vnc
$ repo sync

</code></pre><p>Some of the packages will be blocked by GFW, be sure you use proxy for downloading them.<br>Fetch the third party packages:</p><pre><code>$ python third_party/fetch_packages.py

</code></pre><h3 id=build-the-opencontrail--pakages>Build the OpenContrail & Pakages</h3><p>The build step is simply via <code>scons</code>, after a long wait, it will pass.<br>Generate packages via:</p><pre><code>$ make -f packages.make

</code></pre><p>The default configuration will make <code>all</code> of the components in packages.make, or you could seperately build single component.</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2015/01/29/build-specified-version-of-opencontrail/>Build Specified Version Of OpenContrail</a></h1><span class=post-date>Jan 29, 2015<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>Since the default building of OpenContrail is master branch, while the installation deb file named like <code>contrail-install-packages_1.21-74~havana_all.deb</code>, this gap need to be filled via building.</p><h3 id=view-different-branches>View Different Branches</h3><p>Repo hold all of the versions locally, simply view them via:</p><pre><code># pwd
/root/Code/OpenContrail/.repo/manifests
# git branch -a | cut -d / -f 3
* default
master -&gt; origin
R1.04
R1.05
R1.06
R1.06c1
R1.10
R1.30
R2.0
R2.1
gh-pages
master
opserver
rajreddy_doc_update
rajreddy_doc_update2
rajreddy_webui_third

</code></pre><p>While these branches doesn&rsquo;t contains <code>1.21</code>, why?</p><h3 id=specify-different-tag>Specify Different Tag</h3><p>In git admined project, tag is frequently be used, thus we could fetch the code via specified tag.<br>Repo need to run following command to enable all of the sub-project syncs to specified tag, following I use <code>v1.21</code> tag for syncing.</p><pre><code>$ repo forall -c 'git checkout v1.21`
$ repo sync
$ python third_party/fetch_package.py &amp;&amp; scons &amp;&amp; make -f packages.make

</code></pre><p>Need a long time for checking the generated packages.<br>Problem:</p><pre><code>dpkg-source: error: syntax error in contrail/debian/control at line 33: block
lacks the 'Package' field
dpkg-buildpackage: error: dpkg-source --before-build contrail gave error exit
status 25

</code></pre><p>when running <code>make -f packages.make</code>, it will failed, just remove the line before <code>packages</code> it will be OK.</p><h3 id=specify-different-branch>Specify Different Branch</h3><p>Specify the branch of:</p><pre><code>repo init -b android-2.3_r1 ; repo sync
repo init -b R2.20


</code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2015/01/29/play-docker-4/>Play Docker(4)</a></h1><span class=post-date>Jan 29, 2015<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=figcontinue>Fig(Continue)</h3><p>Met some problems in last article, so this part will continue to work on Fig, the correct configuration files are listed as following:</p><pre><code>$ ls
app.py  Dockerfile  fig.yml  requirements.txt
$ cat Dockerfile 
FROM python:2.7
ADD . /code
WORKDIR /code
RUN pip install -r requirements.txt
$ cat fig.yml 
web:
  build: .
  command: python app.py
  ports:
   - &quot;5000:5000&quot;
  volumes:
   - .:/code
  links:
   - redis
redis:
  image: redis
$ cat requirements.txt 
flask
redis
$ cat app.py 
from flask import Flask
from redis import Redis
import os
app = Flask(__name__)
redis = Redis(host='redis', port=6379)

@app.route('/')
def hello():
    redis.incr('hits')
    return 'Hello World! I have been seen %s times.' % redis.get('hits')

if __name__ == &quot;__main__&quot;:
    app.run(host=&quot;0.0.0.0&quot;, debug=True)

</code></pre><p>via <code>fig up</code> you could quickly build this app and let it run.<br>When it running, you could use <code>fig ps</code> for viewing the running instance:</p><pre><code>$ sudo fig ps
      Name             Command             State              Ports       
-------------------------------------------------------------------------
figtest_redis_1    /entrypoint.sh     Up                 6379/tcp         
                   redis-server                                           
figtest_web_1      python app.py      Up                 0.0.0.0:5000-&gt;50 
                                                         00/tcp    

</code></pre><p>Use <code>sudo fig run web env</code> you could view all of the variables of the running instance web, or change web into redis then displaying the variables of redis.<br>Use <code>sudo fig stop</code> to stop all of the running instance.</p><pre><code>$ sudo fig stop
Stopping figtest_web_1...
Stopping figtest_redis_1...

</code></pre><p>Use <code>sudo fig run web env</code> for displaying all of the variables of running <code>web</code>.</p><h3 id=create-django>Create Django</h3><p>Configuration files:</p><pre><code>$ cat Dockerfile 
FROM python:2.7
ENV PYTHONUNBUFFERED 1
RUN mkdir /code
WORKDIR /code
ADD requirements.txt /code/
RUN pip install -r requirements.txt
ADD . /code/

$ cat fig.yml 
db:
  image: postgres
web:
  build: .
  command: python manage.py runserver 0.0.0.0:8000
  volumes:
    - .:/code
  ports:
    - &quot;8000:8000&quot;
  links:
    - db

$ cat requirements.txt 
Django
psycopg2


</code></pre><p>Via <code>sudo fig run web django-admin.py startproject figexample .</code><br>This means, first fig will create the image, then use this image for running <code>django-admin.py startproject figexample</code>,
Examine via different methods:</p><pre><code>$ sudo docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS               NAMES
1abcafc5bd59        postgres:9          &quot;/docker-entrypoint.   4 minutes ago       Up 3 minutes        5432/tcp            django_db_1         
741b0e375c73        postgres:9          &quot;/docker-entrypoint.   4 minutes ago       Up 4 minutes        5432/tcp            Django_db_1         
[Trusty@DashCentOS django]$ sudo fig ps
   Name                  Command               State    Ports   
---------------------------------------------------------------
django_db_1   /docker-entrypoint.sh postgres   Up      5432/tcp 

</code></pre><p>Change the configuration file of the django project:</p><pre><code>$ sudo vim figexample/settings.py

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql_psycopg2',
        'NAME': 'postgres',
        'USER': 'postgres',
        'HOST': 'db',
        'PORT': 5432,
    }
}

</code></pre><p>Save the file and run <code>sudo fig up</code>, this time your django project connects to the right postgresql server.<br>Examine the running containers:</p><pre><code>$ sudo fig ps
      Name             Command             State              Ports       
-------------------------------------------------------------------------
django_db_1        /docker-           Up                 5432/tcp         
                   entrypoint.sh                                          
                   postgres                                               
django_web_1       python manage.py   Up                 0.0.0.0:8000-&gt;80 
                   runserver ...                         00/tcp           
$ sudo docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                    NAMES
d3c3c8bb6d0e        django_web:latest   &quot;python manage.py ru   4 minutes ago       Up 4 minutes        0.0.0.0:8000-&gt;8000/tcp   django_web_1        
3f7b61fdd09e        postgres:9          &quot;/docker-entrypoint.   4 minutes ago       Up 4 minutes        5432/tcp                 django_db_1        

</code></pre><h3 id=run-asp>Run ASP</h3><p>Refers to:<br><a href=http://dockerone.com/article/164>http://dockerone.com/article/164</a><br>The steps are listed as:</p><pre><code>$ git clone https://github.com/aspnet/Home.git
$ cd Home/
$ cd samples/HelloWeb/
$ vim Dockerfile
FROM microsoft/aspnet

COPY . /app
WORKDIR /app
RUN [&quot;kpm&quot;, &quot;restore&quot;]

EXPOSE 5004
ENTRYPOINT [&quot;k&quot;, &quot;kestrel&quot;]
$ sudo docker build -t myapp .
$ sudo docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
myapp               latest              6c0d622049ea        2 hours ago         492 MB
microsoft/aspnet    latest              1e67fe2f5a59        13 days ago         465.3 MB
$ sudo docker run -t -d -p 80:5004 myapp

</code></pre><p>Open your browser and visit <code>http://xxx.xx.xx.xxx:80</code> and you could found the asp based app runs.</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2015/01/28/play-docker-3/>Play Docker(3)</a></h1><span class=post-date>Jan 28, 2015<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=dockerfile>Dockerfile</h3><p>Dockerfile is like Vagrantfile, for define the configuration of the docker container.<br>The steps for creating the Dockerfile is listed as following:</p><pre><code>$ mkdir -p ~/Code
$ cd ~/Code &amp;&amp; vim Dockerfile 
FROM ubuntu:13.04
MAINTAINER examples@docker.com
RUN echo &quot;deb http://archive.ubuntu.com/ubuntu precise main universe&quot; &gt; /etc/apt/sources.list
RUN apt-get update
RUN apt-get upgrade -y
RUN apt-get install -y openssh-server nginx  supervisor
RUN mkdir -p /var/run/sshd
RUN mkdir -p /var/log/supervisor
RUN echo &quot;daemon off;&quot;&gt;&gt;/etc/nginx/nginx.conf
COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf
EXPOSE 22 80
CMD [&quot;/usr/bin/supervisord&quot;]
$ vim supervisord.conf 
[supervisord]
nodaemon=true
[program:sshd]
command=/usr/sbin/sshd -D

[program:nginx]
command=/usr/sbin/nginx
user=root
autostart=true

</code></pre><p>Now build the target image with following command:</p><pre><code>$ sudo docker build -t test/supervisord .

</code></pre><p>After build, we could use <code>sudo docker images</code> for examing the generated images. And use following command for start the sshd and nginx service:</p><pre><code>$ sudo docker run -p 2222:22 -p 8080:80 -t -i test/supervisord

</code></pre><p>Now change the root password and you could directly <code>ssh root@127.0.0.1 -p 2222</code> or you could directly access <a href=http://1xx.xx.xx.xxx:8080>http://1xx.xx.xx.xxx:8080</a> for nginx webpages.</p><h3 id=fig>Fig</h3><p>Fig is used for swiftly build up a container. You only need to add a fig.yml and specify some simple content, then it could easily assit you building up a container.<br>Install fig via following command:</p><pre><code>$ wget https://github.com/docker/fig/releases/download/1.0.1/fig-`uname -s`-`uname -m`
$ sudo mv fig-xxx-xxx /usr/bin/fig
$ sudo chmod 777 /usr/bin/fig

</code></pre><p>Touch the definition files under a specified directory and then use fig for building the whole container:</p><pre><code>$ mkdir ~/fig
$ ls
app.py  Dockerfile  fig.yml  requirements.txt
$ cat Dockerfile 
FROM python:2.7
ADD . /code
WORKDIR /code
RUN pip install -r requirements.txt
$ cat fig.yml 
web:
  build: .
  command: python app.py
  links:
   - db
  ports:
   - &quot;8000:8000&quot;
db:
  image: redis
$ cat requirements.txt 
flask
redis
$ cat app.py 
from flask import Flask
from redis import Redis
import os
app = Flask(__name__)
redis = Redis(host='redis', port=6379)

@app.route('/')
def hello():
    redis.incr('hits')
    return 'Hello World! I have been seen %s times.' % redis.get('hits')

if __name__ == &quot;__main__&quot;:
    app.run(host=&quot;0.0.0.0&quot;, debug=True)

</code></pre><p>Now use <code>sudo fig up</code> then you could let this web service run.</p><p>Met some problems, will be do this at home.</p></div><ul class=pagination><li class=page-item><a href=/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/page/147/ class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=/>1</a></li><li class=page-item><a class=page-link href=/page/2/>2</a></li><li class=page-item><a class=page-link href=/page/3/>3</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/147/>147</a></li><li class="page-item active"><a class=page-link href=/page/148/>148</a></li><li class=page-item><a class=page-link href=/page/149/>149</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/226/>226</a></li><li class=page-item><a href=/page/149/ class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/226/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div><script src=http://purplepalmdash.github.io/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>