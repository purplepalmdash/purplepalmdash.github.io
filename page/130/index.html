<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta name=generator content="Hugo 0.64.0"><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Dash &#183; Dash</title><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-a.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/custom-additions.css?ref=abc124"><link rel=stylesheet href=https://purplepalmdash.github.io/css/highlight/googlecode.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script type=text/javascript src=/js/html2canvas.js></script><script type=text/javascript>function genPostShot(){var rightNow=new Date();var imageName=rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");imageName+='.jpg'
html2canvas(document.getElementsByClassName('post'),{background:'#FFFFFF',onrendered:function(canvas){$('#test').attr('href',canvas.toDataURL("image/jpeg"));$('#test').attr('download',imageName);$('#test')[0].click();}});};</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=apple-touch-icon-precomposed sizes=144x144 href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124"><link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel=icon><link href=%7balternate%20%7bRSS%20application/rss+xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/index.xml%20http://purplepalmdash.github.io/index.xml%7d rel=alternate type=application/rss+xml title="Dash &#183; Dash"><meta name=description content><meta name=keywords content="unix,virtualization,embedded,linux"></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><img src=http://purplepalmdash.github.io/images/mylogo.jpeg alt=gravatar><h1><a href=http://purplepalmdash.github.io/>很惭愧，就做了一点微小的工作</a></h1><a href=http://purplepalmdash.github.io/><p>Dash</p></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/post/>All Posts</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/technology/>Technology</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/life/>Life</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/linuxtips/>LinuxTips</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/purplepalmdash><i class="fa fa-github-square fa-3x"></i></a><a href=https://cn.linkedin.com/in/yang-feipeng-1b909319><i class="fa fa-linkedin-square fa-3x"></i></a><a href=https://plus.google.com/u/0/106572959364703833986><i class="fa fa-google-plus-square fa-3x"></i></a><a href=https://www.facebook.com/yang.feipeng><i class="fa fa-facebook-square fa-3x"></i></a><a href=https://twitter.com/dashwillfly><i class="fa fa-twitter-square fa-3x"></i></a></li></ul></div></div><div class="content container"><div class=posts><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2015/10/14/tips-on-cloud-init-and-cloudstack/>Tips on Cloud-Init and CloudStack(2)</a></h1><span class=post-date>Oct 14, 2015<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=cloudmonkey-resize>Cloudmonkey Resize</h3><p>First deploy the VM in <code>stopped</code> status:</p><pre><code>(local) mycloudmonkey&gt; deploy virtualmachine startvm=false
serviceofferingid=683f31f8-a939-468e-b4de-4512a8ccff8e
templateid=13fb2961-533e-4a7d-80f9-21d860269aad
zoneid=78509dc3-c828-429c-8154-9fffbc09384c
networkids=7c6e7e6b-6aa2-4f95-a835-8d18bf930061 name=testuserdata50G userdata='...`

</code></pre><p>Now resize the root volume into 50G size:</p><pre><code>
deploy virtualmachine serviceofferingid=ff775183-282b-48d7-b08e-eff51fef7683
templateid=67ca66ea-b021-4f91-ac8c-ff95f2576c9d
zoneid=1a258852-831c-4612-94f4-2551a98667bb name=testuserdata
userdata='Q29udGVudC1UeXBlOiBtdWx0aXBhcnQvbWl4ZWQ7IGJvdW5kYXJ5PSI9PT09PT09PT09PT09PT0xOTk5MDU5OTcyMjA5ODg1MjY2PT0iCk1JTUUtVmVyc2lvbjogMS4wCgotLT09PT09PT09PT09PT09PTE5OTkwNTk5NzIyMDk4ODUyNjY9PQpDb250ZW50LVR5cGU6IHRleHQveC1zaGVsbHNjcmlwdDsgY2hhcnNldD0idXMtYXNjaWkiCk1JTUUtVmVyc2lvbjogMS4wCkNvbnRlbnQtVHJhbnNmZXItRW5jb2Rpbmc6IDdiaXQKQ29udGVudC1EaXNwb3NpdGlvbjogYXR0YWNobWVudDsgZmlsZW5hbWU9ImhlbGxvX3dvcmxkLnNoIgoKIyEvYmluL2Jhc2gKZWNobyAiaGVsbG8gd29ybGQhIiA+PiAvcm9vdC90ZXN0CgotLT09PT09PT09PT09PT09PTE5OTkwNTk5NzIyMDk4ODUyNjY9PQpDb250ZW50LVR5cGU6IHRleHQvY2xvdWQtY29uZmlnOyBjaGFyc2V0PSJ1cy1hc2NpaSIKTUlNRS1WZXJzaW9uOiAxLjAKQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZzogN2JpdApDb250ZW50LURpc3Bvc2l0aW9uOiBhdHRhY2htZW50OyBmaWxlbmFtZT0ibXktdXNlci1kYXRhIgoKI2Nsb3VkLWNvbmZpZwpncm93cGFydDoKICBtb2RlOiBhdXRvCmNocGFzc3dkOiB7IGV4cGlyZTogRmFsc2UgfQpzc2hfcHdhdXRoOiBUcnVlCgpzc2hfYXV0aG9yaXplZF9rZXlzOgogLSBzc2gtcnNhIEFBQUFCM056YUMxeWMyRUFBQUFEQVFBQkFBQUJBUUNzMFA4aFNCM05qN2tmd2lRT01PQ0Z2RXVqd3JLZjVuUFdmdzdzbmplVzd3TnhCYi9pTHhqbGxIK0tJdjdpS0dRaGI5WGtpZ3dXelhjdktSRk9OQTF0UU5CUHBsUE9RQXhHYUpoYzcxYlhZTVRabWsxcmZ5L0U4bUZIQmJ3U0trdm04Z3oxaFVqQWFITHdiZ21iaUE3eUNDUkVXbVR1SWpudm1FZnJXYU92WERRZFFPb2RkSzFhZThKM3BnRUNtQ21mRldrQmR3Y1JaN05jTUxBSkVkYTNpYWtJbWdaR2NqTWNCc1hjUUNOcjN1RGlKbERvc1V6Mjg4L3grTnZteTlzcHZnc2x4RXVUV0VQWFRGY1l5eVBrUHdkTnlpQm5TaWFoZTExcUdUZkk0Z2IyWllEb3JDZU5Ca1QxdkVaY0psL1JqT3NKRUFXT04rbno3Nm16MmdhZCByb290QHItOS1WTSAKCnRpbWV6b25lOiBBc2lhL0Nob25ncWluZwoKLS09PT09PT09PT09PT09PT0xOTk5MDU5OTcyMjA5ODg1MjY2PT0tLQo='
</code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2015/10/13/cloud-init-grow-partition/>Cloud-Init Grow Partition</a></h1><span class=post-date>Oct 13, 2015<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=resize-qcow2>Resize QCOW2</h3><p>Resize qcow2 file via:</p><pre><code>$ qemu-img info my_vm.img
image: my_vm.img
file format: qcow2
virtual size: 2.2G (2361393152 bytes)
disk size: 904M
cluster_size: 65536
Format specific information:
    compat: 1.1
    lazy refcounts: false
$ qemu-img resize my_vm.img +100G
Image resized.
$ qemu-img info my_vm.img
image: my_vm.img
file format: qcow2
virtual size: 102G (109735575552 bytes)
disk size: 904M
cluster_size: 65536
Format specific information:
    compat: 1.1
    lazy refcounts: false
</code></pre><h3 id=enlarge-partition>Enlarge Partition</h3><p>Modify the meta-data, and enable the partition grow options in user-data:</p><pre><code>$ vim my-user-data
#cloud-config
+ growpart:
+   mode: auto
password: xxxxxxxx
chpasswd: { expire: False }
ssh_pwauth: True

ssh_authorized_keys:
 - ssh-rsa xxxxxxxxxxx
timezone: Asia/Chongqing

$ cat my-meta-data 
instance-id: d59656d7-b365-4940-ae95-9168c32c68b7
$ echo &quot;instance-id: $(uuidgen || echo i-abcdefg)&quot; &gt; my-meta-data
$ cat my-meta-data 
instance-id: 5cad0dc4-facb-4079-b045-fbbc05caaf4a
</code></pre><p>Regenerate the image:</p><pre><code>$ rm -f my-seed.img
$ cloud-localds my-seed.img my-user-data my-meta-data
</code></pre><p>Restart the vm then you could get the disk resized.</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2015/10/13/linux-tips-3/>Linux Tips 3</a></h1><span class=post-date>Oct 13, 2015<br><a class=a_cat href=http://purplepalmdash.github.io/categories/linuxtips>LinuxTips</a></span><h3 id=1-tips-on-cloud-init>1. Tips on Cloud-Init</h3><p><a href=http://www.cnblogs.com/smallcoderhujin/p/4238609.html>http://www.cnblogs.com/smallcoderhujin/p/4238609.html</a></p><h3 id=2-access-cloudstack-vr>2. Access CloudStack VR</h3><p>Get the VR IP address from the CloudStack Web Interface:</p><p><img src=/images/2015_10_13_15_46_59_464x499.jpg alt=/images/2015_10_13_15_46_59_464x499.jpg></p><p>Then get the ssh connection via(On Agent Node):</p><pre><code>[root@csmgmt ~]# ssh -i .ssh/id_rsa.cloud -p3922 169.254.1.177  
Linux r-9-VM 3.2.0-4-amd64 #1 SMP Debian 3.2.65-1+deb7u2 x86_64
.......
root@r-9-VM:~#
</code></pre><h3 id=3-cloudmonkey-issue>3. Cloudmonkey issue</h3><p>Couldnot start cloudmonkey, use virtualenv for starting:</p><pre><code>$ yum install -y python-virtualenv
$ virtualenv venv --python=python2.6
$ . venv/bin/activate
$ pip install cloudmonkey
</code></pre><p>Then you could start cloudmonkey in venv environment.</p><h3 id=4-cloud-performance-testing>4. Cloud Performance Testing</h3><p>Cloud Performance testing URL.</p><pre><code>http://www.qyjohn.net/?p=2715
http://www.ccf.org.cn/resources/1190201776262/2011/10/17/2.pdf
http://www.os-easy.com/News/2014-10/526.html
</code></pre><h3 id=5-installation-of-vbox-ext-packs>5. Installation Of VBox Ext Packs</h3><p>When installing the ext packages:</p><p><img src=/images/2015_10_16_06_46_53_640x268.jpg alt=/images/2015_10_16_06_46_53_640x268.jpg></p><p>The reason is because the installation program need the root priviledge while
the awesome desktop didn&rsquo;t support it. By installing the <code>gksu</code> packages from
pacman you could solve it.</p><p>More tips on uninstalling ext and re-installing ext:</p><pre><code>$ VBoxManage extpack install
Oracle_VM_VirtualBox_Extension_Pack-5.0.4.vbox-extpack 
0%...
Progress state: NS_ERROR_FAILURE
VBoxManage: error: Failed to install
&quot;/home/xxxxxxx/.config/VirtualBox/Oracle_VM_VirtualBox_Extension_Pack-5.0.4.vbox-extpack&quot;
VBoxManage: error: Extension pack 'Oracle VM VirtualBox Extension Pack' is
already installed. In case of a reinstallation, please uninstall it first
VBoxManage: error: Details: code NS_ERROR_FAILURE (0x80004005), component
ExtPackManagerWrap, interface IExtPackManager
VBoxManage: error: Context: &quot;RTEXITCODE handleExtPack(HandlerArg*)&quot; at line
1158 of file VBoxManageMisc.cpp
$ VBoxManage list extpacks
Extension Packs: 1
Pack no. 0:   Oracle VM VirtualBox Extension Pack
Version:      5.0.0
Revision:     101573
Edition:      
Description:  USB 2.0 and USB 3.0 Host Controller, Host Webcam, VirtualBox
RDP, PXE ROM, Disk Encryption.
VRDE Module:  VBoxVRDP
Usable:       true 
Why unusable: 
$ VBoxManage extpack uninstall 'Oracle VM
VirtualBox Extension Pack'
0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%
Successfully uninstalled &quot;Oracle VM VirtualBox Extension Pack&quot;.
$ VBoxManage extpack install
Oracle_VM_VirtualBox_Extension_Pack-5.0.4.vbox-extpack
0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%
Successfully installed &quot;Oracle VM VirtualBox Extension Pack&quot;.
</code></pre><p>Now you got the newest ext packages installed for VirtualBox.</p><h3 id=6-change-cursor-in-awesome>6. Change Cursor In Awesome</h3><p>Download the theme from:<br><a href="http://gnome-look.org/content/show.php?content=48837">http://gnome-look.org/content/show.php?content=48837</a></p><p>Extract it to your ~/.icon/, and add following items into your configuration
file:</p><pre><code>$ cat ~/.xinitrc
etroot -cursor_name Neutral_Plus
$ cat ~/.Xdefaults
Xcursor.theme: Neutral_Plus
</code></pre><p>Now restart your X you could got Neutral_Plus working. The same method could
be done to aero mouse or more, but the background image is a big issue.</p><h3 id=7-cloudstack-chinese-docs>7. CloudStack Chinese Docs</h3><pre><code>http://cloudstack-installation-zh-cn.readthedocs.org/zh_CN/latest/hypervisor/lxc.html
</code></pre><h3 id=8-iptables-forward>8. Iptables forward</h3><p>Added at the first:</p><pre><code>sudo iptables -t filter -I FORWARD -j ACCEPT
</code></pre><h3 id=9-preseed-using-local-repository>9. preseed using local repository</h3><p>Using the local repository for installation.</p><pre><code>d-i mirror/country string manual
d-i mirror/http/hostname string 192.168.1.13
d-i mirror/http/directory string /ubuntu
d-i mirror/http/proxy string

d-i apt-setup/restricted boolean true
d-i apt-setup/universe boolean true
d-i apt-setup/backports boolean true
d-i apt-setup/services-select multiselect security
d-i apt-setup/security_host string 192.168.1.13
d-i apt-setup/security_path string /ubuntu
</code></pre><p>Change the repository after installation:</p><pre><code>d-i preseed/late_command string wget http://192.168.1.13/sources.list.13 -O
/target/etc/apt/sources.list
</code></pre><h3 id=10-static-ip-configuration-for-cloud-init>10. Static IP Configuration For Cloud-Init</h3><p>On Cloud-Init Configuration of Static IP.</p><pre><code>https://access.redhat.com/articles/rhel-atomic-cloud-init-faq
</code></pre><h3 id=11-forwarding-ssh-access-to-inner>11. Forwarding SSH Access To Inner</h3><p>This will forward the connection to 10003 to 10.0.0.3&rsquo;s 22 port, thus you will access
the inner machine via <code>ssh -p 10003 xxxx@192.168.10.187</code>.</p><pre><code># iptables -t nat -A PREROUTING -d 192.168.10.187 -p tcp --dport 10003 -j DNAT \
--to-destination 10.0.0.3:22
# iptables-save &gt;/etc/sysconfig/iptables
</code></pre><h3 id=12-on-perforce-monitor-tools>12. On Perforce Monitor Tools</h3><p>graphite and collectd:</p><pre><code>http://www.infoq.com/cn/articles/graphite-intro
http://www.vpsee.com/2012/05/install-graphite-on-ubuntu-12-04/
http://www.vpsee.com/2012/05/use-collectd-with-graphite-to-monitor-servers/
https://collectd.org/wiki/index.php/Plugin:libvirt
http://www.drupal001.com/2012/07/system-monitor-collectd/

</code></pre><h3 id=13-more-tips-for-performance-monitor>13. More tips for Performance Monitor</h3><pre><code>http://www.unixmen.com/install-graphite-centos-7/
http://blog.csdn.net/crazyhacking/article/details/8363235
http://blog.csdn.net/puncha/article/details/9112293
http://skaka.me/blog/2015/07/21/kamon-statsd-graphite-grafana-introduction/
https://codeascraft.com/2011/02/15/measure-anything-measure-everything/
http://devops.com/2014/09/02/guide-modern-monitoring-alerting/
http://network.51cto.com/art/201505/475518_5.htm
</code></pre><h3 id=14-log-system>14. Log System</h3><pre><code>http://devops.com/2014/09/02/guide-modern-monitoring-alerting/
http://network.51cto.com/art/201505/475518_all.htm
https://linux.cn/article-5252-shareweibo.html
http://kibana.logstash.es/content/logstash/index.html
https://www.digitalocean.com/community/tutorials/how-to-install-and-use-graphite-on-an-ubuntu-14-04-server
</code></pre><h3 id=15-discussion-on-monitor>15. Discussion on monitor</h3><p><a href=http://segmentfault.com/q/1010000000116157>http://segmentfault.com/q/1010000000116157</a></p><h3 id=16-simulation>16. Simulation</h3><p>Online simulation for electronics:<br><a href=https://www.systemvision.com/>https://www.systemvision.com/</a></p><h3 id=17-website-generator>17. Website Generator</h3><p>hugo:</p><p><a href=http://gohugo.io/overview/introduction/>http://gohugo.io/overview/introduction/</a></p><h3 id=18-install-collectd-on-centos6>18. Install Collectd On CentOS6</h3><pre><code>$ http://giovannitorres.me/how-to-build-rpms-collectd-example.html
$ http://giovannitorres.me/enabling-almost-all-collectd-plugins-on-centos-6.html
</code></pre><h3 id=19-view-centos-version>19. View CentOS Version</h3><pre><code># cat /etc/redhat-release 
CentOS Linux release 7.1.1503 (Core) 
</code></pre><h3 id=20-get-collectd-packages>20. Get Collectd Packages</h3><pre><code># wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo
# yum install --downloadonly --downloaddir=/root/Collectd collectd*
</code></pre><h3 id=21-vagrant-verification>21. Vagrant Verification</h3><pre><code># mkdir collectdtest
# cd collectdtest/
# vagrant box list
centos66        (virtualbox, 0)
vagrant_machine (virtualbox, 0)
# vagrant init centos66
# vagrant up
Bringing machine 'default' up with 'virtualbox' provider...

</code></pre><h3 id=22-cockpit>22. Cockpit</h3><pre><code>Cockpit由红帽公司开发，旨在让服务器管理起来更容易。借助这个基于Web的GUI，你就能处理众多任务，比如管理存储资源、检查日志、启动/终止服务以及监控多台服务器。Cockpi可以在Fedora Server、Arch Linux、CentOS Atomic、Fedora Atomic和红帽企业级Linux(RHEL)上运行。

相关链接：http://cockpit-project.org
</code></pre><h3 id=23-openwrt-dhcp-pool-configuration>23. OpenWRT DHCP Pool Configuration</h3><p>By Luci is very hard to find, so directly edit it under terminal.</p><pre><code># vi /etc/config/dhcp
config dhcp 'lan'
        option interface 'lan'
        option start '100'
        option limit '150'
        option leasetime '12h'
</code></pre><h3 id=24-read-only-system-in-centos-6>24. Read-Only System In CentOS 6</h3><p>Enter root&rsquo;s password, and then remount the filesystem via following command:</p><pre><code>#  mount -o remount,rw /
</code></pre><p>Now you could edit your filesystem and configure its configuration files.</p><h3 id=25-archlinux-nf_conntrack-limitation>25. ArchLinux nf_conntrack limitation</h3><pre><code># vim /etc/sysctl.d/99-sysctl.conf
net.netfilter.nf_conntrack_max = 1048576
# sysctl --system

</code></pre><h3 id=26-conntrack调优>26. Conntrack调优</h3><p><a href=http://www.linuxsky.org/doc/admin/200704/35.html>http://www.linuxsky.org/doc/admin/200704/35.html</a></p><h3 id=27-qemu-with-openvswitch>27. Qemu With OpenVswitch</h3><p><a href="http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.KVM;hb=HEAD">http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.KVM;hb=HEAD</a></p><p><a href=https://airtower.wordpress.com/2012/12/26/multiple-network-devices-in-kvm/>https://airtower.wordpress.com/2012/12/26/multiple-network-devices-in-kvm/</a></p><h3 id=28-ubuntu-ffmpeg>28. Ubuntu ffmpeg</h3><pre><code>$ axel http://ffmpeg.org/releases/ffmpeg-2.8.1.tar.bz2
$ sudo apt-get install yasm
$ sudo apt-get install -y libx264-142 libx264-dev
$ sudo apt-get install -y libfaac0 libfaac-dev
$ sudo apt-get install -y libmp3lame-dev libmp3lame0
$ sudo apt-get install libtheora-dev libtheora0
$ sudo apt-get install libvorbis-dev
$ sudo apt-get install libxvidcore-dev
$ tar xjvf ffmpeg-2.8.1.tar.bz2
$ cd ffmpeg-2.8.1
$ ./configure --enable-gpl --enable-version3 --enable-nonfree --enable-postproc
--enable-pthreads --enable-libfaac  --enable-libmp3lame --enable-libtheora
--enable-libx264 --enable-libxvid --enable-x11grab --enable-libvorbis --prefix=/usr
$ make -j4 
$ sudo make install
</code></pre><h3 id=29-use-pdftk-for-splitting-pdf>29. Use pdftk For Splitting PDF</h3><pre><code>$ sudo apt-get install -y pdftk
$ pdftk A=book.pdf cat A75-84 output Cut.pdf 
</code></pre><h3 id=30-teamviewer-related>30. Teamviewer Related</h3><p>On Ubuntu14.04 Server, install lightdm and fluxbox:</p><pre><code># apt-get install -y lightdm fluxbox sakura
# vim /usr/share/xsessions/lightdm-xsession.desktop
[Desktop Entry]
Version=1.0
Name=Default Xsession
Exec=fluxbox
Icon=
Type=Application
</code></pre><p>Now you could select fluxbox for using at the startup screen.</p><p>Auto-login into fluxbox:</p><pre><code># vim /etc/lightdm/lightdm.conf
[SeatDefaults]
autologin-user=adminubuntu
autologin-user-timeout=0
</code></pre><p>Install teamviewer, first download the teamviewer&rsquo;s deb from its official website, then
install it via:<br>Remember to manually resolve the dependencies.</p><pre><code># dpkg --add-architecture i386
# apt-get update
# dpkg -i teamviewer_11.0.50678_i386.deb
# apt-get -f install
</code></pre><p>Be sure to turn off the ufw to allow the connection:</p><pre><code># sudo ufw disable
</code></pre><p>Automatically save your screen via adding following definition:</p><pre><code>$ vim ~/.config/.fluxbox/startup
+ xscreensaver&amp;

</code></pre><h3 id=31-monitor-docker-filesystem>31. Monitor Docker filesystem</h3><p><a href=https://sysdig.com/monitoring-docker-file-systems-and-file-io-with-sysdig-cloud/>https://sysdig.com/monitoring-docker-file-systems-and-file-io-with-sysdig-cloud/</a></p><h3 id=32-socat-connection>32. Socat Connection</h3><p>Reuse the ports:</p><pre><code>vps# socat TCP4-LISTEN:2222,reuseaddr,fork TCP4:localhost:3322
</code></pre><h3 id=33-office-2013>33. Office 2013</h3><p>activate the serial no together with your office installation.</p><p><a href="http://www.zhihu.com/collection/38938285?page=1">http://www.zhihu.com/collection/38938285?page=1</a></p><h3 id=34-linux-and-music>34. Linux And Music</h3><p><a href=https://www.maketecheasier.com/linux-learning-music/>https://www.maketecheasier.com/linux-learning-music/</a></p><h3 id=35-ia32-libs>35. ia32-libs</h3><p>To install ia32-libs, using raring repository, after installation , remove
this repository:</p><pre><code>sudo apt-get install libc6:i386
sudo -i
cd /etc/apt/sources.list.d
echo &quot;deb http://old-releases.ubuntu.com/ubuntu/ raring main restricted
universe multiverse&quot; &gt;ia32-libs-raring.list
apt-get update
apt-get install ia32-libs
rm /etc/apt/sources.list.d/ia32-libs-raring.list
apt-get update
exit
sudo apt-get install gcc-multilib
</code></pre><h3 id=36-install-libc6-in-debian>36. Install libc6 in Debian</h3><p>The newer version.</p><pre><code>    Add the following line to the file /etc/apt/sources.list:
    deb http://ftp.debian.org/debian experimental main
    Update your package database:
    apt-get update
    Install the eglibc package:
    apt-get -t experimental install libc6-amd64 libc6-dev libc6-dbg
</code></pre><h3 id=37-teamviewer-connection>37. Teamviewer connection</h3><p>In order to connect the remote machine, close the ufw, then you could directly connect
to</p><pre><code>teamViewer? Open 80, 443 and 5938-5939 port.
# ufw disable
</code></pre><h3 id=38-pygment-error>38. Pygment Error</h3><p>When you encounter following error:</p><pre><code>Error:  Pygments can't parse unknown language: &lt;/p&gt;
</code></pre><p>Then edit <code>plugins/pygments_code.rb</code>:</p><pre><code>rescue MentosError
   raise &quot;Pygments can't parse unknown language: #{lang}#{code}.&quot;
end
</code></pre><p>Now <code>rake generate</code> again, you will see the error hints, modify the
corresponding markdown page.</p><h3 id=39-install-rhc>39. Install rhc</h3><p>For installing rhc on your machine, while your machine is Ubuntu14.04, you could only
use gem for installing, while in vivid or later you could directly <code>apt-get install rhc</code>:</p><pre><code>$ sudo gem install rhc
$ rhc setup
</code></pre><h3 id=40-pelican-openshift>40. pelican-openshift</h3><h3 id=41-show-pop-up-dialog>41. Show Pop-Up Dialog</h3><p>Show the message with a dialog.</p><pre><code>zenity --info --text=&quot;Calculation complete&quot;
</code></pre><p>Remote show:</p><pre><code>ssh -Y xxxx@192.168.0.119 'zenity --info --text=&quot;Calculation complete&quot;'
  
### 42. Git tips
Remove the remote branch:    

</code></pre><h1 id=git-push-origin---delete-c0de>git push origin &ndash;delete c0de</h1><pre><code>
Check the remote's branch:    

</code></pre><p>$ git remote show origin</p><ul><li>remote origin
Fetch URL: <a href=https://github.com/xxxxxxxxxxxxxxxx>https://github.com/xxxxxxxxxxxxxxxx</a>
Push URL: <a href=https://github.com/xxxxxxxxxxxxxxxxx>https://github.com/xxxxxxxxxxxxxxxxx</a>
HEAD branch: master
Remote branches:
code tracked
gh-pages tracked
master tracked</li></ul><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><p>4a0fd58a35726d413edcc93e2e7dcfe31d4861ac</p></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><pre><code>
### 43. Add another IP
Add the 10 subnet IP Address.  

</code></pre><h1 id=ifconfig-ovsbr010-1921681011924>ifconfig ovsbr0:10 192.168.10.119/24</h1><pre><code>
### 44. Chromebook Using Samba
Install samba client:   

</code></pre><p>$ sudo apt-get install samba smbclient</p><pre><code>
Detect the remote samba server's sharing folder:    

</code></pre><p>$ sudo smbclient -L 192.168.0.119 -U%</p><pre><code>But still you could not mount the remote machine. Finally i have to install the plugins
from chromestore which named `File System For Windows`.     

Still, mount with some problems when using samba server of Ubuntu.    

### 45. oh-my-zsh
Install oh-my-zsh via:    

</code></pre><h1 id=sh--c-wget-httpsrawgithubcomrobbyrusselloh-my-zshmastertoolsinstallsh--o>sh -c &ldquo;$(wget <a href=https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh>https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh</a> -O</h1><p>-)&rdquo;</p><h1 id=vim-zshrc>vim ~/.zshrc</h1><p>ZSH_THEME="agnoster&rdquo;</p><pre><code>
Select the theme in konsole for Solarized, then you got pretty good looking for your
zsh.      


### 46. Surface Pro Issue

</code></pre><p>gpg &ndash;keyserver pgpkeys.mit.edu &ndash;recv-key 38DBBDC86092693E
gpg &ndash;keyserver pgpkeys.mit.edu &ndash;recv-key 79BE3E4300411886</p><p><a href=https://github.com/nuclearsandwich/surface3-archlinux>https://github.com/nuclearsandwich/surface3-archlinux</a>
<a href=https://www.reddit.com/r/SurfaceLinux/comments/2b1hf6/running_ubuntu_1404_on_surface_pro_1_full_time/>https://www.reddit.com/r/SurfaceLinux/comments/2b1hf6/running_ubuntu_1404_on_surface_pro_1_full_time/</a>
Marvell:
<a href=https://origin-www.marvell.com/wireless/avastar/88W8897/>https://origin-www.marvell.com/wireless/avastar/88W8897/</a></p><p>Good, signature:
<a href=http://www.cyberciti.biz/faq/pgp-tarball-file-signature-keys-verification/>http://www.cyberciti.biz/faq/pgp-tarball-file-signature-keys-verification/</a></p><pre><code>
### 47. Ceph Example
[https://linux.cn/article-6624-1.html?utm_source=weibo&amp;utm_medium=weibo](https://linux.cn/article-6624-1.html?utm_source=weibo&amp;utm_medium=weibo)    

### 48. Daily Cron
You should edit the following configuration file for customize your own crontab task
for everyday/everyweek/everymonth:    

</code></pre><p>$ vim /etc/crontab</p><p>17 * * * * root cd / && run-parts &ndash;report /etc/cron.hourly
25 6 * * * root test -x /usr/sbin/anacron || ( cd / && run-parts &ndash;report
/etc/cron.daily )
47 6 * * 7 root test -x /usr/sbin/anacron || ( cd / && run-parts &ndash;report
/etc/cron.weekly )
52 6 1 * * root test -x /usr/sbin/anacron || ( cd / && run-parts &ndash;report
/etc/cron.monthly )</p><pre><code>
For example, change the `25 6` to `25 12`, thus change the daily crontab task from 6:25
AM to 12:25 AM of the day.    

### 49. SRX Issue
[https://www.citrix.com/blogs/2015/11/05/configure-juniper-srx-in-cloudplatform/](https://www.citrix.com/blogs/2015/11/05/configure-juniper-srx-in-cloudplatform/)   


### 50. Quickly For AlsaMixer

</code></pre><p>$ sudo pacman -S alsa-utils
$ amixer sset Master unmute
$ mplay *.mp3</p><pre><code>
### 51. x2x
Synergy could lost connection between client/server, so I have to change to x2x, simply
do following then I could setup the connection between 2 machines and sharing the
mouse/keyboard.     

Ubuntu As Server

</code></pre><p>$ sudo apt-get install -y x2x</p><pre><code>
Arch As Client

</code></pre><p>$ yaourt x2x
&mldr;.
2 aur/x2x-git</p><pre><code>
Then we start sharing the server's keyboard/mouse via:    

</code></pre><p>$ ssh -X 10.0.80.17 x2x -west -to :0</p><pre><code>
Todo: while the shortcuts are not OK. You have to use mouse for switching the screen.     

### 48. tips for Nov24
freescale's debugging/ Customize OpenStack. 

### 49. ArchLinux ntp
First setup the timezone of the machine via:    

</code></pre><p>$ timedatectl list-timezones</p><h1 id=timedatectl-set-timezone-asiashanghai>timedatectl set-timezone Asia/Shanghai</h1><pre><code>
Enable the openntp service:    

</code></pre><p>$ sudo pacman -S openntpd
$ sudo systemctl enable openntpd
$ sudo systemctl start openntpd</p><pre><code>
### 50. xfs partition
Create xfs parted .      

</code></pre><p>mkfs.xfs -f /dev/vdb1</p><pre><code>
### 51. Tips For Ceph
[http://wyq.me/blog/2015/06/17/centos7%E4%B8%8B%E9%85%8D%E7%BD%AEceph%EF%BC%8C%E5%8C%85%E6%8B%ACobject-storage%E5%92%8Ccephfs/](http://wyq.me/blog/2015/06/17/centos7%E4%B8%8B%E9%85%8D%E7%BD%AEceph%EF%BC%8C%E5%8C%85%E6%8B%ACobject-storage%E5%92%8Ccephfs/)    

[http://www.docoreos.com/?p=99](http://www.docoreos.com/?p=99)    

### 52. Boot Linux In 1 Second
[http://elinux.org/images/9/97/Boot_one_second_altenberg.pdf](http://elinux.org/images/9/97/Boot_one_second_altenberg.pdf)    

### 53. collectd on Ubuntu
Configuration should be activated via:    

</code></pre><p>&lt;Plugin &ldquo;sensors">
Sensor &ldquo;it8712-isa-0290/voltage-in1&rdquo;
IgnoreSelected true</p><pre><code>
### 54. Bluetooth
How to enable bluetooth PAN?    

[https://wiki.gentoo.org/wiki/Bluetooth_Network_Aggregation_Point#BlueZ_5_method](https://wiki.gentoo.org/wiki/Bluetooth_Network_Aggregation_Point#BlueZ_5_method)    

### 55. Quickly Using Kernel Configuration

</code></pre><h1 id=cp-procconfiggz--mntgentoousrsrclinux>cp /proc/config.gz /mnt/gentoo/usr/src/linux</h1><h1 id=chroot-mntgentoo-binbash>chroot /mnt/gentoo /bin/bash</h1><h1 id=cd-usrsrclinux>cd /usr/src/linux</h1><h1 id=gunzip-configgz>gunzip config.gz</h1><h1 id=mv--config-config>mv config .config</h1><h1 id=make--make-modules_install>make && make modules_install</h1><h1 id=cp-arch构架bzimage-bootkernel-xxx>cp arch/构架/bzImage /boot/kernel-xxx</h1><h1 id=rm--rf-bootgrubgrubcfg>rm -rf /boot/grub/grub.cfg</h1><h1 id=grub2-mkconfig--o-bootgrubgrubcfg>grub2-mkconfig -o /boot/grub/grub.cfg</h1><pre><code>
### 56. Use pip for installing

</code></pre><p>$ pip install dbus-python -i <a href=http://pypi.douban.com/simple>http://pypi.douban.com/simple</a> &ndash;trusted-host pypi.douban.com</p><pre><code>
### 57. Python based visualization

[https://github.com/shengxinjing/my_blog/issues/1](https://github.com/shengxinjing/my_blog/issues/1)    


### 58. F5 Based

</code></pre><p><a href=http://zyan.cc/f5_big_ip/>http://zyan.cc/f5_big_ip/</a>
<a href="https://support.f5.com/kb/en-us/products/big-ip_ltm/manuals/product/bigip-ve-setup-linux-kvm-11-5-0.html?sr=39135533">https://support.f5.com/kb/en-us/products/big-ip_ltm/manuals/product/bigip-ve-setup-linux-kvm-11-5-0.html?sr=39135533</a>
<a href=http://comments.gmane.org/gmane.comp.apache.cloudstack.user/10368>http://comments.gmane.org/gmane.comp.apache.cloudstack.user/10368</a></p><pre><code>
### 59. OVS On CentOS7
The main steps are listed as following, refers to
[https://n40lab.wordpress.com/2015/06/28/centos-7-installing-openvswitch-2-3-2-lts/](https://n40lab.wordpress.com/2015/06/28/centos-7-installing-openvswitch-2-3-2-lts/)    

</code></pre><h1 id=yum--y-install-wget-openssl-devel-gcc-make-python-devel-openssl-devel-kernel-devel-graphviz-kernel-debug-devel-autoconf-automake-rpm-build-redhat-rpm-config-libtool>yum -y install wget openssl-devel gcc make python-devel openssl-devel kernel-devel graphviz kernel-debug-devel autoconf automake rpm-build redhat-rpm-config libtool</h1><h1 id=adduser-ovs>adduser ovs</h1><h1 id=su---ovs>su - ovs</h1><p>$ mkdir -p ~/rpmbuild/SOURCES
$ wget <a href=http://openvswitch.org/releases/openvswitch-2.3.2.tar.gz>http://openvswitch.org/releases/openvswitch-2.3.2.tar.gz</a>
$ cp openvswitch-2.3.2.tar.gz ~/rpmbuild/SOURCES/
$ tar xfz openvswitch-2.3.2.tar.gz
$ sed &lsquo;s/openvswitch-kmod, //g&rsquo; openvswitch-2.3.2/rhel/openvswitch.spec >
openvswitch-2.3.2/rhel/openvswitch_no_kmod.spec
$ rpmbuild -bb &ndash;nocheck openvswitch-2.3.2/rhel/openvswitch_no_kmod.spec
$ exit</p><h1 id=mkdir-etcopenvswitch>mkdir /etc/openvswitch</h1><h1 id=yum-localinstall-homeovsrpmbuildrpmsx86_64openvswitch-232-1x86_64rpm>yum localinstall /home/ovs/rpmbuild/RPMS/x86_64/openvswitch-2.3.2-1.x86_64.rpm</h1><h1 id=systemctl-start-openvswitchservice>systemctl start openvswitch.service</h1><h1 id=chkconfig-openvswitch-on>chkconfig openvswitch on</h1><h1 id=ovs-vsctl--v>ovs-vsctl -V</h1><pre><code>
### 60. Performance/Monitoring/Testing For Linux
[https://linux.cn/article-3820-1-rel.html](https://linux.cn/article-3820-1-rel.html)    

### 61. Git Show Log
Show last 2 commit changes:   

</code></pre><h1 id=git---no-pager-log--p--2>git &ndash;no-pager log -p -2</h1><pre><code>
### 62. tessera in production
[https://thecustomizewindows.com/2014/07/monitoring-tools-dashboard-with-tessera/](https://thecustomizewindows.com/2014/07/monitoring-tools-dashboard-with-tessera/)   

### 63. Grafana Demo
[http://play.grafana.org/dashboard/db/big-dashboard](http://play.grafana.org/dashboard/db/big-dashboard)    

### 64. Change netmask
Quickly changing the netmask via ifconfig:    

</code></pre><p>$ sudo ifconfig ovsbr0 netmask 255.255.0.0</p><pre><code>
### 65. Disable tomcat6
via:    

</code></pre><h1 id=update-rcd-tomcat6-disable>update-rc.d tomcat6 disable</h1><pre><code>
### 66. Quickly get the alive IP
Using nmap and grep we could get the alive IP lists:    

</code></pre><p>$ nmap -v -sn 10.47.58.0/24 | grep &ldquo;up&rdquo; -B1</p><pre><code>
### 67. Run Cloudstack in Virtualbox
[http://cloud.51cto.com/art/201501/464053_all.htm](http://cloud.51cto.com/art/201501/464053_all.htm)    

### 68. View Freebsd mounted disk
View the freebsd mounted disk:    

</code></pre><p>$ cat /var/run/dmesg.boot</p><pre><code>
### 69. Remote ssh

hamachi, haguichi.    

[https://help.ubuntu.com/community/Hamachi](https://help.ubuntu.com/community/Hamachi)    

### 70. openxenmanager
Install openxenmanager for managing xenserver.  

### 71. Virtualbox Headless
For X is not stable, I have to use Virtualbox Headless mode for starting the virtualbox
machines.   

</code></pre><h1 id=vboxmanage-list-vms>VBoxManage list vms</h1><p>&ldquo;systemvm64template&rdquo; {dda28ddb-1faa-4f6c-bc01-0b48b449a0c9}
&ldquo;Elastistor&rdquo; {b5292c1b-8645-4f67-922d-863178310ce1}
&ldquo;CloudStack&rdquo; {f8295ba6-1004-4a4c-bf6d-5c2436723579}
&ldquo;csman&rdquo; {34e5323c-2a87-45a9-904e-455ff14ce91c}
&ldquo;Xen&rdquo; {15d2e83d-c719-423a-8168-699056b1efde}
&ldquo;Windows7&rdquo; {73a7249c-43e1-4885-bf6c-eae774bd7617}
&ldquo;cloudstack-elastistor&rdquo; {b967708b-6c0e-46f4-8062-a288b3fe21bc}</p><h1 id=vboxmanage-startvm-xen---type-headless>VBoxManage startvm Xen &ndash;type headless</h1><h1 id=vboxmanage-startvm-cloudstack-elastistor---type-headless>VBoxManage startvm cloudstack-elastistor &ndash;type headless</h1><pre><code>
### 72. chrome visit elastistor
using chromiu-browser for visiting elastistor will encounter following issue:    

</code></pre><p>ERR_SSL_WEAK_SERVER_EPHEMERAL_DH_KEY</p><pre><code>Solve it via:  
 
</code></pre><p>➜ ~ chromium-browser
&ndash;cipher-suite-blacklist=0x0088,0x0087,0x0039,0x0038,0x0044,0x0045,0x0066,0x0032,0x0033,0x0016,0x0013</p><pre><code>
### 73. Find which vm use img
For Centos64.img, which vm uses it?    

</code></pre><p>root@kspc002:/root# cat findwhichvm.sh
for i in <code>virsh list --all | sed -n '3~1p' | awk '{print $2}'</code>
do
virsh dumpxml $i | grep -i &ldquo;Centos64.img&rdquo;
done</p><pre><code>
### 74. Build DEB for qemu
[http://www.atrixnet.com/compile-qemu-from-source-and-make-a-debian-package-with-checkinstall/](http://www.atrixnet.com/compile-qemu-from-source-and-make-a-debian-package-with-checkinstall/)    

### 75. change uuid of the vbox

</code></pre><p>VBOXMANAGE.EXE internalcommands sethduuid</p><pre><code>
### 76. SDR

</code></pre><p><a href=https://mborgerson.com/getting-started-with-the-hackrf-one-on-ubuntu-14-04>https://mborgerson.com/getting-started-with-the-hackrf-one-on-ubuntu-14-04</a></p><pre><code>
### 77. RaspberryPI's FM
[https://bytesare.us/cms/index.php/geeky-toys/pi-as-fm-radio-mp3-transmitter](https://bytesare.us/cms/index.php/geeky-toys/pi-as-fm-radio-mp3-transmitter)    


### 78. SDR
Using SDR for listening satellite.    

[http://geek.csdn.net/news/detail/36794](http://geek.csdn.net/news/detail/36794)    

### 79. Build System VM For CloudStack
Change the Gemfile in tools/appliance:    

</code></pre><p>$ vim Gemfile
gem &lsquo;net-ssh&rsquo;, &lsquo;=2.9.2&rsquo;
gem &lsquo;fog-google&rsquo;, &lsquo;=0.1.0&rsquo;</p><pre><code>
### 80. veewee guideline
[https://cbednarski.com/articles/veewee/](https://cbednarski.com/articles/veewee/)    

### 79. XML prettifier
Via:    

</code></pre><p>curl -sL &ldquo;<a href=http://api.example.com/assets.xml%22>http://api.example.com/assets.xml"</a> | xmllint &ndash;format -</p><pre><code>
### 80. CloudStack On RaspberryPI

[http://www.claspi.org/](http://www.claspi.org/)    

### 81. CloudStack 4.7 On Ubuntu
When integrating with elastistor, meet following issue:    

</code></pre><p>root@ubuntucloudstack:/usr/share/cloudstack-management/webapps/client/WEB-INF/classes#
ls
META-INF resources scripts vms
root@ubuntucloudstack:/usr/share/cloudstack-management/webapps/client/WEB-INF/classes#</p><pre><code>

###  82. Xen Installation On Ubuntu
[https://www.futures.moe/writings/use-xen-pv-under-ubuntu-x14-04.htm](https://www.futures.moe/writings/use-xen-pv-under-ubuntu-x14-04.htm)    

### 83. LXC Container Template

</code></pre><h1 id=usrsharecloudstack-commonscriptsstoragesecondarycloud-install-sys-tmplt->/usr/share/cloudstack-common/scripts/storage/secondary/cloud-install-sys-tmplt \</h1><p>-m /mnt/secondary<br>-u <a href=http://cloudstack.apt-get.eu/systemvm/4.6/systemvm64template-4.6.0-kvm.qcow2.bz2>http://cloudstack.apt-get.eu/systemvm/4.6/systemvm64template-4.6.0-kvm.qcow2.bz2</a><br>-h lxc<br>-s<br>-F</p><pre><code>
### 84. Enable the cloudstack Debug info
Change the `INFO` into `DEBUG`:    

</code></pre><p>[root@csmgmt agent]# pwd
/etc/cloudstack/agent
[root@csmgmt agent]# ls
agent.properties environment.properties log4j-cloud.xml log4j-cloud.xml.back</p><pre><code>
### 85. Detect alive machine in one subnet
Using nmap for detecting alive machine in one subnet.    

</code></pre><p>for i in <code>nmap -v -sn 10.47.58.0/24 2>/dev/null | grep '^Nmap scan' | grep -v ']$' | awk {'print $5'} | grep -v '10.47.58.1$'</code>
do
echo $i
done</p><pre><code>
### 86. Run command in multiply machines
Define the inventory file, and run reboot command via:   

</code></pre><h1 id=ansible--i-inventory_mesos_cluster-all--m-shell--a-reboot>ansible -i inventory_mesos_cluster all -m shell -a &ldquo;reboot&rdquo;</h1><pre><code>
### 87. On building mesos
[http://8941355.blog.51cto.com/8931355/1712426](http://8941355.blog.51cto.com/8931355/1712426)    
</code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2015/10/12/tips-on-oz/>Tips On OZ</a></h1><span class=post-date>Oct 12, 2015<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=reference>Reference</h3><p>The reference URL is located at:<br><a href=http://www.chenshake.com/oz-making-centos-mirror/>http://www.chenshake.com/oz-making-centos-mirror/</a></p><h3 id=installation>Installation</h3><p>On CentOS 7, install oz via:</p><pre><code># yum install -y oz
# rpm -qa | grep oz-
oz-0.14.0-1.el7.noarch
</code></pre><h3 id=configuration>Configuration</h3><p>The configuration file for oz should be configured as:</p><pre><code># vim /etc/oz/oz.cfg 
[paths]
output_dir = /var/lib/libvirt/images
data_dir = /var/lib/oz
screenshot_dir = /var/lib/oz/screenshots
# sshprivkey = /etc/oz/id_rsa-icicle-gen

[libvirt]
uri = qemu:///system
#image_type = raw
image_type = qcow2
# type = kvm
bridge_name = virbr0
cpus = 1
memory = 1024
</code></pre><p>The configuration file for the oz should have one tdl file and one kickstart file:</p><pre><code># cat centos66.tdl 
&lt;template&gt;
   &lt;name&gt;centos_66_x86_64&lt;/name&gt;
   &lt;description&gt;CentOS 6.6 x86_64 template&lt;/description&gt;
   &lt;os&gt;
      &lt;name&gt;CentOS-6&lt;/name&gt;
      &lt;version&gt;6&lt;/version&gt;
      &lt;arch&gt;x86_64&lt;/arch&gt;
      &lt;install type='url'&gt;
         &lt;url&gt;http://192.168.0.79/ks_mirror/CentOS-6.6-x86_64&lt;/url&gt;
      &lt;/install&gt;
   &lt;/os&gt;
&lt;/template&gt;
</code></pre><p>Be sure the kickstart file should have the same url installtion location:</p><pre><code># cat centos6-oz.cfg 
text
skipx
install
url --url http://192.168.0.79/ks_mirror/CentOS-6.6-x86_64
repo --name=updates --baseurl=http://192.168.0.79/ks_mirror/CentOS-6.6-x86_64
lang en_US.UTF-8
</code></pre><h3 id=build-image>Build Image</h3><p>Build your own images via:</p><pre><code># oz-install -p -u -d1 -a centos6-oz.cfg centos66.tdl
</code></pre><p>Get the images via:</p><pre><code>[root@pc134 images]# pwd
/var/lib/libvirt/images
[root@pc134 images]# ls -l -h centos_66_x86_64.qcow2
-rw-rw-rw- 1 root root 1015M Oct 12 14:48 centos_66_x86_64.qcow2
</code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2015/10/12/tips-on-cloud-init/>Tips On Cloud-Init</a></h1><span class=post-date>Oct 12, 2015<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=参考>参考</h3><p>主要参考了<br><a href=http://huang-wei.github.io/programming/2013/12/23/run-cloud-init-in-local-kvm.html>http://huang-wei.github.io/programming/2013/12/23/run-cloud-init-in-local-kvm.html</a></p><p>这里主要记录的是操作步骤。</p><h3 id=介绍>介绍</h3><p>红帽介绍:<br>Cloud-Init 是一个用来自动配置虚拟机的初始设置（如主机名，网卡和密钥）的工具。它可以在
使用模板部署虚拟机时使用，从而达到避免网络冲突的目的。<br>在使用这个工具前，cloud-init 软件包必须在虚拟机上被安装。安装后，Cloud-Init 服务会在系
统启动时搜索如何配置系统的信息。您可以使用只运行一次窗口来提供只需要配置一次的设置信息
；或在 新建虚拟机、编辑虚拟机和编辑模板窗口中输入虚拟机每次启动都需要的配置信息。</p><h3 id=cloud-init安装>cloud-init安装</h3><p>Ubuntu 14.04上可以通过以下命令来安装cloud-init:</p><pre><code>$ apt-cache search cloud-utils
cloud-utils - metapackage for installation of upstream cloud-utils source
$ sudo apt-get install cloud-utils
</code></pre><h3 id=镜像准备>镜像准备</h3><p>在<a href=http://cloud-images.ubuntu.com/releases/>http://cloud-images.ubuntu.com/releases/</a>
可以找到Ubuntu制作的ubuntu cloud image, image分版本, 这里使用14.04的image。</p><pre><code>$ wget http://cloud-images.ubuntu.com/releases/14.04.3/
release-20151008/ubuntu-14.04-server-cloudimg-amd64-disk1.img
</code></pre><p>取回来后的镜像可以直接使用，但解压开后读取速度会更快:</p><pre><code>$ qemu-img convert -O qcow2 ubuntu-14.04-server-cloudimg-amd64-disk1.img my_vm.img
</code></pre><p>对比两个镜像大小可以看到:</p><pre><code>$ qemu-img info ubuntu-14.04-server-cloudimg-amd64-disk1.img 
image: ubuntu-14.04-server-cloudimg-amd64-disk1.img
file format: qcow2
virtual size: 2.2G (2361393152 bytes)
disk size: 246M
cluster_size: 65536
Format specific information:
    compat: 0.10
$ qemu-img info my_vm.img 
image: my_vm.img
file format: qcow2
virtual size: 2.2G (2361393152 bytes)
disk size: 903M
cluster_size: 65536
Format specific information:
    compat: 1.1
    lazy refcounts: false
</code></pre><h3 id=配置脚本内容>配置脚本内容</h3><p>my-user-data内容:</p><pre><code>$ cat my-user-data
#cloud-config
password: xxxxxx
chpasswd: { expire: False }
ssh_pwauth: True

ssh_authorized_keys:
 - ssh-rsa xxxxxx

timezone: Asia/Chongqing
</code></pre><p>通过my-user-data生成img文件:</p><pre><code>$ cloud-localds my-seed.img my-user-data
</code></pre><p>由之前的my_vm.img和my-seed.img文件启动虚拟机:</p><pre><code>$ qemu-system-x86_64 -net nic -net user,hostfwd=tcp::2222-:22 -hda my_vm.img -hdb my-seed.img -m 512
</code></pre><p>通过qemu的窗口或者ssh登录系统: <code>ssh -p 2222 ubuntu@localhost</code>.</p><h3 id=引入meta-data>引入meta-data</h3><p>meta-data的内容与虚拟机的实例相关，只用来做初始化，虚拟机实例运行完一次以后就不需要修改
。但如果要引入更新，则重建一下instance-id即可。</p><p>更新my-meta-data文件内容:</p><pre><code>$ echo &quot;instance-id: $(uuidgen || echo i-abcdefg)&quot; &gt; my-meta-data
</code></pre><p>由my-meta-data和my-user-data生成my-seed.img文件:</p><pre><code>$ cloud-localds my-seed.img my-user-data my-meta-data
</code></pre><p>启动虚拟机:</p><pre><code>$ qemu-system-x86_64 -net nic -net user,hostfwd=tcp::2222-:22 -hda my_vm.img -hdb my-seed.img -m 512
$ kvm -net nic -net user,hostfwd=tcp::2222-:22 -hda my_vm.img -hdb my-seed.img -m 512
</code></pre><h3 id=其他初始化行为>其他初始化行为</h3><p>需要初始化的脚本:</p><pre><code>$ cat hello_world.sh 
#!/bin/bash
echo &quot;hello world!&quot; &gt;&gt; /home/ubuntu/test
</code></pre><p>将初始化脚本和cloud config data合并:</p><pre><code>$ write-mime-multipart
--output=combined-userdata.txt hello_world.sh:text/x-shellscript my-user-data
</code></pre><p>由生成的combined-userdata.txt生成my-seed.img:</p><pre><code>$ echo &quot;instance-id: $(uuidgen || echo i-abcdefg)&quot; &gt; my-meta-data
$ cloud-localds my-seed.img combined-userdata.txt my-meta-data
</code></pre><p>重启后即可得到更新后的系统镜像.</p></div><ul class=pagination><li class=page-item><a href=/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/page/129/ class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=/>1</a></li><li class=page-item><a class=page-link href=/page/2/>2</a></li><li class=page-item><a class=page-link href=/page/3/>3</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/129/>129</a></li><li class="page-item active"><a class=page-link href=/page/130/>130</a></li><li class=page-item><a class=page-link href=/page/131/>131</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/237/>237</a></li><li class=page-item><a href=/page/131/ class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/237/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div><script src=http://purplepalmdash.github.io/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>