<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>使用Fuel部署OpenContrail(1) &#183; Dash</title><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-a.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/custom-additions.css?ref=abc124"><link rel=stylesheet href=https://purplepalmdash.github.io/css/highlight/googlecode.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script type=text/javascript src=/js/html2canvas.js></script><script type=text/javascript>function genPostShot(){var rightNow=new Date();var imageName=rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");imageName+='.jpg'
html2canvas(document.getElementsByClassName('post'),{background:'#FFFFFF',onrendered:function(canvas){$('#test').attr('href',canvas.toDataURL("image/jpeg"));$('#test').attr('download',imageName);$('#test')[0].click();}});};</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=apple-touch-icon-precomposed sizes=144x144 href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124"><link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel=icon><meta name=description content><meta name=keywords content="unix,virtualization,embedded,linux"></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><img src=http://purplepalmdash.github.io/images/mylogo.jpeg alt=gravatar><h1><a href=http://purplepalmdash.github.io/>Get busy living, or get busy dying.</a></h1><a href=http://purplepalmdash.github.io/><p>Dash</p></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/post/>All Posts</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/technology/>Technology</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/life/>Life</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/linuxtips/>LinuxTips</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/purplepalmdash><i class="fa fa-github-square fa-3x"></i></a><a href=https://cn.linkedin.com/in/yang-feipeng-1b909319><i class="fa fa-linkedin-square fa-3x"></i></a><a href=https://plus.google.com/u/0/106572959364703833986><i class="fa fa-google-plus-square fa-3x"></i></a><a href=https://www.facebook.com/yang.feipeng><i class="fa fa-facebook-square fa-3x"></i></a><a href=https://twitter.com/dashwillfly><i class="fa fa-twitter-square fa-3x"></i></a></li></ul></div></div><div class="content container"><div class=post><h1>使用Fuel部署OpenContrail(1)</h1><p align=right><a href=javascript:genPostShot()>TurnToJPG --> <i class="fa fa-camera-retro fa-2x"></i></a><a id=test></a></p><hr><span class=post-date>Apr 22, 2015<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><div id=_toc class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#先决条件>先决条件</a></li><li><a href=#cpu内存磁盘规划>CPU/内存/磁盘规划</a></li><li><a href=#网络规划>网络规划</a></li><li><a href=#各个节点网络配置>各个节点网络配置</a></li><li><a href=#miranti-fuel-node安装>Miranti Fuel Node安装</a></li></ul></li></ul></nav></div><p>最近在做OpenContrail的解耦合操作，因为官方提供的OpenContrail一键安装包里诸多组件都是用的默认的推荐，通过解耦合可以做到更灵活的安装和配置，有利于更方便的部署和后续的维护。所以这一系列文章是关于如何用Fuel在部署完OpenStack的基础上完成OpenContrail的部署。</p><h3 id=先决条件>先决条件</h3><p>先决条件主要是用于准备用于部署的硬件环境和软件包。<br>硬件环境:<br>i5-4460(3.2GHz/4核/6M三级缓存), 32G 内存。<br>系统:<br>Ubuntu 14.04 LTS<br>软件:</p><pre><code>$ sudo apt-get install libvirtd virt-manager

</code></pre><p>从Miranti网站下载： MirantisOpenStack-6.0.iso<br>从Contrail网站下载: contrail-install-packages_2.0-22~icehouse_all.deb<br>contrail-neutron-plugin仓库:</p><pre><code>git clone https://github.com/Juniper/contrail-neutron-plugin.git

</code></pre><h3 id=cpu内存磁盘规划>CPU/内存/磁盘规划</h3><p>需要构建一共8台虚拟机用于在部署好的Mirantis OpenStack上集成OpenContrail. CPU/内存/磁盘规划如下:<br>1台Mirantis Fuel控制节点机,2核,划分3G内存, 100G磁盘。
3个OpenStack Controller节点, 2核,各划分3G内存, 100G磁盘。<br>1个OpenStack Compute节点，2核(嵌套虚拟化),划分3G内存, 100G磁盘。<br>3个OpenContrail节点，2核,各划分4G内存, 100G磁盘。<br>一共需要27G内存。磁盘格式为qcow2，实际占用远小于这个数，各个节点最大也就是在5G左右大小。<br>其中，关于嵌套虚拟化的CPU设置，如下图, 记得选择Copy host CPU Configuration:<br><img src=/images/2015_04_27_12_20_40_598x372.jpg alt=/images/2015_04_27_12_20_40_598x372.jpg><br>启用嵌套虚拟化需要在BIOS设置，并添加相应的内核模块。</p><h3 id=网络规划>网络规划</h3><p>Fuel OpenStack规划了5个网络，分别是:<br>Admin(PXE)<br>Public<br>Management<br>Storage<br>Private</p><p>我们在Virt-Manager里也同样创建出这样的五个子网:<br>Admin(PXE) &ndash; FuelNAT &ndash; 10.20.0.0/24<br>Public &ndash; FuelPublic &ndash; 172.16.0.0/24<br>Management &ndash; FuelMgmt &ndash; 10.55.55.0/24<br>Storage &ndash; FuelStorage &ndash; 10.66.66.0/24<br>Private &ndash; FuelPrivate &ndash; 10.77.77.0/24</p><p>创建网络的步骤如下，双击Virtual Machine Manager里的localhost(QEMU), 弹出下面的窗口:<br><img src=/images/2015_04_27_14_57_37_499x379.jpg alt=/images/2015_04_27_14_57_37_499x379.jpg><br>点击网络列表最下面的+号,弹出创建网络的窗口:<br><img src=/images/2015_04_27_14_58_52_543x374.jpg alt=/images/2015_04_27_14_58_52_543x374.jpg><br>命名该网络，点击下一步:<br><img src=/images/2015_04_27_15_00_34_549x371.jpg alt=/images/2015_04_27_15_00_34_549x371.jpg><br>禁用DHCP:<br><img src=/images/2015_04_27_16_37_32_544x374.jpg alt=/images/2015_04_27_16_37_32_544x374.jpg><br>选择isolated网络模式:<br><img src=/images/2015_04_27_16_38_34_551x375.jpg alt=/images/2015_04_27_16_38_34_551x375.jpg><br>接着点击下一步直到完成，这样我们的网络就创建好了。<br>用上面的方法创建出以上5个子网。</p><h3 id=各个节点网络配置>各个节点网络配置</h3><p>Miranti Fuel Node: 仅FuelNAT, 安装完毕后，自动指定地址为10.20.0.2.<br>其他所有节点机，在创建时，把五个网络都添加上，添加方法如下:<br>Details -> Add Hardware -> Network, 而后选择:<br><img src=/images/2015_04_27_16_45_34_765x444.jpg alt=/images/2015_04_27_16_45_34_765x444.jpg></p><h3 id=miranti-fuel-node安装>Miranti Fuel Node安装</h3><p>安装很简单，直接用下载的MirantisOpenStack-6.0.iso作为安装光盘，在创建出来的虚拟机里安装系统。安装完毕后，在Host机器的浏览器里访问<br><a href=http://10.20.0.2:8000>http://10.20.0.2:8000</a><br>输入用户名密码都为admin后，登录，可以看到以下界面:<br><img src=/images/2015_04_27_16_55_29_717x477.jpg alt=/images/2015_04_27_16_55_29_717x477.jpg><br>在这个界面里我们可以进行OpenStack环境的准备、部署、配置、销毁等操作。</p><p>到这一步，我们已经完成了Miranti Fuel Node的安装，基本的部署准备工作已经完成，接下来我们将使用Fuel来部署一个可用的OpenStack环境, 以及三台用于部署Contrail的节点机.</p></div></div><script src=http://purplepalmdash.github.io/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>