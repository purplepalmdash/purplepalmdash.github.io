<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta name=generator content="Hugo 0.64.0"><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Dash &#183; Dash</title><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-a.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/custom-additions.css?ref=abc124"><link rel=stylesheet href=https://purplepalmdash.github.io/css/highlight/googlecode.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script type=text/javascript src=/js/html2canvas.js></script><script type=text/javascript>function genPostShot(){var rightNow=new Date();var imageName=rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");imageName+='.jpg'
html2canvas(document.getElementsByClassName('post'),{background:'#FFFFFF',onrendered:function(canvas){$('#test').attr('href',canvas.toDataURL("image/jpeg"));$('#test').attr('download',imageName);$('#test')[0].click();}});};</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=apple-touch-icon-precomposed sizes=144x144 href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124"><link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel=icon><link href=%7balternate%20%7bRSS%20application/rss+xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/index.xml%20http://purplepalmdash.github.io/index.xml%7d rel=alternate type=application/rss+xml title="Dash &#183; Dash"><meta name=description content><meta name=keywords content="unix,virtualization,embedded,linux"></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><img src=http://purplepalmdash.github.io/images/mylogo.jpeg alt=gravatar><h1><a href=http://purplepalmdash.github.io/>很惭愧，就做了一点微小的工作</a></h1><a href=http://purplepalmdash.github.io/><p>Dash</p></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/post/>All Posts</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/technology/>Technology</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/life/>Life</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/linuxtips/>LinuxTips</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/purplepalmdash><i class="fa fa-github-square fa-3x"></i></a><a href=https://cn.linkedin.com/in/yang-feipeng-1b909319><i class="fa fa-linkedin-square fa-3x"></i></a><a href=https://plus.google.com/u/0/106572959364703833986><i class="fa fa-google-plus-square fa-3x"></i></a><a href=https://www.facebook.com/yang.feipeng><i class="fa fa-facebook-square fa-3x"></i></a><a href=https://twitter.com/dashwillfly><i class="fa fa-twitter-square fa-3x"></i></a></li></ul></div></div><div class="content container"><div class=posts><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2013/12/13/write-blogger-in-linux/>Write Blogger in Linux</a></h1><span class=post-date>Dec 13, 2013<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>###blogtk
Install it via &ldquo;yaourt -S blogtk&rdquo;</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2013/12/12/kali-linux-in-qemu/>KALI Linux in Qemu</a></h1><span class=post-date>Dec 12, 2013<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>Download the iso from kali website<a href=http://www.kali.org/downloads/>http://www.kali.org/downloads/</a>:</p><pre><code>	$ wget http://cdimage.kali.org/kali-images/kali-1.0.5/kali-linux-1.0.5-i386.iso

</code></pre><p>Create qemu img file:</p><pre><code>	$ qemu-img create -f qcow2 kali.qcow2 30G
	Formatting 'kali.qcow2', fmt=qcow2 size=32212254720 encryption=off cluster_size=65536 lazy_refcounts=off 
Run installation. Here we use the run-qemu script which has been generated before under the same directory:
	[Trusty@DashArch kali]$ ./run-qemu -hda ./kali.qcow2 -boot d -cdrom /media/nfs/iso/kali-linux-1.0.5-i386.iso  -m 1024 -enable-kvm -usb

</code></pre><p>Choose &ldquo;Graphic Install&rdquo; because currently we are not familiar with this brand new distribution.<br>Command for startup the sytem is:</p><pre><code>	[Trusty@DashArch kali]$ ./run-qemu -hda ./kali.qcow2 -boot d -cdrom /media/nfs/iso/kali-linux-1.0.5-i386.iso  -m 1024 -enable-kvm -usb

</code></pre><p>After installation finished, run &ldquo;sudo apt-get update&rdquo; and &ldquo;sudo apt-get upgrade&rdquo; to update your system to the newest version.</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2013/12/12/ntp-in-lan-based-on-openwrt/>NTP in LAN based on OPENWRT</a></h1><span class=post-date>Dec 12, 2013<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>###Package Installation
Disable the system default ntp server and install ntpd, this ntpd is the real ntpd package, not busybox-ntpd</p><pre><code>	opkg update
	opkg install ntpd
	/etc/init.d/sysntpd disable
	/etc/init.d/ntpd enable
	/etc/init.d/ntpd start
	netstat -l | grep ntp

</code></pre><p>The client installation, on debian:</p><pre><code>	apt-get install ntp

</code></pre><p>###Server Configuration
Comment all of the possible reference server, use local time source.</p><pre><code>	root@OpenWrt:~# cat /etc/ntp.conf 
	# use a random selection of 4 public stratum 2 servers
	# see http://twiki.ntp.org/bin/view/Servers/NTPPoolServers
	
	restrict default nomodify notrap noquery
	#restrict default noquery
	
	#restrict 127.0.0.1
	restrict 10.0.0.0 mask 255.255.255.0 nomodify notrap
	
	server 127.127.1.0	# LOCAL CLOCK
	fudge 127.127.1.0 stratum 0
	
	driftfile  /var/lib/ntp/ntp.drift

</code></pre><p>Then restart the service. Your ntp server is available.
###Client Configuration
Enable saned to enable ntp client on beaglebone:</p><pre><code>	# error message
	[....] Starting NTP server: ntpdsaned disabled; edit /etc/default/saned
	vim /etc/default/saned 
	# Set to yes to start saned
	RUN=yes

</code></pre><p>Then we have to enable the ntp client&rsquo;s configuration:<br>For Client manually synchornize</p><pre><code>	root@arm:~# ntpdate 10.0.0.1
	 1 Jan 05:18:55 ntpdate[2243]: the NTP socket is in use, exiting
	root@arm:~# ps -ef | grep ntp
	ntp       1805     1  0 04:30 ?        00:00:00 /usr/sbin/ntpd -p /var/run/ntpd.pid -g -u 107:112
	root      2245  2127  0 05:19 pts/0    00:00:00 grep ntp
	root@arm:~# kill 1805
	root@arm:~# date
	Sat Jan  1 05:19:05 UTC 2000
	root@arm:~# ntpdate 10.0.0.1
	12 Dec 07:38:44 ntpdate[2247]: step time server 10.0.0.1 offset 440129967.397166 sec
	root@arm:~# date
	Thu Dec 12 07:38:46 UTC 2013

</code></pre><p>The client configuration for ntp, remove all of the possible server, use LAN server:</p><pre><code>	server 10.0.0.1

</code></pre><p>tzselect will set the timezone of the equipment. The result is:</p><pre><code>	TZ='Asia/Shanghai'; export TZ

</code></pre><p>Add it into the ~/.profile, then your time will be adjusted to Shanghai Time.
###Update time via http
Since I located in UMT+8, I will use following commands for sync the time</p><pre><code>	date $(wget -O - &quot;http://www.timeapi.org/utc/in+eight+hours&quot; 2&gt;/dev/null | sed s/[-T:+]/\ /g | awk '{print $2,$3,$4,$5,&quot;.&quot;,$6}' | tr -d &quot; &quot; )

</code></pre><p>Then add it to crontab</p><pre><code>	root@OpenWrt:~# cat /bin/time.sh 
	#!/bin/sh
	#echo $http_proxy
	#echo $https_proxy
	date $(wget -O - &quot;http://www.timeapi.org/utc/in+eight+hours&quot; 2&gt;/dev/null | sed s/[-T:+]/\ /g | awk '{print $2,$3,$4,$5,&quot;.&quot;,$6}' | tr -d &quot; &quot; )

</code></pre><p>The crontab -e should like following:</p><pre><code>	* */3 * * * /bin/time.sh

</code></pre><p>This means every 3 hours the script will be called for synchronizing the time.<br>Now we can enjoy the precise time from the internet and make it availale for the service on LAN.</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2013/12/12/western-digits-green-disk-on-ubuntu/>Western Digital Green Disk on Ubuntu</a></h1><span class=post-date>Dec 12, 2013<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>The WD20EARS (and other sizes include 1.0 and 1.5 TB driver in the series) will attempt to park the read heads once every 8 seconds FOR THE LIFE OF THE HDD which is just horrible! To see if you are affected use the smartctl command (part of smartmontools). If the last column changes rapidly, this section applies to your drive.</p><pre><code>	# smartctl /dev/sdb -a | grep Load_Cycle
	193 Load_Cycle_Count        0x0032   001   001   000    Old_age   Always       -       597115	

</code></pre><p>We have to disable this feature. Add lines to /etc/rc.local</p><pre><code>	hdparam -S 242 /dev/sda
	exit 0

</code></pre><p>The effect for upper comand is listed as:</p><pre><code>	# hdparm -S 242 /dev/sda
	/dev/sda:
	 setting standby to 242 (1 hours)

</code></pre><p>By default the disk will standby when 1 hours reached, that will avoid our disk from broken.</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/2013/12/11/bbblackbian-yi-jiao-ben-jie-xi/>BBBlack编译脚本解析</a></h1><span class=post-date>Dec 11, 2013<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>###Preparation
Download the &ldquo;linux-dev&rdquo; repository from github:</p><pre><code>	git clone git://github.com/RobertCNelson/linux-dev.git

</code></pre><p>View the downloaded packages:</p><pre><code>	[Trusty@XXXyyy mykernel]$ du -hs linux-dev/
	19M	linux-dev/
	[Trusty@XXXyyy linux-dev]$ ls
	build_deb.sh  build_kernel.sh  build_mainline.sh  LICENSE  patches  patch.sh  README  repo_maintenance  scripts  system.sh.sample  tools  version.sh

</code></pre><p>Switch to the 3.12 Branch:</p><pre><code>	git checkout origin/am33x-v3.12 -b tmp
	[Trusty@XXXyyy linux-dev]$ ls
	build_deb.sh  build_kernel.sh  LICENSE  patches  patch.sh  README  repo_maintenance  scripts  system.sh.sample  tools  version.sh

</code></pre><p>###Walk by lines
Since we call ./build_kernel.sh will initialize the building, we will first see what&rsquo;s in this file<br>a. Create the deploy directory, Line 23-Line 25</p><pre><code>	DIR=$PWD
	mkdir -p ${DIR}/deploy/

</code></pre><p>Then the code goes to line 189, since all of the code between 25-189 are functions.</p><pre><code>	/bin/sh -e ${DIR}/tools/host_det.sh || { exit 1 ; }

</code></pre><p>This line will call tools/host_det.sh to detect the host, the result is listed:</p><pre><code>	[Trusty@XXXyyy linux-dev]$ tools/host_det.sh 
	which: no lsb_release in (/home/Trusty/.rvm/gems/ruby-1.9.3-p448/bin:/home/Trusty/.rvm/gems/ruby-1.9.3-p448@global/bin:/home/Trusty/.rvm/rubies/ruby-1.9.3-p448/bin:/home/Trusty/.rvm/bin:/media/y/embedded/cortex/gcc-arm-none-eabi-4_7-2013q3/bin:/home/Trusty/perl5/bin:/opt/cross/bin:/media/y/u-boot/4.3.2/bin/:/usr/local/sbin:/usr/local/bin:/usr/bin:/opt/android-sdk/platform-tools:/opt/android-sdk/tools:/usr/bin/site_perl:/usr/bin/core_perl)
	+ Detected build host []
	+ host: [x86_64]
	+ git HEAD commit: [858e7dbdedcb5d85d0e3b84323c5a6bfe6bd3b5e]
In host_det.sh, the code lines between 6~381 are all functions, till line 381. 
	if [ $(which lsb_release) ] ; then
	         info &quot;Detected build host [`lsb_release -sd`]&quot;
Following is the lsb_relase result, lsb_release is the linux standard base base package, which will provide enough infomations of the installed linux system. 
	$ lsb_release
	LSB Version:	:core-3.1-ia32:core-3.1-noarch:graphics-3.1-ia32:graphics-3.1-noarch
	[Tomcat@MisteryPlace:  [] /opt/home/Tomcat]                                                                                        $ lsb_release -sd
	&quot;Scientific Linux SL release 5.5 (Boron)&quot;
	[Tomcat@MisteryPlace:  [] /opt/home/Tomcat]                                                                                        $ uname -m
	i686

</code></pre><p>Testing the host and the git head commit</p><pre><code>	info &quot;host: [`uname -m`]&quot;
	info &quot;git HEAD commit: [`git rev-parse HEAD`]&quot;

</code></pre><p>This script is for testing the known hosts which runs redhat/debian/suse, and verify if you have installed all of the package need to support kernel build.</p><p>Copy the system.sh.sample to current directory</p><pre><code>if [ ! -f ${DIR}/system.sh ] ; then
	cp ${DIR}/system.sh.sample ${DIR}/system.sh

</code></pre><p>Next lines from 199 to 218 is to detect if the branches.list and branch.expired exists, if exists then some testing will be done.</p><pre><code>	if [ -f &quot;${DIR}/branches.list&quot; ] ; then
		echo &quot;-----------------------------&quot;
		echo &quot;Please checkout one of the active branches:&quot;
		echo &quot;-----------------------------&quot;
		cat ${DIR}/branches.list | grep -v INACTIVE
		echo &quot;-----------------------------&quot;
		exit
	fi

</code></pre><p>Then go to line 220 and 221, unset 2 system variable</p><pre><code>	unset CC
	unset LINUX_GIT

</code></pre><p>Then run system.sh</p><pre><code>	. ${DIR}/system.sh

</code></pre><p>Then we will prepare the gcc.</p><pre><code>	/bin/sh -e &quot;${DIR}/scripts/gcc.sh&quot; || { exit 1 ; }
Switching to scripts/gcc.sh, the following lines will set the system variables, which will be used to choose the suitable linaro toolchain. 
	. ${DIR}/system.sh
	
	#For:
	#linaro_toolchain
	. ${DIR}/version.sh
Test the CC existence, if not then start building:
	if [ &quot;x${CC}&quot; = &quot;x&quot; ] &amp;&amp; [ &quot;x${ARCH}&quot; != &quot;xarmv7l&quot; ] ; then
		gcc_linaro_toolchain
	fi

</code></pre><p>The code are funny, because echo x${CC} is actually x , so the gcc_linaro_toolchain will surely be called.</p><pre><code>	$ echo ${linaro_toolchain}
	cortex_gcc_4_8

</code></pre><p>The variable {linaro_toolchain} is set via . version.sh, then the corresponding code lines will be called</p><pre><code>		cortex_gcc_4_8)
			#https://launchpad.net/linaro-toolchain-binaries/+download
			#https://launchpad.net/linaro-toolchain-binaries/trunk/2013.10/+download/gcc-linaro-arm-linux-gnueabihf-4.8-2013.10_linux.tar.xz
	
			gcc_version=&quot;4.8&quot;
			release=&quot;2013.10&quot;
			toolchain_name=&quot;gcc-linaro-arm-linux-gnueabihf&quot;
			site=&quot;https://launchpad.net/linaro-toolchain-binaries&quot;
			version=&quot;trunk/${release}&quot;
			directory=&quot;${toolchain_name}-${gcc_version}-${release}_linux&quot;
			filename=&quot;${directory}.tar.xz&quot;
			datestamp=&quot;${release}-${toolchain_name}&quot;
			untar=&quot;tar -xJf&quot;
	
			binary=&quot;bin/arm-linux-gnueabihf-&quot;
			;;
		*)
			echo &quot;bug: maintainer forgot to set:&quot;
			echo &quot;linaro_toolchain=\&quot;xzy\&quot; in version.sh&quot;
			exit 1
			;;

</code></pre><p>dl_gcc_generic will be called. download the corresponding packages from the linaro website.</p><p>After set the cross-compiler, we can get the kernel using git.sh, the git.sh is listed in scripts/git.sh</p><pre><code>	/bin/sh -e &quot;${DIR}/scripts/git.sh&quot; || { exit 1 ; }

</code></pre><p>In git.sh, detect the user&rsquo;s email and user&rsquo;s name:</p><pre><code>	unset git_config_user_email
	git_config_user_email=$(git config --get user.email || true)
	
	unset git_config_user_name
	git_config_user_name=$(git config --get user.name || true)

</code></pre><p>Then set using http or git, call git_kernel to git clone the corresponding resources from github.<br>git_kernel will call check_and_or_clone() to get the source code from the github.</p><pre><code>	git clone ${torvalds_linux} ${DIR}/ignore/linux-src

</code></pre><p>and set the LINUX_GIT variable to</p><pre><code>	LINUX_GIT=&quot;${DIR}/ignore/linux-src&quot;

</code></pre><p>The downloaded packages are so large, that it occupies 1.4G disk space.</p><pre><code>	[Trusty@XXXyyy ignore]$ du -hs *
	1.4G	linux-src

</code></pre></div><ul class=pagination><li class=page-item><a href=/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/page/219/ class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=/>1</a></li><li class=page-item><a class=page-link href=/page/2/>2</a></li><li class=page-item><a class=page-link href=/page/3/>3</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/219/>219</a></li><li class="page-item active"><a class=page-link href=/page/220/>220</a></li><li class=page-item><a class=page-link href=/page/221/>221</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/246/>246</a></li><li class=page-item><a href=/page/221/ class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/246/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div><script src=http://purplepalmdash.github.io/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>